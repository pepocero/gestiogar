"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6046],{84226:function(e,r,t){t.d(r,{z:function(){return s}});var n=t(57437);t(2265);var a=t(61994);function s(e){let{variant:r="primary",size:t="md",loading:s=!1,className:i,children:o,disabled:u,...l}=e;return(0,n.jsxs)("button",{className:(0,a.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[r],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[t],(u||s)&&"opacity-50 cursor-not-allowed",i),disabled:u||s,...l,children:[s&&(0,n.jsx)("div",{className:"spinner mr-2"}),o]})}},95998:function(e,r,t){t.d(r,{u:function(){return o}});var n=t(57437),a=t(2265),s=t(61994),i=t(32489);function o(e){let{isOpen:r,onClose:t,title:o,children:u,size:l="md",className:d}=e;return((0,a.useEffect)(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[r]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return r&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[r,t]),r)?(0,n.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,n.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),(0,n.jsxs)("div",{className:(0,s.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[l],d),children:[o&&(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:o}),(0,n.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,n.jsx)(i.Z,{className:"w-6 h-6"})})]}),(0,n.jsx)("div",{className:"p-6",children:u})]})]})}):null}},46281:function(e,r,t){t.d(r,{AuthProvider:function(){return l},a:function(){return d}});var n=t(57437),a=t(2265),s=t(2141),i=t(69064),o=t(26098);let u=(0,a.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,a.useState)(null),[d,c]=(0,a.useState)(null),[f,m]=(0,a.useState)(null),[g,h]=(0,a.useState)(!0),p=async e=>{try{if(d&&d.id===e){(0,o.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,o.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:n,error:a}=await s.supabase.from("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(a){console.warn("⚠️ Could not load user profile:",a.message);let e=(await s.supabase.auth.getUser()).data.user;if(e){var r,t;c({id:e.id,email:e.email,first_name:null===(r=e.user_metadata)||void 0===r?void 0:r.first_name,last_name:null===(t=e.user_metadata)||void 0===t?void 0:t.last_name})}return}(0,o.wH)("debug","✅ User profile loaded successfully"),c(n),m(n.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,a.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:r}}=await s.supabase.auth.getSession();(null==r?void 0:r.user)&&e&&(l(r.user),await p(r.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&h(!1)}})();let{data:{subscription:r}}=s.supabase.auth.onAuthStateChange(async(e,r)=>{var t;(0,o.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.id),"SIGNED_OUT"===e?(l(null),c(null),m(null),i.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==r?void 0:r.user)?(l(r.user),d&&d.id===r.user.id||await p(r.user.id)):"TOKEN_REFRESHED"===e&&(0,o.wH)("debug","\uD83D\uDD04 Token refreshed successfully")}),n=setInterval(async()=>{if(e&&t)try{let{data:{session:e},error:r}=await s.supabase.auth.getSession();(r||!e)&&((0,o.wH)("info","\uD83D\uDD04 Session expired, signing out..."),l(null),c(null),m(null),i.ZP.error("Sesi\xf3n expirada. Por favor, inicia sesi\xf3n nuevamente."))}catch(e){console.warn("⚠️ Error checking session:",e)}},o.ob.SESSION.CHECK_INTERVAL);return()=>{e=!1,r.unsubscribe(),clearInterval(n)}},[]);let b=async(e,r)=>{let{data:t,error:n}=await s.supabase.auth.signInWithPassword({email:e,password:r});if(n)throw n;return t},w=async(e,r,t)=>{let{data:n,error:a}=await s.supabase.auth.signUp({email:e,password:r,options:{data:t}});if(a)throw a;return n},y=async()=>{await s.supabase.auth.signOut()},E=async e=>{if(!t)throw Error("Usuario no autenticado");let{error:r}=await s.supabase.from("users").update(e).eq("id",t.id);if(r)throw r;await p(t.id)};return(0,n.jsx)(u.Provider,{value:{user:t,profile:d,company:f,loading:g,signIn:b,signUp:w,signOut:y,updateProfile:E},children:r})}function d(){let e=(0,a.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},58784:function(e,r,t){t.d(r,{DE:function(){return u},Db:function(){return m},Hk:function(){return s},KM:function(){return g},hU:function(){return i},l$:function(){return c},wV:function(){return d},wZ:function(){return l},yG:function(){return f}});var n=t(2141),a=t(26098);async function s(){let{data:e,error:r}=await n.supabase.from("technicians").select("id, first_name, last_name, is_active").eq("is_active",!0).order("first_name");if(r)throw console.error("Error fetching technicians:",r),r;return e||[]}async function i(){(0,a.wH)("debug","\uD83D\uDD0D getModules: Starting module fetch...");let{data:e,error:r}=await n.supabase.from("modules").select("*").eq("is_active",!0).order("name");if(r){var t;if(console.error("❌ getModules: Error fetching modules:",r),console.error("❌ Error details:",{code:r.code,message:r.message,details:r.details,hint:r.hint}),"PGRST205"===r.code||(null===(t=r.message)||void 0===t?void 0:t.includes("Could not find the table")))return(0,a.wH)("debug","\uD83D\uDCCB getModules: Modules table not found, returning empty array"),[];throw r}return(0,a.wH)("debug","✅ getModules: Successfully fetched modules:",e),e||[]}async function o(e){let{data:r,error:t}=await n.supabase.from("modules").insert([e]).select().single();if(t)throw console.error("Error creating module:",t),t;return r}async function u(e,r){let{data:t,error:a}=await n.supabase.from("modules").update(r).eq("id",e).select().single();if(a)throw console.error("Error updating module:",a),a;return t}async function l(e){let{error:r}=await n.supabase.from("modules").delete().eq("id",e);if(r)throw console.error("Error deleting module:",r),r}async function d(e){let{data:r,error:t}=await n.supabase.from("module_data").select("*").eq("module_id",e).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching module data:",t),t;return r||[]}async function c(e){let{data:r,error:t}=await n.supabase.from("module_data").insert([e]).select().single();if(t)throw console.error("Error creating module data:",t),t;return r}async function f(e,r){let{data:t,error:a}=await n.supabase.from("module_data").update(r).eq("id",e).select().single();if(a)throw console.error("Error updating module data:",a),a;return t}async function m(e){let{error:r}=await n.supabase.from("module_data").delete().eq("id",e);if(r)throw console.error("Error deleting module data:",r),r}async function g(e,r,t){try{let n=await new Promise((r,t)=>{let n=new FileReader;n.onload=e=>{try{var n;let a=null===(n=e.target)||void 0===n?void 0:n.result,s=JSON.parse(a);if(!["name","slug","version","description","fields","displayName"].every(e=>void 0!==s[e])){t(Error("Manifest inv\xe1lido: faltan campos requeridos"));return}r(s)}catch(e){t(Error("Error procesando archivo del m\xf3dulo"))}},n.onerror=()=>{t(Error("Error leyendo archivo"))},n.readAsText(e)}),a={company_id:r,name:n.name,slug:n.slug,version:n.version,description:n.description,icon:n.icon||"Package",is_active:!0,config:n,created_by:t};return await o(a)}catch(e){throw console.error("Error installing module:",e),e}}},26098:function(e,r,t){t.d(r,{ob:function(){return n},wH:function(){return a}});let n={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},a=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),a=1;a<r;a++)t[a-1]=arguments[a];if(!n.LOGGING.ENABLED)return;let s=["debug","info","warn","error"];s.indexOf(e)>=s.indexOf(n.LOGGING.MIN_LEVEL)&&console[e](...t)}},2141:function(e,r,t){t.r(r),t.d(r,{supabase:function(){return i},supabaseAdmin:function(){return o}});var n=t(63887);let a="https://pbdsuhmwxqiwbpgyrhqt.supabase.co";function s(e,r,t){return(0,n.eI)(e,r,{...t,auth:{...t.auth,storage:window.localStorage,storageKey:"supabase.auth.token",flowType:"pkce",debug:!1,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}let{supabase:i,supabaseAdmin:o}=function(){if(!globalThis.__supabaseInitialized){if(globalThis.__supabase)try{var e,r;null===(e=(r=globalThis.__supabase).removeAllChannels)||void 0===e||e.call(r)}catch(e){}globalThis.__supabase=s(a,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),globalThis.__supabaseAdmin=s(a,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",{auth:{persistSession:!1,autoRefreshToken:!1}}),globalThis.__supabaseInitialized=!0}return{supabase:globalThis.__supabase,supabaseAdmin:globalThis.__supabaseAdmin}}()}}]);