"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6046],{84226:function(e,r,t){t.d(r,{z:function(){return i}});var a=t(57437);t(2265);var n=t(61994);function i(e){let{variant:r="primary",size:t="md",loading:i=!1,className:o,children:s,disabled:u,...l}=e;return(0,a.jsxs)("button",{className:(0,n.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[r],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[t],(u||i)&&"opacity-50 cursor-not-allowed",o),disabled:u||i,...l,children:[i&&(0,a.jsx)("div",{className:"spinner mr-2"}),s]})}},95998:function(e,r,t){t.d(r,{u:function(){return s}});var a=t(57437),n=t(2265),i=t(61994),o=t(32489);function s(e){let{isOpen:r,onClose:t,title:s,children:u,size:l="md",className:d}=e;return((0,n.useEffect)(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[r]),(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return r&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[r,t]),r)?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),(0,a.jsxs)("div",{className:(0,i.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[l],d),children:[s&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(o.Z,{className:"w-6 h-6"})})]}),(0,a.jsx)("div",{className:"p-6",children:u})]})]})}):null}},46281:function(e,r,t){t.d(r,{AuthProvider:function(){return l},a:function(){return d}});var a=t(57437),n=t(2265),i=t(2141),o=t(69064),s=t(26098);let u=(0,n.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),[f,m]=(0,n.useState)(null),[p,g]=(0,n.useState)(!0),b=async e=>{try{if(d&&d.id===e){(0,s.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,s.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:a,error:n}=await (0,i.supabaseTable)("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(n){console.warn("⚠️ Could not load user profile:",n.message);let e=(await i.supabase.auth.getUser()).data.user;if(e){var r,t;c({id:e.id,email:e.email,first_name:null===(r=e.user_metadata)||void 0===r?void 0:r.first_name,last_name:null===(t=e.user_metadata)||void 0===t?void 0:t.last_name})}return}(0,s.wH)("debug","✅ User profile loaded successfully"),c(a),m(a.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,n.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:r}}=await i.supabase.auth.getSession();(null==r?void 0:r.user)&&e&&(l(r.user),await b(r.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&g(!1)}})();let{data:{subscription:r}}=i.supabase.auth.onAuthStateChange(async(e,r)=>{var t;(0,s.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.id),"SIGNED_OUT"===e?(l(null),c(null),m(null),o.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==r?void 0:r.user)?(l(r.user),d&&d.id===r.user.id||await b(r.user.id)):"TOKEN_REFRESHED"===e&&(0,s.wH)("debug","\uD83D\uDD04 Token refreshed successfully")});return()=>{e=!1,r.unsubscribe()}},[]);let h=async(e,r)=>{let{data:t,error:a}=await i.supabase.auth.signInWithPassword({email:e,password:r});if(a)throw a;return t},y=async(e,r,t)=>{let{data:a,error:n}=await i.supabase.auth.signUp({email:e,password:r,options:{data:t}});if(n)throw n;return a},w=async()=>{await i.supabase.auth.signOut()},E=async e=>{if(!t)throw Error("Usuario no autenticado");let{error:r}=await (0,i.supabaseTable)("users").update(e).eq("id",t.id);if(r)throw r;await b(t.id)};return(0,a.jsx)(u.Provider,{value:{user:t,profile:d,company:f,loading:p,signIn:h,signUp:y,signOut:w,updateProfile:E},children:r})}function d(){let e=(0,n.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},58784:function(e,r,t){t.d(r,{DE:function(){return u},Db:function(){return m},Hk:function(){return i},KM:function(){return p},hU:function(){return o},l$:function(){return c},wV:function(){return d},wZ:function(){return l},yG:function(){return f}});var a=t(2141),n=t(26098);async function i(e){let{data:r,error:t}=await (0,a.supabaseTable)("technicians").select("id, first_name, last_name, is_active").eq("is_active",!0).order("first_name");if(t)throw console.error("Error fetching technicians:",t),t;return r||[]}async function o(e){(0,n.wH)("debug","\uD83D\uDD0D getModules: Starting module fetch...",{companyId:e});let{data:r,error:t}=await (0,a.supabaseTable)("modules").select("*").eq("company_id",e).eq("is_active",!0).order("name");if(t){var i;if(console.error("❌ getModules: Error fetching modules:",t),console.error("❌ Error details:",{code:t.code,message:t.message,details:t.details,hint:t.hint}),"PGRST205"===t.code||(null===(i=t.message)||void 0===i?void 0:i.includes("Could not find the table")))return(0,n.wH)("debug","\uD83D\uDCCB getModules: Modules table not found, returning empty array"),[];throw t}return(0,n.wH)("debug","✅ getModules: Successfully fetched modules:",r),r||[]}async function s(e){let{data:r,error:t}=await (0,a.supabaseTable)("modules").insert([e]).select().single();if(t)throw console.error("Error creating module:",t),t;return r}async function u(e,r){let{data:t,error:n}=await (0,a.supabaseTable)("modules").update(r).eq("id",e).select().single();if(n)throw console.error("Error updating module:",n),n;return t}async function l(e,r){let t=(0,a.supabaseTable)("modules").delete().eq("id",e);r&&(t=t.eq("company_id",r));let{error:n}=await t;if(n)throw console.error("Error deleting module:",n),n}async function d(e,r){let t=(0,a.supabaseTable)("module_data").select("*").eq("module_id",e);r&&(t=t.eq("company_id",r));let{data:n,error:i}=await t.order("created_at",{ascending:!1});if(i&&r){console.warn("getModuleData fallback without company_id filter due to error:",i);let r=await (0,a.supabaseTable)("module_data").select("*").eq("module_id",e).order("created_at",{ascending:!1});if(r.error)throw console.error("Error fetching module data:",r.error),r.error;return r.data||[]}if(i)throw console.error("Error fetching module data:",i),i;return n||[]}async function c(e){if(!e.module_id)throw Error("module_id es requerido para crear datos del m\xf3dulo");let{data:r,error:t}=await (0,a.supabaseTable)("module_data").insert([e]).select().single();if(t)throw console.error("Error creating module data:",t),t;return r}async function f(e,r,t){let n=(0,a.supabaseTable)("module_data").update(r).eq("id",e);t&&(n=n.eq("company_id",t));let{data:i,error:o}=await n.select().single();if(o)throw console.error("Error updating module data:",o),o;return i}async function m(e,r){let t=(0,a.supabaseTable)("module_data").delete().eq("id",e);r&&(t=t.eq("company_id",r));let{error:n}=await t;if(n)throw console.error("Error deleting module data:",n),n}async function p(e,r,t){try{let a=await new Promise((r,t)=>{let a=new FileReader;a.onload=e=>{try{var a;let n=null===(a=e.target)||void 0===a?void 0:a.result,i=JSON.parse(n);if(!["name","slug","version","description","fields","displayName"].every(e=>void 0!==i[e])){t(Error("Manifest inv\xe1lido: faltan campos requeridos"));return}r(i)}catch(e){t(Error("Error procesando archivo del m\xf3dulo"))}},a.onerror=()=>{t(Error("Error leyendo archivo"))},a.readAsText(e)}),n={company_id:r,name:a.name,slug:a.slug,version:a.version,description:a.description,icon:a.icon||"Package",is_active:!0,config:a,created_by:t};return await s(n)}catch(e){throw console.error("Error installing module:",e),e}}},26098:function(e,r,t){t.d(r,{ob:function(){return a},wH:function(){return n}});let a={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},n=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];if(!a.LOGGING.ENABLED)return;let i=["debug","info","warn","error"];i.indexOf(e)>=i.indexOf(a.LOGGING.MIN_LEVEL)&&console[e](...t)}},2141:function(e,r,t){t.r(r),t.d(r,{supabase:function(){return f},supabaseAdmin:function(){return m},supabaseAdminTable:function(){return g},supabaseTable:function(){return p}});var a,n,i,o,s=t(63887),u=t(40257);let l=u.env.NEXT_PUBLIC_SUPABASE_URL||"https://pbdsuhmwxqiwbpgyrhqt.supabase.co",d=u.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",c=u.env.NEXT_PUBLIC_SUPABASE_SERVICE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",f=null!==(i=(a=globalThis).__supabaseClient)&&void 0!==i?i:a.__supabaseClient=(0,s.eI)(l,d,{auth:{flowType:"pkce",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"supabase.auth.token"}}),m=null!==(o=(n=globalThis).__supabaseAdminClient)&&void 0!==o?o:n.__supabaseAdminClient=(0,s.eI)(l,c,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storageKey:"supabase.admin.token"}}),p=e=>f.from(e),g=e=>m.from(e)}}]);