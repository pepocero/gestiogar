(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9109],{8113:function(e,a,s){Promise.resolve().then(s.bind(s,48275))},48275:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return w}});var t=s(57437),i=s(2265),n=s(46281),r=s(99178),l=s(84226),c=s(38068),d=s(95998),o=s(69379),m=s(2141),u=s(69064),x=s(99397),h=s(29525),p=s(92369),j=s(83774),g=s(31047),f=s(42208),y=s(94630),v=s(18930),b=s(89345),N=s(77127),_=s(89048);function w(){let{company:e}=(0,n.a)(),[a,s]=(0,i.useState)([]),[w,C]=(0,i.useState)(!0),[E,I]=(0,i.useState)(!1),[S,T]=(0,i.useState)(null),[Z,k]=(0,i.useState)([]),[D,O]=(0,i.useState)([]),[M,z]=(0,i.useState)([]),[A,P]=(0,i.useState)(!1),[H,L]=(0,i.useState)(null),[F,U]=(0,i.useState)(!1),[q,R]=(0,i.useState)(null),[G,J]=(0,i.useState)({search:"",status:"",job_type:"",priority:"",client_id:"",technician_id:""}),[B,W]=(0,i.useState)([]),[Y,V]=(0,i.useState)({title:"",description:"",job_type:"repair",priority:"normal",category:"",client_id:"",technician_id:"",insurance_company_id:"",scheduled_date:"",estimated_hours:0,notes:""});(0,i.useEffect)(()=>{e&&(X(),ee(),ea(),es())},[e]);let X=async()=>{try{C(!0);let{data:a,error:t}=await m.supabase.from("jobs").select("\n          *,\n          clients!inner(first_name, last_name, email, phone, address),\n          technicians(first_name, last_name, phone),\n          insurance_companies(name)\n        ").eq("company_id",e.id).order("created_at",{ascending:!1});if(t)throw t;s(a||[])}catch(e){console.error("Error loading jobs:",e),u.ZP.error("Error al cargar los trabajos")}finally{C(!1)}},K=()=>{let e=a;if(G.search){let a=G.search.toLowerCase();e=e.filter(e=>{var s,t,i,n,r;return e.title.toLowerCase().includes(a)||e.job_number.toLowerCase().includes(a)||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(a))||(null===(i=e.clients)||void 0===i?void 0:null===(t=i.first_name)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(r=e.clients)||void 0===r?void 0:null===(n=r.last_name)||void 0===n?void 0:n.toLowerCase().includes(a))})}G.status&&(e=e.filter(e=>e.status===G.status)),G.job_type&&(e=e.filter(e=>e.job_type===G.job_type)),G.priority&&(e=e.filter(e=>e.priority===G.priority)),G.client_id&&(e=e.filter(e=>e.client_id===G.client_id)),G.technician_id&&(e=e.filter(e=>e.technician_id===G.technician_id)),W(e)};(0,i.useEffect)(()=>{K()},[a,G]);let Q=(e,a)=>{J(s=>({...s,[e]:a}))},$=()=>{J({search:"",status:"",job_type:"",priority:"",client_id:"",technician_id:""})},ee=async()=>{try{let{data:a,error:s}=await m.supabase.from("clients").select("id, first_name, last_name, email, phone").eq("company_id",e.id).order("first_name");if(s)throw s;k(a||[])}catch(e){console.error("Error loading clients:",e)}},ea=async()=>{try{let{data:a,error:s}=await m.supabase.from("technicians").select("id, first_name, last_name, phone, specialties").eq("company_id",e.id).eq("is_active",!0).order("first_name");if(s)throw s;O(a||[])}catch(e){console.error("Error loading technicians:",e)}},es=async()=>{try{let{data:a,error:s}=await m.supabase.from("insurance_companies").select("id, name").eq("company_id",e.id).eq("is_active",!0).order("name");if(s)throw s;z(a||[])}catch(e){console.error("Error loading insurance companies:",e)}},et=e=>{let{name:a,value:s,type:t}=e.target,i=e.target.checked;V(e=>({...e,[a]:"checkbox"===t?i:s}))},ei=()=>{let e=new Date().getFullYear(),a=String(new Date().getMonth()+1).padStart(2,"0"),s=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return"JOB-".concat(e).concat(a,"-").concat(s)},en=async a=>{if(a.preventDefault(),e)try{let a=ei(),s={...Y,client_id:Y.client_id&&""!==Y.client_id.trim()?Y.client_id:null,technician_id:Y.technician_id&&""!==Y.technician_id.trim()?Y.technician_id:null,insurance_company_id:Y.insurance_company_id&&""!==Y.insurance_company_id.trim()?Y.insurance_company_id:null,estimated_hours:Y.estimated_hours?parseFloat(Y.estimated_hours.toString()):null};if(S){let{error:e}=await (0,m.supabaseTable)("jobs").update(s).eq("id",S.id);if(e)throw e;u.ZP.success("Trabajo actualizado correctamente")}else{let{error:t}=await (0,m.supabaseTable)("jobs").insert([{...s,job_number:a,company_id:e.id}]);if(t)throw t;u.ZP.success("Trabajo creado correctamente")}I(!1),T(null),em(),X()}catch(e){console.error("Error saving job:",e),u.ZP.error("Error al guardar el trabajo")}},er=e=>{T(e);let a="";if(e.scheduled_date){let s=new Date(e.scheduled_date),t=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0"),r=String(s.getHours()).padStart(2,"0"),l=String(s.getMinutes()).padStart(2,"0");a="".concat(t,"-").concat(i,"-").concat(n,"T").concat(r,":").concat(l)}V({title:e.title,description:e.description,job_type:e.job_type,priority:e.priority,category:e.category,client_id:e.client_id||"",technician_id:e.technician_id||"",insurance_company_id:e.insurance_company_id||"",scheduled_date:a,estimated_hours:e.estimated_hours,notes:e.notes}),I(!0)},el=e=>{L(e),P(!0)},ec=e=>{R(e),U(!0)},ed=async()=>{if(H)try{let{error:e}=await (0,m.supabaseTable)("jobs").delete().eq("id",H.id);if(e)throw e;u.ZP.success("Trabajo eliminado correctamente"),P(!1),L(null),X()}catch(e){console.error("Error deleting job:",e),u.ZP.error("Error al eliminar el trabajo")}},eo=async(e,a)=>{try{let s={status:a};"in_progress"===a?s.start_date=new Date().toISOString():"completed"===a&&(s.completion_date=new Date().toISOString());let{error:t}=await (0,m.supabaseTable)("jobs").update(s).eq("id",e);if(t)throw t;u.ZP.success("Estado actualizado correctamente"),X()}catch(e){console.error("Error updating status:",e),u.ZP.error("Error al actualizar el estado")}},em=()=>{V({title:"",description:"",job_type:"repair",priority:"normal",category:"",client_id:"",technician_id:"",insurance_company_id:"",scheduled_date:"",estimated_hours:0,notes:""})},eu=()=>{T(null),em(),I(!0)},ex=e=>{let a={emergency:{variant:"danger",label:"Emergencia"},urgent:{variant:"warning",label:"Urgente"},normal:{variant:"info",label:"Normal"}}[e]||{variant:"gray",label:e};return(0,t.jsx)(o.C,{variant:a.variant,size:"sm",children:a.label})},eh=e=>{let a={repair:{variant:"info",label:"Reparaci\xf3n"},renovation:{variant:"success",label:"Reforma"},emergency:{variant:"danger",label:"Emergencia"}}[e]||{variant:"gray",label:e};return(0,t.jsx)(o.C,{variant:a.variant,size:"sm",children:a.label})};return w?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"spinner"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Trabajos"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Gestiona las \xf3rdenes de trabajo y reparaciones."})]}),(0,t.jsxs)(l.z,{onClick:eu,className:"flex items-center space-x-2 w-full sm:w-auto",children:[(0,t.jsx)(x.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Nuevo Trabajo"})]})]}),(0,t.jsxs)(r.Zb,{className:"app-card",children:[(0,t.jsx)(r.Ol,{children:(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Filtros"})}),(0,t.jsxs)(r.eW,{children:[(0,t.jsxs)("div",{className:"filter-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Buscar"}),(0,t.jsx)("input",{type:"text",placeholder:"T\xedtulo, n\xfamero, cliente...",value:G.search,onChange:e=>Q("search",e.target.value),className:"form-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Estado"}),(0,t.jsxs)("select",{value:G.status,onChange:e=>Q("status",e.target.value),className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Todos los estados"}),(0,t.jsx)("option",{value:"pending",children:"Pendiente"}),(0,t.jsx)("option",{value:"scheduled",children:"Programado"}),(0,t.jsx)("option",{value:"in_progress",children:"En Progreso"}),(0,t.jsx)("option",{value:"completed",children:"Completado"}),(0,t.jsx)("option",{value:"cancelled",children:"Cancelado"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo"}),(0,t.jsxs)("select",{value:G.job_type,onChange:e=>Q("job_type",e.target.value),className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Todos los tipos"}),(0,t.jsx)("option",{value:"repair",children:"Reparaci\xf3n"}),(0,t.jsx)("option",{value:"maintenance",children:"Mantenimiento"}),(0,t.jsx)("option",{value:"installation",children:"Instalaci\xf3n"}),(0,t.jsx)("option",{value:"inspection",children:"Inspecci\xf3n"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Prioridad"}),(0,t.jsxs)("select",{value:G.priority,onChange:e=>Q("priority",e.target.value),className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Todas las prioridades"}),(0,t.jsx)("option",{value:"low",children:"Baja"}),(0,t.jsx)("option",{value:"normal",children:"Normal"}),(0,t.jsx)("option",{value:"high",children:"Alta"}),(0,t.jsx)("option",{value:"urgent",children:"Urgente"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Cliente"}),(0,t.jsxs)("select",{value:G.client_id,onChange:e=>Q("client_id",e.target.value),className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Todos los clientes"}),Z.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"T\xe9cnico"}),(0,t.jsxs)("select",{value:G.technician_id,onChange:e=>Q("technician_id",e.target.value),className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Todos los t\xe9cnicos"}),D.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]})]}),(0,t.jsx)("div",{className:"flex justify-end mt-4",children:(0,t.jsx)(l.z,{variant:"outline",onClick:$,className:"text-sm",children:"Limpiar Filtros"})})]})]}),(0,t.jsxs)(r.Zb,{className:"app-card",children:[(0,t.jsx)(r.Ol,{children:(0,t.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["Lista de Trabajos (",B.length," de ",a.length,")"]})}),(0,t.jsx)(r.eW,{children:B.length>0?(0,t.jsx)("div",{className:"space-y-4",children:B.map(e=>{var a;return(0,t.jsx)("div",{className:"job-card bg-white border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4 min-w-0",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-primary-50 text-primary-700 flex items-center justify-center shadow-sm flex-shrink-0",children:(0,t.jsx)(h.Z,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-mono text-xs px-2 py-0.5 bg-gray-100 text-gray-700 rounded",children:e.job_number}),eh(e.job_type),ex(e.priority)]}),(0,t.jsx)("h4",{className:"mt-1 text-base font-semibold text-gray-900 truncate",children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2 max-w-prose",children:e.description}),(0,t.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)(p.Z,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)("span",{className:"truncate",children:e.technicians?"".concat(e.technicians.first_name," ").concat(e.technicians.last_name):"Sin asignar"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)("span",{className:"truncate",children:null===(a=e.clients)||void 0===a?void 0:a.address})]})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end gap-3 flex-shrink-0",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("select",{value:e.status,onChange:a=>eo(e.id,a.target.value),className:"text-xs px-3 py-1 rounded-full border-0 font-medium cursor-pointer transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 min-w-[110px] ".concat("pending"===e.status?"bg-yellow-100 text-yellow-800 focus:ring-yellow-500":"scheduled"===e.status?"bg-blue-100 text-blue-800 focus:ring-blue-500":"in_progress"===e.status?"bg-indigo-100 text-indigo-800 focus:ring-indigo-500":"completed"===e.status?"bg-green-100 text-green-800 focus:ring-green-500":"bg-red-100 text-red-800 focus:ring-red-500"),children:[(0,t.jsx)("option",{value:"pending",children:"Pendiente"}),(0,t.jsx)("option",{value:"scheduled",children:"Programado"}),(0,t.jsx)("option",{value:"in_progress",children:"En Progreso"}),(0,t.jsx)("option",{value:"completed",children:"Completado"}),(0,t.jsx)("option",{value:"cancelled",children:"Cancelado"})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)("span",{children:e.scheduled_date?(0,N.Z)(new Date(e.scheduled_date),"dd/MM/yyyy",{locale:_.Z}):"-"})]}),(0,t.jsxs)("div",{className:"action-buttons flex items-center gap-2",children:[(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>ec(e),title:"Ver trabajo",children:(0,t.jsx)(f.Z,{className:"h-4 w-4"})}),(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>er(e),title:"Editar trabajo",children:(0,t.jsx)(y.Z,{className:"h-4 w-4"})}),(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>el(e),title:"Eliminar trabajo",children:(0,t.jsx)(v.Z,{className:"h-4 w-4"})})]})]})]})},e.id)})}):0===a.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(h.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No hay trabajos"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Comienza creando tu primer trabajo."}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)(l.z,{onClick:eu,children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Nuevo Trabajo"]})})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(h.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No se encontraron trabajos"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Intenta ajustar los filtros de b\xfasqueda."}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(l.z,{variant:"outline",onClick:$,children:"Limpiar Filtros"})})]})})]}),(0,t.jsx)(d.u,{isOpen:E,onClose:()=>I(!1),title:S?"Editar Trabajo":"Nuevo Trabajo",size:"lg",children:(0,t.jsxs)("form",{onSubmit:en,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(c.I,{label:"T\xedtulo del Trabajo *",name:"title",value:Y.title,onChange:et,required:!0})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo de Trabajo *"}),(0,t.jsxs)("select",{name:"job_type",value:Y.job_type,onChange:et,required:!0,className:"form-input",children:[(0,t.jsx)("option",{value:"repair",children:"Reparaci\xf3n"}),(0,t.jsx)("option",{value:"renovation",children:"Reforma"}),(0,t.jsx)("option",{value:"emergency",children:"Emergencia"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Prioridad *"}),(0,t.jsxs)("select",{name:"priority",value:Y.priority,onChange:et,required:!0,className:"form-input",children:[(0,t.jsx)("option",{value:"normal",children:"Normal"}),(0,t.jsx)("option",{value:"urgent",children:"Urgente"}),(0,t.jsx)("option",{value:"emergency",children:"Emergencia"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Categor\xeda"}),(0,t.jsxs)("select",{name:"category",value:Y.category,onChange:et,className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Seleccionar categor\xeda"}),(0,t.jsx)("option",{value:"electricidad",children:"Electricidad"}),(0,t.jsx)("option",{value:"fontaneria",children:"Fontaner\xeda"}),(0,t.jsx)("option",{value:"carpinteria",children:"Carpinter\xeda"}),(0,t.jsx)("option",{value:"pintura",children:"Pintura"}),(0,t.jsx)("option",{value:"albanileria",children:"Alba\xf1iler\xeda"}),(0,t.jsx)("option",{value:"general",children:"General"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Cliente *"}),(0,t.jsxs)("select",{name:"client_id",value:Y.client_id,onChange:et,required:!0,className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Seleccionar cliente"}),Z.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"T\xe9cnico"}),(0,t.jsxs)("select",{name:"technician_id",value:Y.technician_id,onChange:et,className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Sin asignar"}),D.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Aseguradora"}),(0,t.jsxs)("select",{name:"insurance_company_id",value:Y.insurance_company_id,onChange:et,className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Sin aseguradora"}),M.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsx)("div",{children:(0,t.jsx)(c.I,{label:"Fecha Programada",name:"scheduled_date",type:"datetime-local",value:Y.scheduled_date,onChange:et})}),(0,t.jsx)("div",{children:(0,t.jsx)(c.I,{label:"Horas Estimadas",name:"estimated_hours",type:"number",value:Y.estimated_hours,onChange:et,min:"0",step:"0.5"})}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"form-label",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{name:"description",value:Y.description,onChange:et,rows:3,className:"form-input"})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"form-label",children:"Notas"}),(0,t.jsx)("textarea",{name:"notes",value:Y.notes,onChange:et,rows:2,className:"form-input"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,t.jsx)(l.z,{type:"button",variant:"outline",onClick:()=>I(!1),children:"Cancelar"}),(0,t.jsxs)(l.z,{type:"submit",children:[S?"Actualizar":"Crear"," Trabajo"]})]})]})}),(0,t.jsx)(d.u,{isOpen:F,onClose:()=>U(!1),title:"Detalles del Trabajo",size:"lg",children:q&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,t.jsx)(h.Z,{className:"h-8 w-8 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:q.job_number}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(e=>{let a={pending:{variant:"warning",label:"Pendiente"},scheduled:{variant:"info",label:"Programado"},in_progress:{variant:"info",label:"En Progreso"},completed:{variant:"success",label:"Completado"},cancelled:{variant:"danger",label:"Cancelado"}}[e]||{variant:"gray",label:e};return(0,t.jsx)(o.C,{variant:a.variant,children:a.label})})(q.status),ex(q.priority),eh(q.job_type)]})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Informaci\xf3n del Trabajo"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"T\xedtulo"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:q.title})]}),q.description&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Descripci\xf3n"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:q.description})]}),q.category&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Categor\xeda"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:q.category})]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Cliente"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(p.Z,{className:"h-4 w-4 text-purple-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Cliente"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[q.clients.first_name," ",q.clients.last_name]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(b.Z,{className:"h-4 w-4 text-green-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,t.jsx)("a",{href:"mailto:".concat(q.clients.email),className:"font-medium text-blue-600 hover:text-blue-700",children:q.clients.email})]})]}),(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(j.Z,{className:"h-4 w-4 text-orange-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Direcci\xf3n"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:q.clients.address})]})]})]})]})]}),q.technicians&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"T\xe9cnico Asignado"}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(p.Z,{className:"h-4 w-4 text-blue-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"T\xe9cnico"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[q.technicians.first_name," ",q.technicians.last_name]}),q.technicians.phone&&(0,t.jsx)("a",{href:"tel:".concat(q.technicians.phone),className:"text-sm text-blue-600 hover:text-blue-700",children:q.technicians.phone})]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Fechas y Horarios"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[q.scheduled_date&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Fecha Programada"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:(0,N.Z)(new Date(q.scheduled_date),"dd/MM/yyyy HH:mm",{locale:_.Z})})]}),q.start_date&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Fecha de Inicio"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:(0,N.Z)(new Date(q.start_date),"dd/MM/yyyy HH:mm",{locale:_.Z})})]}),q.completion_date&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Fecha de Finalizaci\xf3n"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:(0,N.Z)(new Date(q.completion_date),"dd/MM/yyyy HH:mm",{locale:_.Z})})]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Costos y Horas"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[q.estimated_hours&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Horas Estimadas"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[q.estimated_hours,"h"]})]}),q.actual_hours&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Horas Reales"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[q.actual_hours,"h"]})]}),q.labor_cost&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Costo de Mano de Obra"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:["€",q.labor_cost.toFixed(2)]})]}),q.total_cost&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Costo Total"}),(0,t.jsxs)("p",{className:"font-semibold text-gray-900",children:["€",q.total_cost.toFixed(2)]})]})]})]}),q.notes&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Notas"}),(0,t.jsx)("p",{className:"text-gray-900",children:q.notes})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Creado:"})," ",(0,N.Z)(new Date(q.created_at),"dd/MM/yyyy HH:mm",{locale:_.Z})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Actualizado:"})," ",(0,N.Z)(new Date(q.updated_at),"dd/MM/yyyy HH:mm",{locale:_.Z})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,t.jsx)(l.z,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Cerrar"}),(0,t.jsx)(l.z,{type:"button",onClick:()=>{U(!1),er(q)},children:"Editar Trabajo"})]})]})}),(0,t.jsx)(d.u,{isOpen:A,onClose:()=>P(!1),title:"Eliminar Trabajo",children:H&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{className:"text-gray-600",children:["\xbfEst\xe1s seguro de que quieres eliminar el trabajo"," ",(0,t.jsxs)("strong",{children:[H.job_number," - ",H.title]}),"?"]}),(0,t.jsx)("p",{className:"text-sm text-red-600",children:"Esta acci\xf3n no se puede deshacer."}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)(l.z,{variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),(0,t.jsx)(l.z,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:ed,children:"Eliminar"})]})]})})]})}},69379:function(e,a,s){"use strict";s.d(a,{C:function(){return n}});var t=s(57437);s(2265);var i=s(61994);function n(e){let{children:a,variant:s="gray",size:n="md",className:r}=e;return(0,t.jsx)("span",{className:(0,i.W)("inline-flex items-center font-medium rounded-full",{success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800",gray:"bg-gray-100 text-gray-800"}[s],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-xs"}[n],r),children:a})}},84226:function(e,a,s){"use strict";s.d(a,{z:function(){return n}});var t=s(57437);s(2265);var i=s(61994);function n(e){let{variant:a="primary",size:s="md",loading:n=!1,className:r,children:l,disabled:c,...d}=e;return(0,t.jsxs)("button",{className:(0,i.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[a],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s],(c||n)&&"opacity-50 cursor-not-allowed",r),disabled:c||n,...d,children:[n&&(0,t.jsx)("div",{className:"spinner mr-2"}),l]})}},99178:function(e,a,s){"use strict";s.d(a,{Ol:function(){return r},Zb:function(){return n},eW:function(){return l}});var t=s(57437);s(2265);var i=s(61994);function n(e){let{children:a,className:s}=e;return(0,t.jsx)("div",{className:(0,i.W)("card",s),children:a})}function r(e){let{children:a,className:s}=e;return(0,t.jsx)("div",{className:(0,i.W)("card-header",s),children:a})}function l(e){let{children:a,className:s}=e;return(0,t.jsx)("div",{className:(0,i.W)("card-body",s),children:a})}},38068:function(e,a,s){"use strict";s.d(a,{I:function(){return n}});var t=s(57437);s(2265);var i=s(61994);function n(e){let{label:a,error:s,helperText:n,className:r,id:l,...c}=e,d=l||"input-".concat(Math.random().toString(36).substr(2,9));return(0,t.jsxs)("div",{className:"w-full",children:[a&&(0,t.jsxs)("label",{htmlFor:d,className:"form-label",children:[a,c.required&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,t.jsx)("input",{id:d,className:(0,i.W)("form-input",s&&"border-red-300 focus:ring-red-500 focus:border-red-500",r),...c}),s&&(0,t.jsx)("p",{className:"form-error",children:s}),n&&!s&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:n})]})}},95998:function(e,a,s){"use strict";s.d(a,{u:function(){return l}});var t=s(57437),i=s(2265),n=s(61994),r=s(32489);function l(e){let{isOpen:a,onClose:s,title:l,children:c,size:d="md",className:o}=e;return((0,i.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a]),(0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return a&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[a,s]),a)?(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:s}),(0,t.jsxs)("div",{className:(0,n.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[d],o),children:[l&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:l}),(0,t.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(r.Z,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"p-6",children:c})]})]})}):null}},46281:function(e,a,s){"use strict";s.d(a,{AuthProvider:function(){return d},a:function(){return o}});var t=s(57437),i=s(2265),n=s(2141),r=s(69064),l=s(26098);let c=(0,i.createContext)(void 0);function d(e){let{children:a}=e,[s,d]=(0,i.useState)(null),[o,m]=(0,i.useState)(null),[u,x]=(0,i.useState)(null),[h,p]=(0,i.useState)(!0),j=async e=>{try{if(o&&o.id===e){(0,l.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,l.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:t,error:i}=await (0,n.supabaseTable)("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(i){console.warn("⚠️ Could not load user profile:",i.message);let e=(await n.supabase.auth.getUser()).data.user;if(e){var a,s;m({id:e.id,email:e.email,first_name:null===(a=e.user_metadata)||void 0===a?void 0:a.first_name,last_name:null===(s=e.user_metadata)||void 0===s?void 0:s.last_name})}return}(0,l.wH)("debug","✅ User profile loaded successfully"),m(t),x(t.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,i.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:a}}=await n.supabase.auth.getSession();(null==a?void 0:a.user)&&e&&(d(a.user),await j(a.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&p(!1)}})();let{data:{subscription:a}}=n.supabase.auth.onAuthStateChange(async(e,a)=>{var s;(0,l.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==a?void 0:null===(s=a.user)||void 0===s?void 0:s.id),"SIGNED_OUT"===e?(d(null),m(null),x(null),r.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==a?void 0:a.user)?(d(a.user),o&&o.id===a.user.id||await j(a.user.id)):"TOKEN_REFRESHED"===e&&(0,l.wH)("debug","\uD83D\uDD04 Token refreshed successfully")});return()=>{e=!1,a.unsubscribe()}},[]);let g=async(e,a)=>{let{data:s,error:t}=await n.supabase.auth.signInWithPassword({email:e,password:a});if(t)throw t;return s},f=async(e,a,s)=>{let{data:t,error:i}=await n.supabase.auth.signUp({email:e,password:a,options:{data:s}});if(i)throw i;return t},y=async()=>{await n.supabase.auth.signOut()},v=async e=>{if(!s)throw Error("Usuario no autenticado");let{error:a}=await (0,n.supabaseTable)("users").update(e).eq("id",s.id);if(a)throw a;await j(s.id)};return(0,t.jsx)(c.Provider,{value:{user:s,profile:o,company:u,loading:h,signIn:g,signUp:f,signOut:y,updateProfile:v},children:a})}function o(){let e=(0,i.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26098:function(e,a,s){"use strict";s.d(a,{ob:function(){return t},wH:function(){return i}});let t={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},i=function(e){for(var a=arguments.length,s=Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];if(!t.LOGGING.ENABLED)return;let n=["debug","info","warn","error"];n.indexOf(e)>=n.indexOf(t.LOGGING.MIN_LEVEL)&&console[e](...s)}},2141:function(e,a,s){"use strict";s.r(a),s.d(a,{supabase:function(){return u},supabaseAdmin:function(){return x},supabaseAdminTable:function(){return p},supabaseTable:function(){return h}});var t,i,n,r,l=s(63887),c=s(40257);let d=c.env.NEXT_PUBLIC_SUPABASE_URL||"https://pbdsuhmwxqiwbpgyrhqt.supabase.co",o=c.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",m=c.env.NEXT_PUBLIC_SUPABASE_SERVICE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",u=null!==(n=(t=globalThis).__supabaseClient)&&void 0!==n?n:t.__supabaseClient=(0,l.eI)(d,o,{auth:{flowType:"pkce",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"supabase.auth.token"}}),x=null!==(r=(i=globalThis).__supabaseAdminClient)&&void 0!==r?r:i.__supabaseAdminClient=(0,l.eI)(d,m,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storageKey:"supabase.admin.token"}}),h=e=>u.from(e),p=e=>x.from(e)},83774:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(39763).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])}},function(e){e.O(0,[8829,8931,2971,2117,1744],function(){return e(e.s=8113)}),_N_E=e.O()}]);