(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{20067:function(){},72061:function(){},76896:function(e,t,s){Promise.resolve().then(s.bind(s,9190))},9190:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return J}});var a=s(57437),r=s(2265),l=s(99178),n=s(84226),i=s(95998),o=s(92735),c=s(95252),d=s(42488),u=s(95805),m=s(70525),x=s(29525),h=s(48736),g=s(46221),p=s(31047),f=s(53417),j=s(65302),b=s(91723),N=s(48664),y=s(46281),v=s(2141),w=s(47625),E=s(86810),I=s(10062),C=s(20407),S=s(77719),T=s(5481),D=s(56940),_=s(97059),Z=s(62994),A=s(13600),O=s(77031),R=s(34685),P=s(53375),k=s(24457),F=s.n(k),M=s(2093),L=s(69064);function J(){let{company:e}=(0,y.a)(),[t,s]=(0,r.useState)(!0),[k,J]=(0,r.useState)({totalRevenue:0,totalJobs:0,totalClients:0,totalTechnicians:0,totalInvoices:0,totalEstimates:0,totalAppointments:0,totalCommunications:0,completedJobs:0,pendingJobs:0,activeClients:0,monthlyRevenue:0,growthRate:0}),[B,W]=(0,r.useState)([]),[G,U]=(0,r.useState)([]),[z,H]=(0,r.useState)([]),[q,Y]=(0,r.useState)([]),[K,V]=(0,r.useState)(!1),[X,Q]=(0,r.useState)(!1),$=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4"];(0,r.useEffect)(()=>{e&&ee()},[e]);let ee=async()=>{if(e)try{s(!0);let[t,a,r,l,n,i,o]=await Promise.all([v.supabase.from("jobs").select("*").eq("company_id",e.id),v.supabase.from("clients").select("*").eq("company_id",e.id),v.supabase.from("technicians").select("*").eq("company_id",e.id),v.supabase.from("invoices").select("*").eq("company_id",e.id),v.supabase.from("estimates").select("*").eq("company_id",e.id),v.supabase.from("appointments").select("*").eq("company_id",e.id),v.supabase.from("communications").select("*").eq("company_id",e.id)]),c=t.data||[],d=a.data||[],u=r.data||[],m=l.data||[],x=n.data||[],h=i.data||[],g=o.data||[],p=m.reduce((e,t)=>e+(t.total||0),0),f=c.filter(e=>"completed"===e.status).length,j=c.filter(e=>"pending"===e.status).length,b=d.filter(e=>e.is_active).length,N=new Date().getMonth(),y=new Date().getFullYear(),w=m.filter(e=>{let t=new Date(e.created_at);return t.getMonth()===N&&t.getFullYear()===y}).reduce((e,t)=>e+(t.total||0),0),E=0===N?11:N-1,I=0===N?y-1:y,C=m.filter(e=>{let t=new Date(e.created_at);return t.getMonth()===E&&t.getFullYear()===I}).reduce((e,t)=>e+(t.total||0),0);J({totalRevenue:p,totalJobs:c.length,totalClients:d.length,totalTechnicians:u.length,totalInvoices:m.length,totalEstimates:x.length,totalAppointments:h.length,totalCommunications:g.length,completedJobs:f,pendingJobs:j,activeClients:b,monthlyRevenue:w,growthRate:C>0?(w-C)/C*100:0}),et(c,d,u,m)}catch(e){console.error("Error loading report data:",e)}finally{s(!1)}},et=(e,t,s,a)=>{let r=e.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{});W([{name:"Completados",value:r.completed||0,color:"#10B981"},{name:"En Progreso",value:r.in_progress||0,color:"#F59E0B"},{name:"Pendientes",value:r.pending||0,color:"#3B82F6"},{name:"Cancelados",value:r.cancelled||0,color:"#EF4444"}].filter(e=>e.value>0));let l=t.reduce((e,t)=>{let s="insurance"===t.client_type?"Aseguradora":"Directo";return e[s]=(e[s]||0)+1,e},{});H([{name:"Aseguradoras",value:l.Aseguradora||0,color:"#3B82F6"},{name:"Clientes Directos",value:l.Directo||0,color:"#10B981"}].filter(e=>e.value>0)),Y(s.map(t=>{let a=e.filter(e=>e.technician_id===t.id).filter(e=>"completed"===e.status).length;return{name:"".concat(t.first_name," ").concat(t.last_name),value:a,color:$[s.indexOf(t)%$.length]}}).filter(e=>e.value>0));let n=[],i=new Date;for(let e=5;e>=0;e--){let t=new Date(i.getFullYear(),i.getMonth()-e,1),s=t.toLocaleDateString("es-ES",{month:"short"}),r=a.filter(e=>{let s=new Date(e.created_at);return s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear()}).reduce((e,t)=>e+(t.total||0),0);n.push({name:s,value:r,color:$[e%$.length]})}U(n)},es=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e),ea=e=>"".concat(e>=0?"+":"").concat(e.toFixed(1),"%"),er=async()=>{try{V(!0);let t=document.getElementById("reports-content");if(!t){L.ZP.error("No se pudo encontrar el contenido para exportar");return}let s=await F()(t,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"}),a=s.toDataURL("image/png"),r=new P.default("p","mm","a4"),l=210*s.height/s.width,n=l,i=0;for(r.addImage(a,"PNG",0,i,210,l),n-=295;n>=0;)i=n-l,r.addPage(),r.addImage(a,"PNG",0,i,210,l),n-=295;let o="reporte-".concat((null==e?void 0:e.name)||"empresa","-").concat(new Date().toISOString().split("T")[0],".pdf");r.save(o),L.ZP.success("Reporte exportado como PDF exitosamente")}catch(e){console.error("Error exporting to PDF:",e),L.ZP.error("Error al exportar el reporte como PDF")}finally{V(!1)}},el=()=>{try{var t,s,a,r,l,n;V(!0);let i=[["REPORTE DE EMPRESA",(null==e?void 0:e.name)||"Empresa"],["Fecha de generaci\xf3n",new Date().toLocaleDateString("es-ES")],[""],["ESTAD\xcdSTICAS PRINCIPALES"],["Ingresos Totales",es(k.totalRevenue)],["Trabajos Completados",k.completedJobs],["Clientes Activos",k.activeClients],["Crecimiento Mensual",ea(k.growthRate)],[""],["ESTAD\xcdSTICAS SECUNDARIAS"],["Total T\xe9cnicos",k.totalTechnicians],["Total Facturas",k.totalInvoices],["Total Presupuestos",k.totalEstimates],["Total Citas",k.totalAppointments],["Total Comunicaciones",k.totalCommunications],["Trabajos Pendientes",k.pendingJobs],["Ingresos del Mes",es(k.monthlyRevenue)],[""],["ESTADO DE TRABAJOS"],["Completados",(null===(t=B.find(e=>"Completados"===e.name))||void 0===t?void 0:t.value)||0],["En Progreso",(null===(s=B.find(e=>"En Progreso"===e.name))||void 0===s?void 0:s.value)||0],["Pendientes",(null===(a=B.find(e=>"Pendientes"===e.name))||void 0===a?void 0:a.value)||0],["Cancelados",(null===(r=B.find(e=>"Cancelados"===e.name))||void 0===r?void 0:r.value)||0],[""],["DISTRIBUCI\xd3N DE CLIENTES"],["Aseguradoras",(null===(l=z.find(e=>"Aseguradoras"===e.name))||void 0===l?void 0:l.value)||0],["Clientes Directos",(null===(n=z.find(e=>"Clientes Directos"===e.name))||void 0===n?void 0:n.value)||0],[""],["INGRESOS MENSUALES (\xdaltimos 6 meses)"],...G.map(e=>[e.name,es(e.value)]),[""],["RENDIMIENTO DE T\xc9CNICOS"],...q.map(e=>[e.name,e.value])],o=M.P6.aoa_to_sheet(i),c=M.P6.book_new();M.P6.book_append_sheet(c,o,"Reporte");let d="reporte-".concat((null==e?void 0:e.name)||"empresa","-").concat(new Date().toISOString().split("T")[0],".xlsx");M.NC(c,d),L.ZP.success("Reporte exportado como Excel exitosamente")}catch(e){console.error("Error exporting to Excel:",e),L.ZP.error("Error al exportar el reporte como Excel")}finally{V(!1)}},en=e=>{Q(!1),"pdf"===e?er():el()};return t?(0,a.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("p",{className:"ml-2 text-gray-600",children:"Cargando reportes..."})]}):(0,a.jsxs)("div",{id:"reports-content",className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Reportes"}),(0,a.jsx)("p",{className:"text-gray-600",children:"An\xe1lisis y estad\xedsticas de tu empresa"})]}),(0,a.jsxs)(n.z,{className:"btn-primary",onClick:()=>{Q(!0)},disabled:K,children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),K?"Exportando...":"Exportar Reporte"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.eW,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(c.Z,{className:"h-8 w-8 text-green-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Ingresos Totales"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:es(k.totalRevenue)})]})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.eW,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(d.Z,{className:"h-8 w-8 text-blue-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Trabajos Completados"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:k.completedJobs})]})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.eW,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(u.Z,{className:"h-8 w-8 text-purple-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Clientes Activos"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:k.activeClients})]})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.eW,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(m.Z,{className:"h-8 w-8 text-orange-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Crecimiento Mensual"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:ea(k.growthRate)})]})]})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4",children:[(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(x.Z,{className:"h-6 w-6 text-blue-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"T\xe9cnicos"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:k.totalTechnicians})]})}),(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(h.Z,{className:"h-6 w-6 text-green-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Facturas"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:k.totalInvoices})]})}),(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(g.Z,{className:"h-6 w-6 text-purple-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Presupuestos"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:k.totalEstimates})]})}),(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(p.Z,{className:"h-6 w-6 text-orange-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Citas"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:k.totalAppointments})]})}),(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(f.Z,{className:"h-6 w-6 text-indigo-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Comunicaciones"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:k.totalCommunications})]})}),(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(j.Z,{className:"h-6 w-6 text-green-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Completados"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:k.completedJobs})]})}),(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(b.Z,{className:"h-6 w-6 text-yellow-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Pendientes"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:k.pendingJobs})]})}),(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.eW,{className:"text-center",children:[(0,a.jsx)(c.Z,{className:"h-6 w-6 text-emerald-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Este Mes"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:es(k.monthlyRevenue)})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Estado de Trabajos"})}),(0,a.jsx)(l.eW,{children:B.length>0?(0,a.jsx)(w.h,{width:"100%",height:300,children:(0,a.jsxs)(E.u,{children:[(0,a.jsx)(I.b,{data:B,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percent:s,value:a}=e;return a>0?"".concat(t," ").concat((100*s).toFixed(0),"%"):""},outerRadius:80,fill:"#8884d8",dataKey:"value",children:B.map((e,t)=>(0,a.jsx)(C.b,{fill:e.color},"cell-".concat(t)))}),(0,a.jsx)(S.u,{})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(N.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,a.jsx)("p",{children:"No hay datos de trabajos disponibles"})]})})})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Distribuci\xf3n de Clientes"})}),(0,a.jsx)(l.eW,{children:z.length>0?(0,a.jsx)(w.h,{width:"100%",height:300,children:(0,a.jsxs)(E.u,{children:[(0,a.jsx)(I.b,{data:z,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percent:s,value:a}=e;return a>0?"".concat(t," ").concat((100*s).toFixed(0),"%"):""},outerRadius:80,fill:"#8884d8",dataKey:"value",children:z.map((e,t)=>(0,a.jsx)(C.b,{fill:e.color},"cell-".concat(t)))}),(0,a.jsx)(S.u,{})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(u.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,a.jsx)("p",{children:"No hay datos de clientes disponibles"})]})})})]})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Ingresos Mensuales (\xdaltimos 6 Meses)"})}),(0,a.jsx)(l.eW,{children:G.length>0?(0,a.jsx)(w.h,{width:"100%",height:400,children:(0,a.jsxs)(T.T,{data:G,children:[(0,a.jsx)(D.q,{strokeDasharray:"3 3"}),(0,a.jsx)(_.K,{dataKey:"name"}),(0,a.jsx)(Z.B,{tickFormatter:e=>"€".concat(e)}),(0,a.jsx)(S.u,{formatter:e=>[es(Number(e)),"Ingresos"]}),(0,a.jsx)(A.uN,{type:"monotone",dataKey:"value",stroke:"#3B82F6",fill:"#3B82F6",fillOpacity:.3})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(g.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,a.jsx)("p",{children:"No hay datos de ingresos disponibles"})]})})})]}),q.length>0&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Rendimiento de T\xe9cnicos"})}),(0,a.jsx)(l.eW,{children:(0,a.jsx)(w.h,{width:"100%",height:400,children:(0,a.jsxs)(O.v,{data:q,children:[(0,a.jsx)(D.q,{strokeDasharray:"3 3"}),(0,a.jsx)(_.K,{dataKey:"name"}),(0,a.jsx)(Z.B,{}),(0,a.jsx)(S.u,{}),(0,a.jsx)(R.$,{dataKey:"value",fill:"#10B981"})]})})})]}),(0,a.jsx)(i.u,{isOpen:X,onClose:()=>Q(!1),title:"Exportar Reporte",size:"md",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg mx-auto mb-4",children:(0,a.jsx)(o.Z,{className:"h-8 w-8 text-white"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Selecciona el formato de exportaci\xf3n"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Elige c\xf3mo quieres descargar tu reporte"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>en("pdf"),className:"flex items-center p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors group",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center group-hover:bg-red-200 transition-colors",children:(0,a.jsx)(h.Z,{className:"h-6 w-6 text-red-600"})}),(0,a.jsxs)("div",{className:"ml-4 text-left",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Exportar como PDF"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Descarga el reporte completo con gr\xe1ficos y dise\xf1o visual"})]})]}),(0,a.jsxs)("button",{onClick:()=>en("excel"),className:"flex items-center p-4 border border-gray-200 rounded-lg hover:border-green-300 hover:bg-green-50 transition-colors group",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center group-hover:bg-green-200 transition-colors",children:(0,a.jsx)(g.Z,{className:"h-6 w-6 text-green-600"})}),(0,a.jsxs)("div",{className:"ml-4 text-left",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Exportar como Excel"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Descarga los datos en formato de hoja de c\xe1lculo para an\xe1lisis"})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:(0,a.jsx)(n.z,{variant:"secondary",onClick:()=>Q(!1),children:"Cancelar"})})]})})]})}},84226:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var a=s(57437);s(2265);var r=s(61994);function l(e){let{variant:t="primary",size:s="md",loading:l=!1,className:n,children:i,disabled:o,...c}=e;return(0,a.jsxs)("button",{className:(0,r.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[t],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s],(o||l)&&"opacity-50 cursor-not-allowed",n),disabled:o||l,...c,children:[l&&(0,a.jsx)("div",{className:"spinner mr-2"}),i]})}},99178:function(e,t,s){"use strict";s.d(t,{Ol:function(){return n},Zb:function(){return l},eW:function(){return i}});var a=s(57437);s(2265);var r=s(61994);function l(e){let{children:t,className:s}=e;return(0,a.jsx)("div",{className:(0,r.W)("card",s),children:t})}function n(e){let{children:t,className:s}=e;return(0,a.jsx)("div",{className:(0,r.W)("card-header",s),children:t})}function i(e){let{children:t,className:s}=e;return(0,a.jsx)("div",{className:(0,r.W)("card-body",s),children:t})}},95998:function(e,t,s){"use strict";s.d(t,{u:function(){return i}});var a=s(57437),r=s(2265),l=s(61994),n=s(32489);function i(e){let{isOpen:t,onClose:s,title:i,children:o,size:c="md",className:d}=e;return((0,r.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return t&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,s]),t)?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:s}),(0,a.jsxs)("div",{className:(0,l.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[c],d),children:[i&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(n.Z,{className:"w-6 h-6"})})]}),(0,a.jsx)("div",{className:"p-6",children:o})]})]})}):null}},46281:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return c},a:function(){return d}});var a=s(57437),r=s(2265),l=s(2141),n=s(69064),i=s(26098);let o=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[h,g]=(0,r.useState)(!0),p=async e=>{try{if(d&&d.id===e){(0,i.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,i.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:a,error:r}=await l.supabase.from("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(r){console.warn("⚠️ Could not load user profile:",r.message);let e=(await l.supabase.auth.getUser()).data.user;if(e){var t,s;u({id:e.id,email:e.email,first_name:null===(t=e.user_metadata)||void 0===t?void 0:t.first_name,last_name:null===(s=e.user_metadata)||void 0===s?void 0:s.last_name})}return}(0,i.wH)("debug","✅ User profile loaded successfully"),u(a),x(a.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,r.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:t}}=await l.supabase.auth.getSession();(null==t?void 0:t.user)&&e&&(c(t.user),await p(t.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&g(!1)}})();let{data:{subscription:t}}=l.supabase.auth.onAuthStateChange(async(e,t)=>{var s;(0,i.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.id),"SIGNED_OUT"===e?(c(null),u(null),x(null),n.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==t?void 0:t.user)?(c(t.user),d&&d.id===t.user.id||await p(t.user.id)):"TOKEN_REFRESHED"===e&&(0,i.wH)("debug","\uD83D\uDD04 Token refreshed successfully")}),a=setInterval(async()=>{if(e&&s)try{let{data:{session:e},error:t}=await l.supabase.auth.getSession();(t||!e)&&((0,i.wH)("info","\uD83D\uDD04 Session expired, signing out..."),c(null),u(null),x(null),n.ZP.error("Sesi\xf3n expirada. Por favor, inicia sesi\xf3n nuevamente."))}catch(e){console.warn("⚠️ Error checking session:",e)}},i.ob.SESSION.CHECK_INTERVAL);return()=>{e=!1,t.unsubscribe(),clearInterval(a)}},[]);let f=async(e,t)=>{let{data:s,error:a}=await l.supabase.auth.signInWithPassword({email:e,password:t});if(a)throw a;return s},j=async(e,t,s)=>{let{data:a,error:r}=await l.supabase.auth.signUp({email:e,password:t,options:{data:s}});if(r)throw r;return a},b=async()=>{await l.supabase.auth.signOut()},N=async e=>{if(!s)throw Error("Usuario no autenticado");let{error:t}=await l.supabase.from("users").update(e).eq("id",s.id);if(t)throw t;await p(s.id)};return(0,a.jsx)(o.Provider,{value:{user:s,profile:d,company:m,loading:h,signIn:f,signUp:j,signOut:b,updateProfile:N},children:t})}function d(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26098:function(e,t,s){"use strict";s.d(t,{ob:function(){return a},wH:function(){return r}});let a={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},r=function(e){for(var t=arguments.length,s=Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];if(!a.LOGGING.ENABLED)return;let l=["debug","info","warn","error"];l.indexOf(e)>=l.indexOf(a.LOGGING.MIN_LEVEL)&&console[e](...s)}},2141:function(e,t,s){"use strict";s.r(t),s.d(t,{supabase:function(){return n},supabaseAdmin:function(){return i}});var a=s(63887);let r="https://pbdsuhmwxqiwbpgyrhqt.supabase.co";function l(e,t,s){return(0,a.eI)(e,t,{...s,auth:{...s.auth,storage:window.localStorage,storageKey:"supabase.auth.token",flowType:"pkce",debug:!1,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}let{supabase:n,supabaseAdmin:i}=function(){if(!globalThis.__supabaseInitialized){if(globalThis.__supabase)try{var e,t;null===(e=(t=globalThis.__supabase).removeAllChannels)||void 0===e||e.call(t)}catch(e){}globalThis.__supabase=l(r,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),globalThis.__supabaseAdmin=l(r,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",{auth:{persistSession:!1,autoRefreshToken:!1}}),globalThis.__supabaseInitialized=!0}return{supabase:globalThis.__supabase,supabaseAdmin:globalThis.__supabaseAdmin}}()}},function(e){e.O(0,[7337,2505,3125,1425,8829,3209,2008,2971,2117,1744],function(){return e(e.s=76896)}),_N_E=e.O()}]);