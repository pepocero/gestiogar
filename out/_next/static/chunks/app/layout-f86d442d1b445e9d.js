(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{812:function(e,t,r){Promise.resolve().then(r.t.bind(r,47960,23)),Promise.resolve().then(r.bind(r,11488)),Promise.resolve().then(r.bind(r,91778)),Promise.resolve().then(r.bind(r,46281)),Promise.resolve().then(r.bind(r,43981)),Promise.resolve().then(r.t.bind(r,50911,23)),Promise.resolve().then(r.bind(r,69064))},11488:function(e,t,r){"use strict";r.d(t,{ProtectedLayout:function(){return O}});var a=r(57437),s=r(2265),n=r(99376),l=r(46281),i=r(27648),o=r(61994),c=r(39763);let d=(0,c.Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);var u=r(29525),h=r(48736),m=r(95252),x=r(95805),f=r(92369),p=r(98420),y=r(44794),g=r(31047),v=r(13041),b=r(46221),j=r(98728),w=r(32489),N=r(91723),k=r(40340),Z=r(71621);let _=(0,c.Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),C=(0,c.Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var M=r(43981);let P=(0,s.createContext)(void 0);function z(e){let{children:t}=e,[r,n]=(0,s.useState)(!1),[l,i]=(0,s.useState)(!1);return(0,a.jsx)(P.Provider,{value:{sidebarOpen:r,setSidebarOpen:n,isDesktop:l,setIsDesktop:i},children:t})}function S(){let e=(0,s.useContext)(P);if(void 0===e)throw Error("useSidebar must be used within a SidebarProvider");return e}let E=[{name:"Dashboard",href:"/dashboard",icon:d},{name:"Trabajos",href:"/jobs",icon:u.Z},{name:"Presupuestos",href:"/estimates",icon:h.Z},{name:"Facturas",href:"/invoices",icon:m.Z},{name:"Clientes",href:"/clients",icon:x.Z},{name:"T\xe9cnicos",href:"/technicians",icon:f.Z},{name:"Aseguradoras",href:"/insurance",icon:p.Z},{name:"Proveedores",href:"/suppliers",icon:y.Z},{name:"Materiales",href:"/materials",icon:y.Z},{name:"Citas",href:"/appointments",icon:g.Z},{name:"Comunicaciones",href:"/communications",icon:v.Z},{name:"Reportes",href:"/reports",icon:b.Z},{name:"Configuraci\xf3n",href:"/settings",icon:j.Z}];function D(e){var t;let{onClose:r}=e,c=(0,n.usePathname)(),{company:d,signOut:m}=(0,l.a)(),{modules:f}=(0,M.s)(),{sidebarOpen:p,isDesktop:P}=S(),{navigateWithRefresh:z,timeSinceLastActivity:D}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{inactivityTimeout:t=3e5,loadingTimeout:r=1e4,enabled:a=!0}=e,l=(0,n.useRouter)();(0,n.usePathname)();let i=(0,s.useRef)(Date.now()),o=(0,s.useRef)(null),c=(0,s.useRef)(null),d=()=>{i.current=Date.now()},u=()=>{Date.now()-i.current>t&&window.location.reload()};return(0,s.useEffect)(()=>{if(!a)return;let e=["mousedown","keydown","scroll","touchstart","click"];e.forEach(e=>{window.addEventListener(e,d,{passive:!0})}),c.current=setInterval(u,6e4);let r=()=>{"visible"===document.visibilityState&&(Date.now()-i.current>t?window.location.reload():d())};return document.addEventListener("visibilitychange",r),()=>{e.forEach(e=>{window.removeEventListener(e,d)}),c.current&&clearInterval(c.current),document.removeEventListener("visibilitychange",r)}},[a,t]),{navigateWithRefresh:e=>{Date.now()-i.current>t?window.location.href=e:l.push(e)},updateActivity:d,startLoadingTimer:()=>{o.current=Date.now()},checkLoadingTimeout:()=>{o.current&&Date.now()-o.current>r&&window.location.reload()},timeSinceLastActivity:()=>Date.now()-i.current}}({inactivityTimeout:18e4,enabled:!0}),A=[],F=(e,t)=>{D()>12e4&&(e.preventDefault(),window.location.href=t)},R=async()=>{try{await m(),window.location.href="/"}catch(e){console.error("Error signing out:",e),window.location.href="/"}};return(0,a.jsxs)("div",{className:"flex flex-col w-64 bg-white shadow-lg h-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(null==d?void 0:d.logo_url)?(0,a.jsx)("img",{src:d.logo_url,alt:d.name,className:"w-12 h-12 rounded-lg object-cover shadow-sm"}):(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-600 rounded-lg flex items-center justify-center shadow-sm",children:(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:(null==d?void 0:null===(t=d.name)||void 0===t?void 0:t.charAt(0))||"G"})}),(0,a.jsx)("div",{className:"ml-3",children:(P||p)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:(null==d?void 0:d.name)||"Gestiogar"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Sistema de Gesti\xf3n"})]})})]}),r&&(0,a.jsx)("button",{onClick:r,className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100","aria-label":"Cerrar men\xfa",children:(0,a.jsx)(w.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("nav",{className:"flex-1 px-4 py-4 space-y-1 overflow-y-auto",children:[E.map(e=>{let t=c===e.href||c.startsWith(e.href+"/");return(0,a.jsxs)(i.default,{href:e.href,onClick:t=>{F(t,e.href),r&&r()},className:(0,o.W)("group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",t?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,a.jsx)(e.icon,{className:(0,o.W)("mr-3 h-5 w-5 flex-shrink-0",t?"text-primary-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)}),f.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"border-t border-gray-200 my-4"}),(0,a.jsx)("div",{className:"px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"M\xf3dulos"}),f.map(e=>{var t;let s=c==="/module/".concat(e.slug)||c.startsWith("/module/".concat(e.slug,"/")),n=(t=e.slug,({"horarios-empleados":N.Z,"vehiculos-servicio":k.Z,"gastos-operativos":Z.Z,"contactos-proveedores":_,"inventario-herramientas":u.Z,"holidays-vacations":g.Z,"vehicle-management":k.Z,"expense-tracker":Z.Z,"gestion-inventario":y.Z})[t]||y.Z);return(0,a.jsxs)(i.default,{href:"/module/".concat(e.slug),onClick:t=>{F(t,"/module/".concat(e.slug)),r&&r()},className:(0,o.W)("group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",s?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,a.jsx)(n,{className:(0,o.W)("mr-3 h-5 w-5 flex-shrink-0",s?"text-primary-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.id)})]}),0===f.length&&(null==d?void 0:d.id)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"border-t border-gray-200 my-4"}),(0,a.jsx)("div",{className:"px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"M\xf3dulos"}),(0,a.jsx)("div",{className:"px-3 py-2 text-xs text-gray-400",children:"No hay m\xf3dulos instalados"}),(0,a.jsx)("div",{className:"px-3 py-1 text-xs text-gray-400",children:(0,a.jsx)(i.default,{href:"/debug-modules",className:"text-blue-500 hover:text-blue-600",children:"Debug m\xf3dulos"})})]}),A.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"border-t border-gray-200 my-4"}),(0,a.jsx)("div",{className:"px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"M\xf3dulos Avanzados"}),A.map((e,t)=>{var s;let n=c===e.href||c.startsWith(e.href+"/"),l=(s=e.icon,({Wrench:u.Z,Clock:N.Z,Truck:k.Z,Receipt:Z.Z,Building:_,Package:y.Z,Users:x.Z,Settings:j.Z,FileText:h.Z,BarChart3:b.Z,Phone:v.Z})[s]||y.Z);return(0,a.jsxs)(i.default,{href:e.href,onClick:()=>r&&r(),className:(0,o.W)("group flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",n?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,a.jsx)(l,{className:(0,o.W)("mr-3 h-5 w-5 flex-shrink-0",n?"text-primary-500":"text-gray-400 group-hover:text-gray-500")}),e.title,e.badge&&(0,a.jsx)("span",{className:"ml-auto bg-primary-100 text-primary-600 text-xs px-2 py-1 rounded-full",children:e.badge})]},"advanced-".concat(t))})]})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,a.jsxs)("button",{onClick:R,className:"group flex items-center w-full px-3 py-2 text-sm font-medium text-gray-600 rounded-md hover:bg-gray-50 hover:text-gray-900 transition-colors",children:[(0,a.jsx)(C,{className:"mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500"}),"Cerrar Sesi\xf3n"]})})]})}let A=(0,c.Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);var F=r(73247),R=r(94766),I=r(53581),H=r(84226),L=r(95998),T=r(96372),q=r(2141),U=r(69064);function W(e){var t,r;let{onMenuClick:n}=e,{profile:i,company:o,signOut:c}=(0,l.a)(),{sidebarOpen:d,isDesktop:u}=S(),[h,m]=(0,s.useState)(!1),[x,p]=(0,s.useState)(!1),[y,g]=(0,s.useState)(null),[v,b]=(0,s.useState)(null),[N,k]=(0,s.useState)(!1),[Z,_]=(0,s.useState)(!1),[M,P]=(0,s.useState)(null),z=(0,s.useRef)(null),[E,D]=(0,s.useState)({first_name:"",last_name:"",phone:""}),W=e=>{let{name:t,value:r}=e.target;D(e=>({...e,[t]:r}))},B=async e=>{if(!o)throw Error("No hay informaci\xf3n de empresa");let t=e.name.split(".").pop(),r=(o.name||"Empresa").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").substring(0,50),a=((null==i?void 0:i.first_name)||"User").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").substring(0,30),s=((null==i?void 0:i.last_name)||"Profile").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").substring(0,30),n="".concat(r,"_").concat(a,"_").concat(s,".").concat(t),l="logo/".concat(o.id,"/").concat(n),{error:c}=await q.supabase.storage.from("profile-photos").upload(l,e,{upsert:!0,contentType:e.type});if(c)throw console.error("Upload error:",c),c;let{data:d}=await q.supabase.storage.from("profile-photos").createSignedUrl(l,31536e3);if(!(null==d?void 0:d.signedUrl))throw console.error("Failed to create signed URL"),Error("No se pudo generar la URL firmada");return d.signedUrl},V=async e=>{try{let t="";e.includes("/storage/v1/object/public/profile-photos/")?t=e.split("/storage/v1/object/public/profile-photos/")[1]:e.includes("/storage/v1/object/sign/profile-photos/")&&(t=e.split("/storage/v1/object/sign/profile-photos/")[1].split("?")[0]),t&&await q.supabase.storage.from("profile-photos").remove([t])}catch(e){console.error("Error deleting old profile photo:",e)}},G=async()=>{if(!i||!o){console.error("No profile or company available");return}try{k(!0);let e=i.profile_photo_url;y&&(i.profile_photo_url&&await V(i.profile_photo_url),e=await B(y));let{error:t}=await q.supabase.from("users").update({profile_photo_url:e,first_name:E.first_name,last_name:E.last_name,phone:E.phone}).eq("id",i.id);if(t)throw console.error("Database update error:",t),t;U.ZP.success("Perfil actualizado exitosamente"),p(!1),g(null),b(null),window.location.reload()}catch(e){console.error("Error updating profile:",e),U.ZP.error("Error al actualizar el perfil: "+e.message)}finally{k(!1)}},O=async()=>{try{await c(),U.ZP.success("Sesi\xf3n cerrada exitosamente"),window.location.href="/"}catch(e){console.error("Error logging out:",e),U.ZP.error("Error al cerrar sesi\xf3n"),window.location.href="/"}};return(0,a.jsxs)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:n,className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",children:(0,a.jsx)(A,{className:"h-6 w-6"})}),(0,a.jsx)("div",{className:"ml-4",children:(!u||!d)&&(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:(null==o?void 0:o.name)||"Gestiogar"})})]}),(0,a.jsx)("div",{className:"flex-1 max-w-lg mx-8 hidden md:block",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(F.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar trabajos, clientes, presupuestos...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-500 hover:bg-gray-100 rounded-md",children:(0,a.jsx)(R.Z,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>m(!h),className:"flex items-center space-x-3 hover:bg-gray-50 rounded-lg p-2 transition-colors",children:[(0,a.jsxs)("div",{className:"text-right hidden sm:block",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[null==i?void 0:i.first_name," ",null==i?void 0:i.last_name]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:null==i?void 0:i.role})]}),(0,a.jsx)("div",{className:"w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center overflow-hidden",children:(null==i?void 0:i.profile_photo_url)?(0,a.jsx)("img",{src:i.profile_photo_url,alt:"Foto de perfil",className:"w-full h-full object-cover"}):(0,a.jsxs)("span",{className:"text-white text-sm font-medium",children:[null==i?void 0:null===(t=i.first_name)||void 0===t?void 0:t.charAt(0),null==i?void 0:null===(r=i.last_name)||void 0===r?void 0:r.charAt(0)]})})]}),h&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 border border-gray-200",children:[(0,a.jsxs)("button",{onClick:()=>{i&&D({first_name:i.first_name||"",last_name:i.last_name||"",phone:i.phone||""}),p(!0),m(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-3"}),"Editar Perfil"]}),(0,a.jsxs)("button",{onClick:()=>{m(!1),window.location.href="/settings"},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-3"}),"Configuraci\xf3n"]}),(0,a.jsx)("hr",{className:"my-1"}),(0,a.jsxs)("button",{onClick:()=>{O(),m(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:[(0,a.jsx)(C,{className:"h-4 w-4 mr-3"}),"Cerrar Sesi\xf3n"]})]})]})]})]}),(0,a.jsx)(L.u,{isOpen:x,onClose:()=>{p(!1),g(null),b(null),i&&D({first_name:i.first_name||"",last_name:i.last_name||"",phone:i.phone||""})},title:"Editar Perfil",size:"md",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4 overflow-hidden",children:(null==i?void 0:i.profile_photo_url)?(0,a.jsx)("img",{src:i.profile_photo_url,alt:"Foto de perfil actual",className:"w-full h-full object-cover"}):(0,a.jsx)(f.Z,{className:"h-12 w-12 text-white"})}),(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[null==i?void 0:i.first_name," ",null==i?void 0:i.last_name]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 capitalize",children:null==i?void 0:i.role})]}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Foto de Perfil"}),v&&(0,a.jsxs)("div",{className:"relative w-32 h-32 mx-auto mb-4",children:[(0,a.jsx)("img",{src:v,alt:"Preview",className:"w-full h-full object-cover rounded-full border-4 border-blue-200"}),(0,a.jsx)("button",{onClick:()=>{g(null),b(null),z.current&&(z.current.value="")},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("input",{ref:z,type:"file",accept:"image/*",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if(!r.type.startsWith("image/")){U.ZP.error("Por favor selecciona un archivo de imagen v\xe1lido");return}if(r.size>2097152){U.ZP.error("La imagen debe ser menor a 2MB");return}P(r),_(!0)}},className:"hidden"}),(0,a.jsxs)(H.z,{type:"button",variant:"secondary",onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},className:"flex items-center",children:[(0,a.jsx)(I.Z,{className:"h-4 w-4 mr-2"}),v?"Cambiar Foto":"Seleccionar Foto"]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center mt-2",children:"M\xe1ximo 2MB. Formatos: JPG, PNG, GIF"})]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,a.jsx)("input",{type:"text",name:"first_name",value:E.first_name,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ingresa tu nombre"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellidos"}),(0,a.jsx)("input",{type:"text",name:"last_name",value:E.last_name,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ingresa tus apellidos"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,a.jsx)("input",{type:"tel",name:"phone",value:E.phone,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+34 600 000 000"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:(null==i?void 0:i.email)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"El email no se puede cambiar desde aqu\xed"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)(H.z,{variant:"secondary",onClick:()=>{p(!1),g(null),b(null),i&&D({first_name:i.first_name||"",last_name:i.last_name||"",phone:i.phone||""})},children:"Cancelar"}),(0,a.jsx)(H.z,{onClick:G,disabled:N,className:"btn-primary",children:N?"Actualizando...":"Actualizar Perfil"})]})]})}),M&&(0,a.jsx)(T.v,{isOpen:Z,onClose:()=>{_(!1),P(null)},onSave:e=>{let t=new File([e],"profile-photo.jpg",{type:"image/jpeg"});g(t);let r=new FileReader;r.onload=e=>{var t;b(null===(t=e.target)||void 0===t?void 0:t.result)},r.readAsDataURL(t),_(!1),P(null)},imageFile:M,aspectRatio:1,title:"Editar Foto de Perfil",circular:!0})]})}function B(e){let{children:t}=e,{sidebarOpen:r,setSidebarOpen:n,isDesktop:l,setIsDesktop:i}=S();return(0,s.useEffect)(()=>{let e=()=>{i(window.innerWidth>=1024)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[i]),(0,a.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"hidden lg:block",children:(0,a.jsx)(D,{})}),(0,a.jsx)("div",{className:"fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ease-in-out lg:hidden ".concat(r?"translate-x-0":"-translate-x-full"),children:(0,a.jsx)(D,{onClose:()=>n(!1)})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,a.jsx)(W,{onMenuClick:()=>n(!r)}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"p-6",children:t})})]}),r&&(0,a.jsx)("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden",onClick:()=>n(!1)})]})}function V(e){let{children:t}=e;return(0,a.jsx)(z,{children:(0,a.jsx)(B,{children:t})})}function G(e){let{children:t}=e,{user:r,loading:i}=(0,l.a)(),o=(0,n.useRouter)(),[c,d]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{i||r||c||(d(!0),U.ZP.error("Sesi\xf3n expirada. Redirigiendo al login..."),setTimeout(()=>{o.push("/auth/login")},2e3))},[r,i,c,o]),i)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):r?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Verificando sesi\xf3n..."})]})})}function O(e){let{children:t}=e,r=(0,n.usePathname)(),{user:s,loading:i}=(0,l.a)();return["/","/auth/login","/auth/signup","/auth/forgot-password"].includes(r)?(0,a.jsx)(a.Fragment,{children:t}):i?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):(0,a.jsx)(G,{children:(0,a.jsx)(V,{children:(0,a.jsx)("div",{children:t},r)})})}},91778:function(e,t,r){"use strict";r.d(t,{SupabaseInitializer:function(){return o}});var a=r(57437),s=r(2265),n=r(2141),l=r(26098);function i(e){let{showDetails:t=!1}=e,{supabase:r}={supabase:n.supabase,supabaseAdmin:n.supabaseAdmin},[a,i]=(0,s.useState)({initialized:!1,session:null,lastCheck:"",instances:0});return(0,s.useEffect)(()=>{(async()=>{try{let e=!!globalThis.__supabaseInitialized,{data:{session:t}}=await r.auth.getSession(),a=window.__supabaseInstances||1;i({initialized:e,session:t,lastCheck:new Date().toLocaleTimeString(),instances:a})}catch(e){console.error("Error checking Supabase status:",e)}})(),l.ob.SUPABASE.CHECK_INITIALIZATION},[r]),null}function o(e){let{children:t,showMonitor:r=!1}=e;return(0,s.useEffect)(()=>{globalThis.__supabaseInitialized||console.warn("⚠️ Supabase no est\xe1 inicializado correctamente"),l.ob.SUPABASE.CHECK_INITIALIZATION},[]),(0,a.jsxs)(a.Fragment,{children:[t,r&&(0,a.jsx)(i,{showDetails:!1})]})}},96372:function(e,t,r){"use strict";r.d(t,{v:function(){return h}});var a=r(57437),s=r(2265),n=r(22574),l=r(84226),i=r(32489),o=r(41414),c=r(45802),d=r(43391),u=r(30401);function h(e){let{isOpen:t,onClose:r,onSave:h,imageFile:m,aspectRatio:x=1,title:f="Editar Imagen",circular:p=!1}=e,[y,g]=(0,s.useState)(),[v,b]=(0,s.useState)(),[j,w]=(0,s.useState)(1),[N,k]=(0,s.useState)(0),[Z,_]=(0,s.useState)(""),C=(0,s.useRef)(null),M=(0,s.useRef)(null);s.useEffect(()=>{if(t&&m){let e=new FileReader;e.onload=e=>{var t;_(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(m)}},[t,m]);let P=(0,s.useCallback)(e=>{let{width:t,height:r}=e.currentTarget;g((0,n._H)((0,n.YG)({unit:"%",width:90},x,t,r),t,r))},[x]),z=(e,t)=>{let r=M.current;if(!r)throw Error("Canvas no disponible");let a=r.getContext("2d");if(!a)throw Error("Contexto 2D no disponible");let s=e.naturalWidth/e.width,n=e.naturalHeight/e.height,l=window.devicePixelRatio;return r.width=t.width*l*s,r.height=t.height*l*n,a.setTransform(l,0,0,l,0,0),a.imageSmoothingQuality="high",0!==N&&(a.translate(r.width/2,r.height/2),a.rotate(N*Math.PI/180),a.translate(-r.width/2,-r.height/2)),a.drawImage(e,t.x*s,t.y*n,t.width*s,t.height*n,0,0,r.width/l,r.height/l),new Promise(e=>{r.toBlob(t=>{t&&e(t)},"image/jpeg",.95)})},S=async()=>{if(C.current&&v)try{let e=await z(C.current,v);h(e),r()}catch(e){console.error("Error al procesar la imagen:",e)}};return t&&Z?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:f}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(i.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 p-4 border-b border-gray-200 bg-gray-50",children:[(0,a.jsxs)(l.z,{variant:"secondary",size:"sm",onClick:()=>{k(e=>(e+90)%360)},className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Rotar"]}),(0,a.jsxs)(l.z,{variant:"secondary",size:"sm",onClick:()=>{w(e=>Math.max(e-.1,.5))},className:"flex items-center",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Alejar"]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[Math.round(100*j),"%"]}),(0,a.jsxs)(l.z,{variant:"secondary",size:"sm",onClick:()=>{w(e=>Math.min(e+.1,3))},className:"flex items-center",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Acercar"]})]}),(0,a.jsx)("div",{className:"p-4 overflow-auto max-h-[60vh]",children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(n.ZP,{crop:y,onChange:(e,t)=>g(t),onComplete:e=>b(e),aspect:x,circularCrop:p,children:(0,a.jsx)("img",{ref:C,alt:"Crop me",src:Z,style:{transform:"scale(".concat(j,") rotate(").concat(N,"deg)"),maxWidth:"100%",maxHeight:"400px"},onLoad:P})})})}),(0,a.jsx)("canvas",{ref:M,style:{display:"none"}}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 p-4 border-t border-gray-200",children:[(0,a.jsx)(l.z,{variant:"secondary",onClick:r,children:"Cancelar"}),(0,a.jsxs)(l.z,{onClick:S,disabled:!v,className:"btn-primary flex items-center",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})}):null}r(83814)},43981:function(e,t,r){"use strict";r.d(t,{ModulesProvider:function(){return c},s:function(){return d}});var a=r(57437),s=r(2265),n=r(58784),l=r(46281),i=r(26098);let o=(0,s.createContext)(void 0);function c(e){let{children:t}=e,{user:r,company:c}=(0,l.a)(),[d,u]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0),x=async()=>{if(!(null==c?void 0:c.id)){(0,i.wH)("debug","\uD83D\uDD0D No company ID available, skipping module load"),u([]),m(!1);return}try{m(!0),(0,i.wH)("debug","\uD83D\uDD04 Loading modules for company:",c.id);let e=await (0,n.hU)();(0,i.wH)("debug","\uD83D\uDCE6 Raw modules data:",e);let t=e.filter(e=>e.is_active);(0,i.wH)("debug","✅ Active modules:",t),u(t)}catch(t){var e;console.error("❌ Error loading modules:",t),(null==t?void 0:t.code)==="PGRST205"||(null==t?void 0:null===(e=t.message)||void 0===e?void 0:e.includes("Could not find the table"))?(0,i.wH)("debug","\uD83D\uDCCB Modules tables not created yet, returning empty list"):console.error("❌ Unexpected error loading modules:",t),u([])}finally{m(!1)}};(0,s.useEffect)(()=>{x()},[null==c?void 0:c.id]);let f=async()=>{await x()};return(0,a.jsx)(o.Provider,{value:{modules:d,loading:h,refreshModules:f},children:t})}function d(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useModules must be used within a ModulesProvider");return e}},46221:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},94766:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]])},98420:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},31047:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},53581:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},91723:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},95252:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},48736:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},44794:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},13041:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},71621:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]])},73247:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},98728:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},40340:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]])},92369:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},95805:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},29525:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]])},99376:function(e,t,r){"use strict";var a=r(35475);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},47960:function(){},50911:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[3587,5558,5566,8829,3926,7648,6046,2971,2117,1744],function(){return e(e.s=812)}),_N_E=e.O()}]);