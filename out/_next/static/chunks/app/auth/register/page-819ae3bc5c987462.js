(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8454],{98485:function(e,a,s){Promise.resolve().then(s.bind(s,61998))},61998:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return c}});var r=s(57437),n=s(2265),i=s(99376),t=s(27648),l=s(16023),o=s(2141),m=s(69064);function c(){let e=(0,i.useRouter)(),[a,s]=(0,n.useState)(!1),[c,d]=(0,n.useState)({companyName:"",companyAddress:"",companyPhone:"",companyEmail:"",companyWebsite:"",companyTaxId:"",firstName:"",lastName:"",email:"",password:"",confirmPassword:"",phone:""}),p=e=>{let{name:a,value:s}=e.target;d(e=>({...e,[a]:s}))},u=async a=>{if(a.preventDefault(),c.password!==c.confirmPassword){m.ZP.error("Las contrase\xf1as no coinciden");return}if(c.password.length<6){m.ZP.error("La contrase\xf1a debe tener al menos 6 caracteres");return}s(!0);try{let a=await (0,l.Ov)(c.companyName);await (0,l.bp)({name:c.companyName,slug:a,address:c.companyAddress,phone:c.companyPhone,email:c.companyEmail,website:c.companyWebsite,tax_id:c.companyTaxId},{email:c.email,password:c.password,first_name:c.firstName,last_name:c.lastName,phone:c.phone}),await o.supabase.auth.signOut(),e.push("/auth/login?registered=true")}catch(e){console.error("Error creating company:",e),m.ZP.error(e.message||"Error al crear la empresa")}finally{s(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Crear Nueva Empresa"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Reg\xedstrate como propietario de una empresa de reparaciones"})]}),(0,r.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-2xl",children:(0,r.jsx)("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:(0,r.jsxs)("form",{className:"space-y-6",onSubmit:u,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n de la Empresa"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"companyName",className:"form-label",children:"Nombre de la Empresa *"}),(0,r.jsx)("input",{id:"companyName",name:"companyName",type:"text",required:!0,className:"form-input",value:c.companyName,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"companyTaxId",className:"form-label",children:"CIF/NIF"}),(0,r.jsx)("input",{id:"companyTaxId",name:"companyTaxId",type:"text",className:"form-input",value:c.companyTaxId,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"companyPhone",className:"form-label",children:"Tel\xe9fono"}),(0,r.jsx)("input",{id:"companyPhone",name:"companyPhone",type:"tel",className:"form-input",value:c.companyPhone,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"companyEmail",className:"form-label",children:"Email de la Empresa"}),(0,r.jsx)("input",{id:"companyEmail",name:"companyEmail",type:"email",className:"form-input",value:c.companyEmail,onChange:p})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"companyAddress",className:"form-label",children:"Direcci\xf3n"}),(0,r.jsx)("input",{id:"companyAddress",name:"companyAddress",type:"text",className:"form-input",value:c.companyAddress,onChange:p})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"companyWebsite",className:"form-label",children:"Sitio Web"}),(0,r.jsx)("input",{id:"companyWebsite",name:"companyWebsite",type:"url",className:"form-input",placeholder:"https://",value:c.companyWebsite,onChange:p})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n del Propietario"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"firstName",className:"form-label",children:"Nombre *"}),(0,r.jsx)("input",{id:"firstName",name:"firstName",type:"text",required:!0,className:"form-input",value:c.firstName,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"lastName",className:"form-label",children:"Apellidos *"}),(0,r.jsx)("input",{id:"lastName",name:"lastName",type:"text",required:!0,className:"form-input",value:c.lastName,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email *"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",required:!0,className:"form-input",value:c.email,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"phone",className:"form-label",children:"Tel\xe9fono"}),(0,r.jsx)("input",{id:"phone",name:"phone",type:"tel",className:"form-input",value:c.phone,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"form-label",children:"Contrase\xf1a *"}),(0,r.jsx)("input",{id:"password",name:"password",type:"password",required:!0,className:"form-input",value:c.password,onChange:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",className:"form-label",children:"Confirmar Contrase\xf1a *"}),(0,r.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,className:"form-input",value:c.confirmPassword,onChange:p})]})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:a,className:"w-full btn-primary btn-lg",children:a?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("div",{className:"spinner mr-2"}),"Creando Empresa..."]}):"Crear Empresa"})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["\xbfYa tienes una empresa?"," ",(0,r.jsx)(t.default,{href:"/auth/login",className:"font-medium text-primary-600 hover:text-primary-500",children:"Inicia sesi\xf3n"})]})})]})})})]})}},16023:function(e,a,s){"use strict";s.d(a,{Ov:function(){return l},bp:function(){return n},j1:function(){return i}});var r=s(2141);async function n(e,a){try{let{data:s,error:n}=await (0,r.supabaseAdminTable)("companies").insert([e]).select().single();if(n)throw console.error("Error creating company:",n),n;let{data:i,error:t}=await r.supabase.auth.signUp({email:a.email,password:a.password});if(t)throw await (0,r.supabaseAdminTable)("companies").delete().eq("id",s.id),t;if(!i.user)throw await (0,r.supabaseAdminTable)("companies").delete().eq("id",s.id),Error("No se pudo crear el usuario");let{data:l,error:o}=await (0,r.supabaseAdminTable)("users").insert([{id:i.user.id,company_id:s.id,email:a.email,first_name:a.first_name,last_name:a.last_name,phone:a.phone,role:"owner"}]).select().single();if(o)throw console.error("Error creating user profile:",o),await (0,r.supabaseAdminTable)("companies").delete().eq("id",s.id),o;return{company:s,user:i.user,profile:l}}catch(e){throw console.error("Error creating company and owner:",e),e}}async function i(e,a){try{let{data:s,error:n}=await (0,r.supabaseTable)("companies").update(a).eq("id",e).select().single();if(n)return console.error("Error updating company:",n),null;return s}catch(e){return console.error("Error in updateCompany:",e),null}}async function t(e){try{let{data:a,error:s}=await (0,r.supabaseAdminTable)("companies").select("id").eq("slug",e).single();if(s&&"PGRST116"===s.code)return!0;return s&&console.error("Error checking slug availability:",s),!1}catch(e){return console.error("Error in isCompanySlugAvailable:",e),!1}}async function l(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),s=a,r=1,n=0;for(;!await t(s)&&n<10;)s="".concat(a,"-").concat(r),r++,n++;return n>=10&&(s="".concat(a,"-").concat(Date.now())),s}},2141:function(e,a,s){"use strict";s.r(a),s.d(a,{supabase:function(){return p},supabaseAdmin:function(){return u},supabaseAdminTable:function(){return f},supabaseTable:function(){return h}});var r,n,i,t,l=s(63887),o=s(40257);let m=o.env.NEXT_PUBLIC_SUPABASE_URL||"https://pbdsuhmwxqiwbpgyrhqt.supabase.co",c=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",d=o.env.NEXT_PUBLIC_SUPABASE_SERVICE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",p=null!==(i=(r=globalThis).__supabaseClient)&&void 0!==i?i:r.__supabaseClient=(0,l.eI)(m,c,{auth:{flowType:"pkce",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"supabase.auth.token"}}),u=null!==(t=(n=globalThis).__supabaseAdminClient)&&void 0!==t?t:n.__supabaseAdminClient=(0,l.eI)(m,d,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storageKey:"supabase.admin.token"}}),h=e=>p.from(e),f=e=>u.from(e)},99376:function(e,a,s){"use strict";var r=s(35475);s.o(r,"useParams")&&s.d(a,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(a,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(a,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[8829,7648,2971,2117,1744],function(){return e(e.s=98485)}),_N_E=e.O()}]);