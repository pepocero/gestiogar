(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2713],{49179:function(e,s,a){Promise.resolve().then(a.bind(a,96991))},96991:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var t=a(57437);a(2265);var r=a(62953),i=a(43044),n=a(95805),l=a(95252),d=a(70525),c=a(46221),u=a(29525),o=a(99376),x=a(69064),m=a(46281);function h(){let e=(0,o.useRouter)(),{user:s,profile:a,company:h,loading:N}=(0,m.a)();return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Dashboard Simple",N&&(0,t.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"(Cargando...)"})]}),(0,t.jsx)("p",{className:"text-gray-600",children:h?"Empresa: ".concat(h.name):"Sin empresa asignada"})]}),(0,t.jsx)(r.zx,{disabled:N,children:"Datos Est\xe1ticos"})]}),(0,t.jsx)(r.Zb,{children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Estado de Debug:"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Loading:"}),(0,t.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat(N?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:N?"S\xcd":"NO"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Usuario:"}),(0,t.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat(s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s?s.email:"NO"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Perfil:"}),(0,t.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat(a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:a?a.first_name:"NO"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Empresa:"}),(0,t.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat(h?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:h?h.name:"NO"})]})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsx)(r.Zb,{children:(0,t.jsx)("div",{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,t.jsx)(i.Z,{className:"h-6 w-6 text-blue-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Trabajos Activos"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:5})]})]})})}),(0,t.jsx)(r.Zb,{children:(0,t.jsx)("div",{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,t.jsx)(n.Z,{className:"h-6 w-6 text-green-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Clientes"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:23})]})]})})}),(0,t.jsx)(r.Zb,{children:(0,t.jsx)("div",{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,t.jsx)(l.Z,{className:"h-6 w-6 text-purple-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Ingresos Este Mes"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["€",12500..toLocaleString("es-ES")]})]})]})})}),(0,t.jsx)(r.Zb,{children:(0,t.jsx)("div",{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-orange-100 rounded-lg",children:(0,t.jsx)(d.Z,{className:"h-6 w-6 text-orange-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Presupuestos Pendientes"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:8})]})]})})})]}),(0,t.jsx)(r.Zb,{children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Acciones R\xe1pidas"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[(0,t.jsxs)(r.zx,{className:"justify-start",onClick:()=>{e.push("/jobs"),x.ZP.success("Redirigiendo a Trabajos...")},disabled:N,children:[(0,t.jsx)(i.Z,{className:"h-4 w-4 mr-2"}),"Nuevo Trabajo"]}),(0,t.jsxs)(r.zx,{className:"justify-start",variant:"outline",onClick:()=>{e.push("/clients"),x.ZP.success("Redirigiendo a Clientes...")},disabled:N,children:[(0,t.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"Agregar Cliente"]}),(0,t.jsxs)(r.zx,{className:"justify-start",variant:"outline",onClick:()=>{e.push("/reports"),x.ZP.success("Redirigiendo a Reportes...")},disabled:N,children:[(0,t.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Ver Reportes"]}),(0,t.jsxs)(r.zx,{className:"justify-start",variant:"outline",onClick:()=>{e.push("/estimates"),x.ZP.success("Redirigiendo a Presupuestos...")},disabled:N,children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Nuevo Presupuesto"]}),(0,t.jsxs)(r.zx,{className:"justify-start",variant:"outline",onClick:()=>{e.push("/technicians"),x.ZP.success("Redirigiendo a T\xe9cnicos...")},disabled:N,children:[(0,t.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Gestionar T\xe9cnicos"]})]})]})}),(0,t.jsx)("div",{className:"text-center pt-8",children:(0,t.jsx)("a",{href:"/dashboard",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"← Volver al Dashboard Principal"})})]})}},46281:function(e,s,a){"use strict";a.d(s,{AuthProvider:function(){return c},a:function(){return u}});var t=a(57437),r=a(2265),i=a(2141),n=a(69064),l=a(26098);let d=(0,r.createContext)(void 0);function c(e){let{children:s}=e,[a,c]=(0,r.useState)(null),[u,o]=(0,r.useState)(null),[x,m]=(0,r.useState)(null),[h,N]=(0,r.useState)(!0),g=async e=>{try{if(u&&u.id===e){(0,l.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,l.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:t,error:r}=await i.supabase.from("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(r){console.warn("⚠️ Could not load user profile:",r.message);let e=(await i.supabase.auth.getUser()).data.user;if(e){var s,a;o({id:e.id,email:e.email,first_name:null===(s=e.user_metadata)||void 0===s?void 0:s.first_name,last_name:null===(a=e.user_metadata)||void 0===a?void 0:a.last_name})}return}(0,l.wH)("debug","✅ User profile loaded successfully"),o(t),m(t.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,r.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:s}}=await i.supabase.auth.getSession();(null==s?void 0:s.user)&&e&&(c(s.user),await g(s.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&N(!1)}})();let{data:{subscription:s}}=i.supabase.auth.onAuthStateChange(async(e,s)=>{var a;(0,l.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==s?void 0:null===(a=s.user)||void 0===a?void 0:a.id),"SIGNED_OUT"===e?(c(null),o(null),m(null),n.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==s?void 0:s.user)?(c(s.user),u&&u.id===s.user.id||await g(s.user.id)):"TOKEN_REFRESHED"===e&&(0,l.wH)("debug","\uD83D\uDD04 Token refreshed successfully")}),t=setInterval(async()=>{if(e&&a)try{let{data:{session:e},error:s}=await i.supabase.auth.getSession();(s||!e)&&((0,l.wH)("info","\uD83D\uDD04 Session expired, signing out..."),c(null),o(null),m(null),n.ZP.error("Sesi\xf3n expirada. Por favor, inicia sesi\xf3n nuevamente."))}catch(e){console.warn("⚠️ Error checking session:",e)}},l.ob.SESSION.CHECK_INTERVAL);return()=>{e=!1,s.unsubscribe(),clearInterval(t)}},[]);let p=async(e,s)=>{let{data:a,error:t}=await i.supabase.auth.signInWithPassword({email:e,password:s});if(t)throw t;return a},j=async(e,s,a)=>{let{data:t,error:r}=await i.supabase.auth.signUp({email:e,password:s,options:{data:a}});if(r)throw r;return t},f=async()=>{await i.supabase.auth.signOut()},b=async e=>{if(!a)throw Error("Usuario no autenticado");let{error:s}=await i.supabase.from("users").update(e).eq("id",a.id);if(s)throw s;await g(a.id)};return(0,t.jsx)(d.Provider,{value:{user:a,profile:u,company:x,loading:h,signIn:p,signUp:j,signOut:f,updateProfile:b},children:s})}function u(){let e=(0,r.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26098:function(e,s,a){"use strict";a.d(s,{ob:function(){return t},wH:function(){return r}});let t={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},r=function(e){for(var s=arguments.length,a=Array(s>1?s-1:0),r=1;r<s;r++)a[r-1]=arguments[r];if(!t.LOGGING.ENABLED)return;let i=["debug","info","warn","error"];i.indexOf(e)>=i.indexOf(t.LOGGING.MIN_LEVEL)&&console[e](...a)}}},function(e){e.O(0,[5558,8829,3926,2533,2971,2117,1744],function(){return e(e.s=49179)}),_N_E=e.O()}]);