(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4525],{4650:function(e,a,s){Promise.resolve().then(s.bind(s,28056))},28056:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return b}});var r=s(57437),t=s(2265),l=s(99178),n=s(62953),i=s(99397),o=s(98420),c=s(42208),d=s(94630),u=s(18930),m=s(32489),h=s(17689),x=s(46281),g=s(2141),p=s(96372),f=s(69064);function b(){let{company:e}=(0,x.a)(),[a,s]=(0,t.useState)([]),[b,v]=(0,t.useState)(!0),[y,j]=(0,t.useState)(!1),[N,w]=(0,t.useState)(!1),[_,E]=(0,t.useState)(!1),[I,C]=(0,t.useState)(null),[k,Z]=(0,t.useState)(null),[S,z]=(0,t.useState)(null),[A,T]=(0,t.useState)(null),[M,D]=(0,t.useState)(!1),[O,L]=(0,t.useState)(null),[P,R]=(0,t.useState)(!1),[G,H]=(0,t.useState)({name:"",contact_person:"",email:"",phone:"",address:"",portal_url:"",billing_terms:30,is_active:!0}),U=()=>{H({name:"",contact_person:"",email:"",phone:"",address:"",portal_url:"",billing_terms:30,is_active:!0}),z(null),T(null)};(0,t.useEffect)(()=>{F()},[]);let F=async()=>{try{if(v(!0),!e){console.error("No company found");return}let{data:a,error:r}=await g.supabase.from("insurance_companies").select("*").eq("company_id",e.id).order("name",{ascending:!0});if(r)throw r;s(a||[])}catch(e){console.error("Error loading companies:",e),f.ZP.error("Error cargando aseguradoras")}finally{v(!1)}},q=async(a,s)=>{if(!S||!(null==e?void 0:e.id))return null;try{var r;D(!0);let a=S.name.split(".").pop(),t=(null===(r=e.name)||void 0===r?void 0:r.replace(/[^a-zA-Z0-9]/g,""))||"Empresa",l=s.replace(/[^a-zA-Z0-9]/g,"")||"Aseguradora",n="".concat(t,"_").concat(l,".").concat(a),i="logo/".concat(e.id,"/").concat(n),{data:o,error:c}=await g.supabase.storage.from("profile-photos").upload(i,S,{cacheControl:"3600",upsert:!0});if(c)return console.error("Error uploading logo:",c),f.ZP.error("Error al subir el logo"),null;let{data:d}=await g.supabase.storage.from("profile-photos").createSignedUrl(i,31536e3);if(d)return d.signedUrl;return null}catch(e){return console.error("Error uploading logo:",e),f.ZP.error("Error al subir el logo"),null}finally{D(!1)}},J=async e=>{try{let a="";if(e.includes("/storage/v1/object/public/profile-photos/")?a=e.split("/storage/v1/object/public/profile-photos/")[1]||"":e.includes("/storage/v1/object/sign/profile-photos/")&&(a=e.split("/storage/v1/object/sign/profile-photos/")[1]||""),a){let{error:e}=await g.supabase.storage.from("profile-photos").remove([a]);e&&console.error("Error eliminando logo:",e)}else console.error("No se pudo extraer el path del archivo de la URL:",e)}catch(e){console.error("Error eliminando logo del storage:",e)}},W=e=>{let{name:a,value:s,type:r}=e.target;H(t=>({...t,[a]:"checkbox"===r?e.target.checked:s}))},V=async a=>{a.preventDefault();try{if(!e){f.ZP.error("No se encontr\xf3 informaci\xf3n de la empresa");return}if(I){let a={name:G.name,contact_person:G.contact_person,email:G.email,phone:G.phone,address:G.address,portal_url:G.portal_url,billing_terms:G.billing_terms,is_active:G.is_active};if(S){I.logo_url&&await J(I.logo_url);let e=await q(I.id,G.name);e&&(a.logo_url=e)}let{error:s}=await g.supabase.from("insurance_companies").update(a).eq("id",I.id).eq("company_id",e.id);if(s)throw s;f.ZP.success("Aseguradora actualizada correctamente")}else{let{data:a,error:s}=await g.supabase.from("insurance_companies").insert({company_id:e.id,name:G.name,contact_person:G.contact_person,email:G.email,phone:G.phone,address:G.address,portal_url:G.portal_url,billing_terms:G.billing_terms,is_active:G.is_active}).select();if(s)throw s;if(S&&a&&a[0]){let e=await q(a[0].id,G.name);if(e){let{error:s}=await g.supabase.from("insurance_companies").update({logo_url:e}).eq("id",a[0].id);s&&console.error("Error actualizando URL de logo:",s)}}f.ZP.success("Aseguradora creada correctamente")}await F(),j(!1),C(null),U()}catch(e){console.error("Error guardando aseguradora:",e),f.ZP.error("Error guardando aseguradora")}},B=()=>{C(null),U(),j(!0)},Y=e=>{C(e),H({name:e.name,contact_person:e.contact_person,email:e.email,phone:e.phone,address:e.address||"",portal_url:e.portal_url||"",billing_terms:e.billing_terms||30,is_active:e.is_active}),z(null),T(e.logo_url||null),j(!0)},X=e=>{Z(e),w(!0)},K=e=>{Z(e),E(!0)},Q=async()=>{if(k)try{let e=a.filter(e=>e.id!==k.id);s(e),E(!1),Z(null),f.ZP.success("Aseguradora eliminada correctamente")}catch(e){f.ZP.error("Error eliminando aseguradora")}};return b?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Aseguradoras"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Gestiona las aseguradoras con las que trabajas."})]}),(0,r.jsxs)(n.zx,{onClick:B,className:"flex items-center space-x-2 w-full sm:w-auto",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Nueva Aseguradora"})]})]}),0===a.length?(0,r.jsx)(l.Zb,{children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(o.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,r.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No hay aseguradoras"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Comienza agregando tu primera aseguradora."}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsxs)(n.zx,{onClick:B,children:[(0,r.jsx)(i.Z,{className:"h-4 w-4 mr-2"}),"Nueva Aseguradora"]})})]})}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(e=>(0,r.jsx)(l.Zb,{children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200",children:[e.logo_url?(0,r.jsx)("img",{src:e.logo_url,alt:"Logo de ".concat(e.name),className:"w-full h-full object-cover",onError:e=>{var a;e.currentTarget.style.display="none",null===(a=e.currentTarget.nextElementSibling)||void 0===a||a.classList.remove("hidden")}}):null,(0,r.jsx)("div",{className:"w-full h-full bg-blue-100 flex items-center justify-center ".concat(e.logo_url?"hidden":""),children:(0,r.jsx)(o.Z,{className:"h-6 w-6 text-blue-600"})})]}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.contact_person})]})]}),(0,r.jsx)(n.Ct,{variant:e.is_active?"success":"gray",children:e.is_active?"Activa":"Inactiva"})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Tel\xe9fono:"})," ",e.phone]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Facturas:"})," ",e.bills_count]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)(n.zx,{variant:"outline",size:"sm",onClick:()=>X(e),className:"flex-1",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-1"}),"Ver"]}),(0,r.jsxs)(n.zx,{variant:"outline",size:"sm",onClick:()=>Y(e),className:"flex-1",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-1"}),"Editar"]}),(0,r.jsx)(n.zx,{variant:"outline",size:"sm",onClick:()=>K(e),className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(u.Z,{className:"h-4 w-4"})})]})]})},e.id))}),(0,r.jsx)(n.u_,{isOpen:y,onClose:()=>j(!1),title:I?"Editar Aseguradora":"Nueva Aseguradora",size:"lg",children:(0,r.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,r.jsx)(n.II,{label:"Nombre de la empresa",name:"name",value:G.name,onChange:W,required:!0}),(0,r.jsx)(n.II,{label:"Persona de contacto",name:"contact_person",value:G.contact_person,onChange:W,required:!0}),(0,r.jsx)(n.II,{label:"Email",name:"email",type:"email",value:G.email,onChange:W,required:!0}),(0,r.jsx)(n.II,{label:"Tel\xe9fono",name:"phone",value:G.phone,onChange:W}),(0,r.jsx)(n.II,{label:"Direcci\xf3n",name:"address",value:G.address,onChange:W}),(0,r.jsx)(n.II,{label:"Portal URL",name:"portal_url",value:G.portal_url,onChange:W,placeholder:"https://portal.aseguradora.com"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo de la Aseguradora"}),(A||(null==I?void 0:I.logo_url))&&(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("img",{src:A||(null==I?void 0:I.logo_url),alt:"Preview del logo",className:"w-20 h-20 object-cover rounded-lg border border-gray-300",onError:e=>{console.error("Error cargando imagen:",A||(null==I?void 0:I.logo_url)),e.currentTarget.style.display="none"},onLoad:()=>console.log("Imagen cargada correctamente:",A||(null==I?void 0:I.logo_url))}),(0,r.jsx)("button",{type:"button",onClick:()=>{A?(T(null),z(null)):(null==I?void 0:I.logo_url)&&(J(I.logo_url),T(null))},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,r.jsx)(m.Z,{className:"h-3 w-3"})})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let s=null===(a=e.target.files)||void 0===a?void 0:a[0];if(s){if(!s.type.startsWith("image/")){f.ZP.error("Por favor selecciona un archivo de imagen v\xe1lido");return}if(s.size>2097152){f.ZP.error("La imagen debe ser menor a 2MB");return}L(s),R(!0)}},className:"hidden",id:"logo-input"}),(0,r.jsxs)("label",{htmlFor:"logo-input",className:"flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),S?"Cambiar logo":"Seleccionar logo"]}),M&&(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Subiendo..."})]}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Formatos: JPG, PNG, GIF. M\xe1ximo 2MB"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"is_active",name:"is_active",checked:G.is_active,onChange:W,className:"rounded"}),(0,r.jsx)("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Aseguradora activa"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)(n.zx,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),(0,r.jsxs)(n.zx,{type:"submit",children:[I?"Actualizar":"Crear"," Aseguradora"]})]})]})}),(0,r.jsx)(n.u_,{isOpen:N,onClose:()=>w(!1),title:"Detalles de Aseguradora",size:"lg",children:k&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 pb-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-gray-200",children:[k.logo_url?(0,r.jsx)("img",{src:k.logo_url,alt:"Logo de ".concat(k.name),className:"w-full h-full object-cover",onError:e=>{var a;e.currentTarget.style.display="none",null===(a=e.currentTarget.nextElementSibling)||void 0===a||a.classList.remove("hidden")}}):null,(0,r.jsx)("div",{className:"w-full h-full bg-blue-100 flex items-center justify-center ".concat(k.logo_url?"hidden":""),children:(0,r.jsx)(o.Z,{className:"h-8 w-8 text-blue-600"})})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:k.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:k.contact_person}),(0,r.jsx)(n.Ct,{variant:k.is_active?"success":"gray",className:"mt-1",children:k.is_active?"Activa":"Inactiva"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:k.email||"No especificado"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:k.phone||"No especificado"})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Direcci\xf3n"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:k.address||"No especificada"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Portal URL"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:k.portal_url?(0,r.jsx)("a",{href:k.portal_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:k.portal_url}):"No especificado"})]})]})]}),(0,r.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xe9rminos de Facturaci\xf3n"}),(0,r.jsxs)("p",{className:"text-sm text-gray-900",children:[k.billing_terms||30," d\xedas"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Creaci\xf3n"}),(0,r.jsx)("p",{className:"text-sm text-gray-900",children:k.created_at?new Date(k.created_at).toLocaleDateString("es-ES"):"No disponible"})]})]})}),(0,r.jsx)("div",{className:"pt-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)(n.zx,{onClick:()=>Y(k),className:"flex-1",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Editar"]}),(0,r.jsxs)(n.zx,{onClick:()=>K(k),variant:"outline",className:"flex-1 text-red-600 hover:text-red-700",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})})]})}),(0,r.jsx)(n.u_,{isOpen:_,onClose:()=>E(!1),title:"Confirmar Eliminaci\xf3n",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("p",{className:"text-gray-600",children:["\xbfEst\xe1s seguro de que quieres eliminar la aseguradora"," ",(0,r.jsx)("strong",{children:null==k?void 0:k.name}),"?"]}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Esta acci\xf3n no se puede deshacer."}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)(n.zx,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),(0,r.jsxs)(n.zx,{variant:"danger",onClick:Q,children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]})}),P&&O&&(0,r.jsx)(p.v,{isOpen:P,onClose:()=>{R(!1),L(null)},onSave:e=>{let a=new File([e],"insurance-logo.jpg",{type:"image/jpeg"});z(a);let s=new FileReader;s.onload=e=>{var a;T(null===(a=e.target)||void 0===a?void 0:a.result)},s.readAsDataURL(a),R(!1),L(null)},imageFile:O})]})}},69379:function(e,a,s){"use strict";s.d(a,{C:function(){return l}});var r=s(57437);s(2265);var t=s(61994);function l(e){let{children:a,variant:s="gray",size:l="md",className:n}=e;return(0,r.jsx)("span",{className:(0,t.W)("inline-flex items-center font-medium rounded-full",{success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800",gray:"bg-gray-100 text-gray-800"}[s],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-xs"}[l],n),children:a})}},84226:function(e,a,s){"use strict";s.d(a,{z:function(){return l}});var r=s(57437);s(2265);var t=s(61994);function l(e){let{variant:a="primary",size:s="md",loading:l=!1,className:n,children:i,disabled:o,...c}=e;return(0,r.jsxs)("button",{className:(0,t.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[a],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s],(o||l)&&"opacity-50 cursor-not-allowed",n),disabled:o||l,...c,children:[l&&(0,r.jsx)("div",{className:"spinner mr-2"}),i]})}},99178:function(e,a,s){"use strict";s.d(a,{Ol:function(){return n},Zb:function(){return l},eW:function(){return i}});var r=s(57437);s(2265);var t=s(61994);function l(e){let{children:a,className:s}=e;return(0,r.jsx)("div",{className:(0,t.W)("card",s),children:a})}function n(e){let{children:a,className:s}=e;return(0,r.jsx)("div",{className:(0,t.W)("card-header",s),children:a})}function i(e){let{children:a,className:s}=e;return(0,r.jsx)("div",{className:(0,t.W)("card-body",s),children:a})}},96372:function(e,a,s){"use strict";s.d(a,{v:function(){return m}});var r=s(57437),t=s(2265),l=s(22574),n=s(84226),i=s(32489),o=s(41414),c=s(45802),d=s(43391),u=s(30401);function m(e){let{isOpen:a,onClose:s,onSave:m,imageFile:h,aspectRatio:x=1,title:g="Editar Imagen",circular:p=!1}=e,[f,b]=(0,t.useState)(),[v,y]=(0,t.useState)(),[j,N]=(0,t.useState)(1),[w,_]=(0,t.useState)(0),[E,I]=(0,t.useState)(""),C=(0,t.useRef)(null),k=(0,t.useRef)(null);t.useEffect(()=>{if(a&&h){let e=new FileReader;e.onload=e=>{var a;I(null===(a=e.target)||void 0===a?void 0:a.result)},e.readAsDataURL(h)}},[a,h]);let Z=(0,t.useCallback)(e=>{let{width:a,height:s}=e.currentTarget;b((0,l._H)((0,l.YG)({unit:"%",width:90},x,a,s),a,s))},[x]),S=(e,a)=>{let s=k.current;if(!s)throw Error("Canvas no disponible");let r=s.getContext("2d");if(!r)throw Error("Contexto 2D no disponible");let t=e.naturalWidth/e.width,l=e.naturalHeight/e.height,n=window.devicePixelRatio;return s.width=a.width*n*t,s.height=a.height*n*l,r.setTransform(n,0,0,n,0,0),r.imageSmoothingQuality="high",0!==w&&(r.translate(s.width/2,s.height/2),r.rotate(w*Math.PI/180),r.translate(-s.width/2,-s.height/2)),r.drawImage(e,a.x*t,a.y*l,a.width*t,a.height*l,0,0,s.width/n,s.height/n),new Promise(e=>{s.toBlob(a=>{a&&e(a)},"image/jpeg",.95)})},z=async()=>{if(C.current&&v)try{let e=await S(C.current,v);m(e),s()}catch(e){console.error("Error al procesar la imagen:",e)}};return a&&E?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:g}),(0,r.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,r.jsx)(i.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-4 p-4 border-b border-gray-200 bg-gray-50",children:[(0,r.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{_(e=>(e+90)%360)},className:"flex items-center",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Rotar"]}),(0,r.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{N(e=>Math.max(e-.1,.5))},className:"flex items-center",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Alejar"]}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[Math.round(100*j),"%"]}),(0,r.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{N(e=>Math.min(e+.1,3))},className:"flex items-center",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Acercar"]})]}),(0,r.jsx)("div",{className:"p-4 overflow-auto max-h-[60vh]",children:(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(l.ZP,{crop:f,onChange:(e,a)=>b(a),onComplete:e=>y(e),aspect:x,circularCrop:p,children:(0,r.jsx)("img",{ref:C,alt:"Crop me",src:E,style:{transform:"scale(".concat(j,") rotate(").concat(w,"deg)"),maxWidth:"100%",maxHeight:"400px"},onLoad:Z})})})}),(0,r.jsx)("canvas",{ref:k,style:{display:"none"}}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 p-4 border-t border-gray-200",children:[(0,r.jsx)(n.z,{variant:"secondary",onClick:s,children:"Cancelar"}),(0,r.jsxs)(n.z,{onClick:z,disabled:!v,className:"btn-primary flex items-center",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})}):null}s(83814)},38068:function(e,a,s){"use strict";s.d(a,{I:function(){return l}});var r=s(57437);s(2265);var t=s(61994);function l(e){let{label:a,error:s,helperText:l,className:n,id:i,...o}=e,c=i||"input-".concat(Math.random().toString(36).substr(2,9));return(0,r.jsxs)("div",{className:"w-full",children:[a&&(0,r.jsx)("label",{htmlFor:c,className:"form-label",children:a}),(0,r.jsx)("input",{id:c,className:(0,t.W)("form-input",s&&"border-red-300 focus:ring-red-500 focus:border-red-500",n),...o}),s&&(0,r.jsx)("p",{className:"form-error",children:s}),l&&!s&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:l})]})}},95998:function(e,a,s){"use strict";s.d(a,{u:function(){return i}});var r=s(57437),t=s(2265),l=s(61994),n=s(32489);function i(e){let{isOpen:a,onClose:s,title:i,children:o,size:c="md",className:d}=e;return((0,t.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a]),(0,t.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return a&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[a,s]),a)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:s}),(0,r.jsxs)("div",{className:(0,l.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[c],d),children:[i&&(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i}),(0,r.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(n.Z,{className:"w-6 h-6"})})]}),(0,r.jsx)("div",{className:"p-6",children:o})]})]})}):null}},95930:function(e,a,s){"use strict";s.d(a,{iA:function(){return l}});var r=s(57437);s(2265);var t=s(61994);function l(e){let{children:a,className:s}=e;return(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsx)("table",{className:(0,t.W)("table",s),children:a})})}},62953:function(e,a,s){"use strict";s.d(a,{Ct:function(){return l.C},II:function(){return n.I},Zb:function(){return r.Zb},u_:function(){return i.u},zx:function(){return t.z}});var r=s(99178),t=s(84226),l=s(69379),n=s(38068),i=s(95998);s(95930),s(96372)},46281:function(e,a,s){"use strict";s.d(a,{AuthProvider:function(){return c},a:function(){return d}});var r=s(57437),t=s(2265),l=s(2141),n=s(69064),i=s(26098);let o=(0,t.createContext)(void 0);function c(e){let{children:a}=e,[s,c]=(0,t.useState)(null),[d,u]=(0,t.useState)(null),[m,h]=(0,t.useState)(null),[x,g]=(0,t.useState)(!0),p=async e=>{try{if(d&&d.id===e){(0,i.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,i.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:r,error:t}=await l.supabase.from("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(t){console.warn("⚠️ Could not load user profile:",t.message);let e=(await l.supabase.auth.getUser()).data.user;if(e){var a,s;u({id:e.id,email:e.email,first_name:null===(a=e.user_metadata)||void 0===a?void 0:a.first_name,last_name:null===(s=e.user_metadata)||void 0===s?void 0:s.last_name})}return}(0,i.wH)("debug","✅ User profile loaded successfully"),u(r),h(r.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,t.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:a}}=await l.supabase.auth.getSession();(null==a?void 0:a.user)&&e&&(c(a.user),await p(a.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&g(!1)}})();let{data:{subscription:a}}=l.supabase.auth.onAuthStateChange(async(e,a)=>{var s;(0,i.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==a?void 0:null===(s=a.user)||void 0===s?void 0:s.id),"SIGNED_OUT"===e?(c(null),u(null),h(null),n.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==a?void 0:a.user)?(c(a.user),d&&d.id===a.user.id||await p(a.user.id)):"TOKEN_REFRESHED"===e&&(0,i.wH)("debug","\uD83D\uDD04 Token refreshed successfully")}),r=setInterval(async()=>{if(e&&s)try{let{data:{session:e},error:a}=await l.supabase.auth.getSession();(a||!e)&&((0,i.wH)("info","\uD83D\uDD04 Session expired, signing out..."),c(null),u(null),h(null),n.ZP.error("Sesi\xf3n expirada. Por favor, inicia sesi\xf3n nuevamente."))}catch(e){console.warn("⚠️ Error checking session:",e)}},i.ob.SESSION.CHECK_INTERVAL);return()=>{e=!1,a.unsubscribe(),clearInterval(r)}},[]);let f=async(e,a)=>{let{data:s,error:r}=await l.supabase.auth.signInWithPassword({email:e,password:a});if(r)throw r;return s},b=async(e,a,s)=>{let{data:r,error:t}=await l.supabase.auth.signUp({email:e,password:a,options:{data:s}});if(t)throw t;return r},v=async()=>{await l.supabase.auth.signOut()},y=async e=>{if(!s)throw Error("Usuario no autenticado");let{error:a}=await l.supabase.from("users").update(e).eq("id",s.id);if(a)throw a;await p(s.id)};return(0,r.jsx)(o.Provider,{value:{user:s,profile:d,company:m,loading:x,signIn:f,signUp:b,signOut:v,updateProfile:y},children:a})}function d(){let e=(0,t.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26098:function(e,a,s){"use strict";s.d(a,{ob:function(){return r},wH:function(){return t}});let r={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},t=function(e){for(var a=arguments.length,s=Array(a>1?a-1:0),t=1;t<a;t++)s[t-1]=arguments[t];if(!r.LOGGING.ENABLED)return;let l=["debug","info","warn","error"];l.indexOf(e)>=l.indexOf(r.LOGGING.MIN_LEVEL)&&console[e](...s)}},2141:function(e,a,s){"use strict";s.r(a),s.d(a,{supabase:function(){return n},supabaseAdmin:function(){return i}});var r=s(63887);let t="https://pbdsuhmwxqiwbpgyrhqt.supabase.co";function l(e,a,s){return(0,r.eI)(e,a,{...s,auth:{...s.auth,storage:window.localStorage,storageKey:"supabase.auth.token",flowType:"pkce",debug:!1,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}let{supabase:n,supabaseAdmin:i}=function(){if(!globalThis.__supabaseInitialized){if(globalThis.__supabase)try{var e,a;null===(e=(a=globalThis.__supabase).removeAllChannels)||void 0===e||e.call(a)}catch(e){}globalThis.__supabase=l(t,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),globalThis.__supabaseAdmin=l(t,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",{auth:{persistSession:!1,autoRefreshToken:!1}}),globalThis.__supabaseInitialized=!0}return{supabase:globalThis.__supabase,supabaseAdmin:globalThis.__supabaseAdmin}}()},98420:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(39763).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},42208:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(39763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},94630:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(39763).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},99397:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(39763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},18930:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(39763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},17689:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(39763).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])}},function(e){e.O(0,[5558,8829,3926,2971,2117,1744],function(){return e(e.s=4650)}),_N_E=e.O()}]);