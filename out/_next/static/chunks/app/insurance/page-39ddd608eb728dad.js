(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4525],{4650:function(e,a,r){Promise.resolve().then(r.bind(r,28056))},28056:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return b}});var s=r(57437),t=r(2265),l=r(99178),n=r(62953),i=r(99397),o=r(98420),c=r(42208),d=r(94630),u=r(18930),m=r(32489),h=r(17689),x=r(46281),g=r(2141),p=r(96372),f=r(69064);function b(){let{company:e}=(0,x.a)(),[a,r]=(0,t.useState)([]),[b,v]=(0,t.useState)(!0),[y,j]=(0,t.useState)(!1),[N,w]=(0,t.useState)(!1),[_,E]=(0,t.useState)(!1),[I,C]=(0,t.useState)(null),[k,Z]=(0,t.useState)(null),[S,A]=(0,t.useState)(null),[T,z]=(0,t.useState)(null),[M,L]=(0,t.useState)(!1),[O,P]=(0,t.useState)(null),[D,U]=(0,t.useState)(!1),[R,G]=(0,t.useState)({name:"",contact_person:"",email:"",phone:"",address:"",portal_url:"",billing_terms:30,is_active:!0}),H=()=>{G({name:"",contact_person:"",email:"",phone:"",address:"",portal_url:"",billing_terms:30,is_active:!0}),A(null),z(null)};(0,t.useEffect)(()=>{F()},[]);let F=async()=>{try{if(v(!0),!e){console.error("No company found");return}let{data:a,error:s}=await g.supabase.from("insurance_companies").select("*").eq("company_id",e.id).order("name",{ascending:!0});if(s)throw s;r(a||[])}catch(e){console.error("Error loading companies:",e),f.ZP.error("Error cargando aseguradoras")}finally{v(!1)}},q=async(a,r)=>{if(!S||!(null==e?void 0:e.id))return null;try{var s;L(!0);let a=S.name.split(".").pop(),t=(null===(s=e.name)||void 0===s?void 0:s.replace(/[^a-zA-Z0-9]/g,""))||"Empresa",l=r.replace(/[^a-zA-Z0-9]/g,"")||"Aseguradora",n="".concat(t,"_").concat(l,".").concat(a),i="logo/".concat(e.id,"/").concat(n),{data:o,error:c}=await g.supabase.storage.from("profile-photos").upload(i,S,{cacheControl:"3600",upsert:!0});if(c)return console.error("Error uploading logo:",c),f.ZP.error("Error al subir el logo"),null;let{data:d}=await g.supabase.storage.from("profile-photos").createSignedUrl(i,31536e3);if(d)return d.signedUrl;return null}catch(e){return console.error("Error uploading logo:",e),f.ZP.error("Error al subir el logo"),null}finally{L(!1)}},J=async e=>{try{let a="";if(e.includes("/storage/v1/object/public/profile-photos/")?a=e.split("/storage/v1/object/public/profile-photos/")[1]||"":e.includes("/storage/v1/object/sign/profile-photos/")&&(a=e.split("/storage/v1/object/sign/profile-photos/")[1]||""),a){let{error:e}=await g.supabase.storage.from("profile-photos").remove([a]);e&&console.error("Error eliminando logo:",e)}else console.error("No se pudo extraer el path del archivo de la URL:",e)}catch(e){console.error("Error eliminando logo del storage:",e)}},B=e=>{let{name:a,value:r,type:s}=e.target;G(t=>({...t,[a]:"checkbox"===s?e.target.checked:r}))},W=async a=>{a.preventDefault();try{if(!e){f.ZP.error("No se encontr\xf3 informaci\xf3n de la empresa");return}if(I){let a={name:R.name,contact_person:R.contact_person,email:R.email,phone:R.phone,address:R.address,portal_url:R.portal_url,billing_terms:R.billing_terms,is_active:R.is_active};if(S){I.logo_url&&await J(I.logo_url);let e=await q(I.id,R.name);e&&(a.logo_url=e)}let{error:r}=await (0,g.supabaseTable)("insurance_companies").update(a).eq("id",I.id).eq("company_id",e.id);if(r)throw r;f.ZP.success("Aseguradora actualizada correctamente")}else{let{data:a,error:r}=await (0,g.supabaseTable)("insurance_companies").insert({company_id:e.id,name:R.name,contact_person:R.contact_person,email:R.email,phone:R.phone,address:R.address,portal_url:R.portal_url,billing_terms:R.billing_terms,is_active:R.is_active}).select();if(r)throw r;if(S&&a&&a[0]){let e=await q(a[0].id,R.name);if(e){let{error:r}=await (0,g.supabaseTable)("insurance_companies").update({logo_url:e}).eq("id",a[0].id);r&&console.error("Error actualizando URL de logo:",r)}}f.ZP.success("Aseguradora creada correctamente")}await F(),j(!1),C(null),H()}catch(e){console.error("Error guardando aseguradora:",e),f.ZP.error("Error guardando aseguradora")}},V=()=>{C(null),H(),j(!0)},Y=e=>{C(e),G({name:e.name,contact_person:e.contact_person,email:e.email,phone:e.phone,address:e.address||"",portal_url:e.portal_url||"",billing_terms:e.billing_terms||30,is_active:e.is_active}),A(null),z(e.logo_url||null),j(!0)},X=e=>{Z(e),w(!0)},K=e=>{Z(e),E(!0)},Q=async()=>{if(k)try{let e=a.filter(e=>e.id!==k.id);r(e),E(!1),Z(null),f.ZP.success("Aseguradora eliminada correctamente")}catch(e){f.ZP.error("Error eliminando aseguradora")}};return b?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Aseguradoras"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Gestiona las aseguradoras con las que trabajas."})]}),(0,s.jsxs)(n.zx,{onClick:V,className:"flex items-center space-x-2 w-full sm:w-auto",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Nueva Aseguradora"})]})]}),0===a.length?(0,s.jsx)(l.Zb,{children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(o.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No hay aseguradoras"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Comienza agregando tu primera aseguradora."}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsxs)(n.zx,{onClick:V,children:[(0,s.jsx)(i.Z,{className:"h-4 w-4 mr-2"}),"Nueva Aseguradora"]})})]})}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(e=>(0,s.jsx)(l.Zb,{children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200",children:[e.logo_url?(0,s.jsx)("img",{src:e.logo_url,alt:"Logo de ".concat(e.name),className:"w-full h-full object-cover",onError:e=>{var a;e.currentTarget.style.display="none",null===(a=e.currentTarget.nextElementSibling)||void 0===a||a.classList.remove("hidden")}}):null,(0,s.jsx)("div",{className:"w-full h-full bg-blue-100 flex items-center justify-center ".concat(e.logo_url?"hidden":""),children:(0,s.jsx)(o.Z,{className:"h-6 w-6 text-blue-600"})})]}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.contact_person})]})]}),(0,s.jsx)(n.Ct,{variant:e.is_active?"success":"gray",children:e.is_active?"Activa":"Inactiva"})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Tel\xe9fono:"})," ",e.phone]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Facturas:"})," ",e.bills_count]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)(n.zx,{variant:"outline",size:"sm",onClick:()=>X(e),className:"flex-1",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4 mr-1"}),"Ver"]}),(0,s.jsxs)(n.zx,{variant:"outline",size:"sm",onClick:()=>Y(e),className:"flex-1",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4 mr-1"}),"Editar"]}),(0,s.jsx)(n.zx,{variant:"outline",size:"sm",onClick:()=>K(e),className:"text-red-600 hover:text-red-700",children:(0,s.jsx)(u.Z,{className:"h-4 w-4"})})]})]})},e.id))}),(0,s.jsx)(n.u_,{isOpen:y,onClose:()=>j(!1),title:I?"Editar Aseguradora":"Nueva Aseguradora",size:"lg",children:(0,s.jsxs)("form",{onSubmit:W,className:"space-y-4",children:[(0,s.jsx)(n.II,{label:"Nombre de la empresa",name:"name",value:R.name,onChange:B,required:!0}),(0,s.jsx)(n.II,{label:"Persona de contacto",name:"contact_person",value:R.contact_person,onChange:B,required:!0}),(0,s.jsx)(n.II,{label:"Email",name:"email",type:"email",value:R.email,onChange:B,required:!0}),(0,s.jsx)(n.II,{label:"Tel\xe9fono",name:"phone",value:R.phone,onChange:B}),(0,s.jsx)(n.II,{label:"Direcci\xf3n",name:"address",value:R.address,onChange:B}),(0,s.jsx)(n.II,{label:"Portal URL",name:"portal_url",value:R.portal_url,onChange:B,placeholder:"https://portal.aseguradora.com"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo de la Aseguradora"}),(T||(null==I?void 0:I.logo_url))&&(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsx)("img",{src:T||(null==I?void 0:I.logo_url),alt:"Preview del logo",className:"w-20 h-20 object-cover rounded-lg border border-gray-300",onError:e=>{console.error("Error cargando imagen:",T||(null==I?void 0:I.logo_url)),e.currentTarget.style.display="none"},onLoad:()=>console.log("Imagen cargada correctamente:",T||(null==I?void 0:I.logo_url))}),(0,s.jsx)("button",{type:"button",onClick:()=>{T?(z(null),A(null)):(null==I?void 0:I.logo_url)&&(J(I.logo_url),z(null))},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,s.jsx)(m.Z,{className:"h-3 w-3"})})]})}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let r=null===(a=e.target.files)||void 0===a?void 0:a[0];if(r){if(!r.type.startsWith("image/")){f.ZP.error("Por favor selecciona un archivo de imagen v\xe1lido");return}if(r.size>2097152){f.ZP.error("La imagen debe ser menor a 2MB");return}P(r),U(!0)}},className:"hidden",id:"logo-input"}),(0,s.jsxs)("label",{htmlFor:"logo-input",className:"flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),S?"Cambiar logo":"Seleccionar logo"]}),M&&(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Subiendo..."})]}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Formatos: JPG, PNG, GIF. M\xe1ximo 2MB"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"is_active",name:"is_active",checked:R.is_active,onChange:B,className:"rounded"}),(0,s.jsx)("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Aseguradora activa"})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)(n.zx,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),(0,s.jsxs)(n.zx,{type:"submit",children:[I?"Actualizar":"Crear"," Aseguradora"]})]})]})}),(0,s.jsx)(n.u_,{isOpen:N,onClose:()=>w(!1),title:"Detalles de Aseguradora",size:"lg",children:k&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 pb-4 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-gray-200",children:[k.logo_url?(0,s.jsx)("img",{src:k.logo_url,alt:"Logo de ".concat(k.name),className:"w-full h-full object-cover",onError:e=>{var a;e.currentTarget.style.display="none",null===(a=e.currentTarget.nextElementSibling)||void 0===a||a.classList.remove("hidden")}}):null,(0,s.jsx)("div",{className:"w-full h-full bg-blue-100 flex items-center justify-center ".concat(k.logo_url?"hidden":""),children:(0,s.jsx)(o.Z,{className:"h-8 w-8 text-blue-600"})})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:k.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:k.contact_person}),(0,s.jsx)(n.Ct,{variant:k.is_active?"success":"gray",className:"mt-1",children:k.is_active?"Activa":"Inactiva"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:k.email||"No especificado"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:k.phone||"No especificado"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Direcci\xf3n"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:k.address||"No especificada"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Portal URL"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:k.portal_url?(0,s.jsx)("a",{href:k.portal_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:k.portal_url}):"No especificado"})]})]})]}),(0,s.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xe9rminos de Facturaci\xf3n"}),(0,s.jsxs)("p",{className:"text-sm text-gray-900",children:[k.billing_terms||30," d\xedas"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Creaci\xf3n"}),(0,s.jsx)("p",{className:"text-sm text-gray-900",children:k.created_at?new Date(k.created_at).toLocaleDateString("es-ES"):"No disponible"})]})]})}),(0,s.jsx)("div",{className:"pt-4 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsxs)(n.zx,{onClick:()=>Y(k),className:"flex-1",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Editar"]}),(0,s.jsxs)(n.zx,{onClick:()=>K(k),variant:"outline",className:"flex-1 text-red-600 hover:text-red-700",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})})]})}),(0,s.jsx)(n.u_,{isOpen:_,onClose:()=>E(!1),title:"Confirmar Eliminaci\xf3n",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("p",{className:"text-gray-600",children:["\xbfEst\xe1s seguro de que quieres eliminar la aseguradora"," ",(0,s.jsx)("strong",{children:null==k?void 0:k.name}),"?"]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Esta acci\xf3n no se puede deshacer."}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)(n.zx,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),(0,s.jsxs)(n.zx,{variant:"danger",onClick:Q,children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]})}),D&&O&&(0,s.jsx)(p.v,{isOpen:D,onClose:()=>{U(!1),P(null)},onSave:e=>{let a=new File([e],"insurance-logo.jpg",{type:"image/jpeg"});A(a);let r=new FileReader;r.onload=e=>{var a;z(null===(a=e.target)||void 0===a?void 0:a.result)},r.readAsDataURL(a),U(!1),P(null)},imageFile:O})]})}},69379:function(e,a,r){"use strict";r.d(a,{C:function(){return l}});var s=r(57437);r(2265);var t=r(61994);function l(e){let{children:a,variant:r="gray",size:l="md",className:n}=e;return(0,s.jsx)("span",{className:(0,t.W)("inline-flex items-center font-medium rounded-full",{success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800",gray:"bg-gray-100 text-gray-800"}[r],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-xs"}[l],n),children:a})}},84226:function(e,a,r){"use strict";r.d(a,{z:function(){return l}});var s=r(57437);r(2265);var t=r(61994);function l(e){let{variant:a="primary",size:r="md",loading:l=!1,className:n,children:i,disabled:o,...c}=e;return(0,s.jsxs)("button",{className:(0,t.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[a],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[r],(o||l)&&"opacity-50 cursor-not-allowed",n),disabled:o||l,...c,children:[l&&(0,s.jsx)("div",{className:"spinner mr-2"}),i]})}},99178:function(e,a,r){"use strict";r.d(a,{Ol:function(){return n},Zb:function(){return l},eW:function(){return i}});var s=r(57437);r(2265);var t=r(61994);function l(e){let{children:a,className:r}=e;return(0,s.jsx)("div",{className:(0,t.W)("card",r),children:a})}function n(e){let{children:a,className:r}=e;return(0,s.jsx)("div",{className:(0,t.W)("card-header",r),children:a})}function i(e){let{children:a,className:r}=e;return(0,s.jsx)("div",{className:(0,t.W)("card-body",r),children:a})}},96372:function(e,a,r){"use strict";r.d(a,{v:function(){return m}});var s=r(57437),t=r(2265),l=r(22574),n=r(84226),i=r(32489),o=r(41414),c=r(45802),d=r(43391),u=r(30401);function m(e){let{isOpen:a,onClose:r,onSave:m,imageFile:h,aspectRatio:x=1,title:g="Editar Imagen",circular:p=!1}=e,[f,b]=(0,t.useState)(),[v,y]=(0,t.useState)(),[j,N]=(0,t.useState)(1),[w,_]=(0,t.useState)(0),[E,I]=(0,t.useState)(""),C=(0,t.useRef)(null),k=(0,t.useRef)(null);t.useEffect(()=>{if(a&&h){let e=new FileReader;e.onload=e=>{var a;I(null===(a=e.target)||void 0===a?void 0:a.result)},e.readAsDataURL(h)}},[a,h]);let Z=(0,t.useCallback)(e=>{let{width:a,height:r}=e.currentTarget;b((0,l._H)((0,l.YG)({unit:"%",width:90},x,a,r),a,r))},[x]),S=(e,a)=>{let r=k.current;if(!r)throw Error("Canvas no disponible");let s=r.getContext("2d");if(!s)throw Error("Contexto 2D no disponible");let t=e.naturalWidth/e.width,l=e.naturalHeight/e.height,n=window.devicePixelRatio;return r.width=a.width*n*t,r.height=a.height*n*l,s.setTransform(n,0,0,n,0,0),s.imageSmoothingQuality="high",0!==w&&(s.translate(r.width/2,r.height/2),s.rotate(w*Math.PI/180),s.translate(-r.width/2,-r.height/2)),s.drawImage(e,a.x*t,a.y*l,a.width*t,a.height*l,0,0,r.width/n,r.height/n),new Promise(e=>{r.toBlob(a=>{a&&e(a)},"image/jpeg",.95)})},A=async()=>{if(C.current&&v)try{let e=await S(C.current,v);m(e),r()}catch(e){console.error("Error al procesar la imagen:",e)}};return a&&E?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:g}),(0,s.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,s.jsx)(i.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-4 p-4 border-b border-gray-200 bg-gray-50",children:[(0,s.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{_(e=>(e+90)%360)},className:"flex items-center",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Rotar"]}),(0,s.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{N(e=>Math.max(e-.1,.5))},className:"flex items-center",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Alejar"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[Math.round(100*j),"%"]}),(0,s.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{N(e=>Math.min(e+.1,3))},className:"flex items-center",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Acercar"]})]}),(0,s.jsx)("div",{className:"p-4 overflow-auto max-h-[60vh]",children:(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(l.ZP,{crop:f,onChange:(e,a)=>b(a),onComplete:e=>y(e),aspect:x,circularCrop:p,children:(0,s.jsx)("img",{ref:C,alt:"Crop me",src:E,style:{transform:"scale(".concat(j,") rotate(").concat(w,"deg)"),maxWidth:"100%",maxHeight:"400px"},onLoad:Z})})})}),(0,s.jsx)("canvas",{ref:k,style:{display:"none"}}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 p-4 border-t border-gray-200",children:[(0,s.jsx)(n.z,{variant:"secondary",onClick:r,children:"Cancelar"}),(0,s.jsxs)(n.z,{onClick:A,disabled:!v,className:"btn-primary flex items-center",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})}):null}r(83814)},38068:function(e,a,r){"use strict";r.d(a,{I:function(){return l}});var s=r(57437);r(2265);var t=r(61994);function l(e){let{label:a,error:r,helperText:l,className:n,id:i,...o}=e,c=i||"input-".concat(Math.random().toString(36).substr(2,9));return(0,s.jsxs)("div",{className:"w-full",children:[a&&(0,s.jsxs)("label",{htmlFor:c,className:"form-label",children:[a,o.required&&(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsx)("input",{id:c,className:(0,t.W)("form-input",r&&"border-red-300 focus:ring-red-500 focus:border-red-500",n),...o}),r&&(0,s.jsx)("p",{className:"form-error",children:r}),l&&!r&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:l})]})}},95998:function(e,a,r){"use strict";r.d(a,{u:function(){return i}});var s=r(57437),t=r(2265),l=r(61994),n=r(32489);function i(e){let{isOpen:a,onClose:r,title:i,children:o,size:c="md",className:d}=e;return((0,t.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a]),(0,t.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return a&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[a,r]),a)?(0,s.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,s.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:r}),(0,s.jsxs)("div",{className:(0,l.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[c],d),children:[i&&(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i}),(0,s.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,s.jsx)(n.Z,{className:"w-6 h-6"})})]}),(0,s.jsx)("div",{className:"p-6",children:o})]})]})}):null}},95930:function(e,a,r){"use strict";r.d(a,{iA:function(){return l}});var s=r(57437);r(2265);var t=r(61994);function l(e){let{children:a,className:r}=e;return(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)("table",{className:(0,t.W)("table",r),children:a})})}},62953:function(e,a,r){"use strict";r.d(a,{Ct:function(){return l.C},II:function(){return n.I},Zb:function(){return s.Zb},u_:function(){return i.u},zx:function(){return t.z}});var s=r(99178),t=r(84226),l=r(69379),n=r(38068),i=r(95998);r(95930),r(96372)},46281:function(e,a,r){"use strict";r.d(a,{AuthProvider:function(){return c},a:function(){return d}});var s=r(57437),t=r(2265),l=r(2141),n=r(69064),i=r(26098);let o=(0,t.createContext)(void 0);function c(e){let{children:a}=e,[r,c]=(0,t.useState)(null),[d,u]=(0,t.useState)(null),[m,h]=(0,t.useState)(null),[x,g]=(0,t.useState)(!0),p=async e=>{try{if(d&&d.id===e){(0,i.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,i.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:s,error:t}=await (0,l.supabaseTable)("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(t){console.warn("⚠️ Could not load user profile:",t.message);let e=(await l.supabase.auth.getUser()).data.user;if(e){var a,r;u({id:e.id,email:e.email,first_name:null===(a=e.user_metadata)||void 0===a?void 0:a.first_name,last_name:null===(r=e.user_metadata)||void 0===r?void 0:r.last_name})}return}(0,i.wH)("debug","✅ User profile loaded successfully"),u(s),h(s.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,t.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:a}}=await l.supabase.auth.getSession();(null==a?void 0:a.user)&&e&&(c(a.user),await p(a.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&g(!1)}})();let{data:{subscription:a}}=l.supabase.auth.onAuthStateChange(async(e,a)=>{var r;(0,i.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==a?void 0:null===(r=a.user)||void 0===r?void 0:r.id),"SIGNED_OUT"===e?(c(null),u(null),h(null),n.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==a?void 0:a.user)?(c(a.user),d&&d.id===a.user.id||await p(a.user.id)):"TOKEN_REFRESHED"===e&&(0,i.wH)("debug","\uD83D\uDD04 Token refreshed successfully")});return()=>{e=!1,a.unsubscribe()}},[]);let f=async(e,a)=>{let{data:r,error:s}=await l.supabase.auth.signInWithPassword({email:e,password:a});if(s)throw s;return r},b=async(e,a,r)=>{let{data:s,error:t}=await l.supabase.auth.signUp({email:e,password:a,options:{data:r}});if(t)throw t;return s},v=async()=>{await l.supabase.auth.signOut()},y=async e=>{if(!r)throw Error("Usuario no autenticado");let{error:a}=await (0,l.supabaseTable)("users").update(e).eq("id",r.id);if(a)throw a;await p(r.id)};return(0,s.jsx)(o.Provider,{value:{user:r,profile:d,company:m,loading:x,signIn:f,signUp:b,signOut:v,updateProfile:y},children:a})}function d(){let e=(0,t.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26098:function(e,a,r){"use strict";r.d(a,{ob:function(){return s},wH:function(){return t}});let s={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},t=function(e){for(var a=arguments.length,r=Array(a>1?a-1:0),t=1;t<a;t++)r[t-1]=arguments[t];if(!s.LOGGING.ENABLED)return;let l=["debug","info","warn","error"];l.indexOf(e)>=l.indexOf(s.LOGGING.MIN_LEVEL)&&console[e](...r)}},2141:function(e,a,r){"use strict";r.r(a),r.d(a,{supabase:function(){return m},supabaseAdmin:function(){return h},supabaseAdminTable:function(){return g},supabaseTable:function(){return x}});var s,t,l,n,i=r(63887),o=r(40257);let c=o.env.NEXT_PUBLIC_SUPABASE_URL||"https://pbdsuhmwxqiwbpgyrhqt.supabase.co",d=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",u=o.env.NEXT_PUBLIC_SUPABASE_SERVICE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",m=null!==(l=(s=globalThis).__supabaseClient)&&void 0!==l?l:s.__supabaseClient=(0,i.eI)(c,d,{auth:{flowType:"pkce",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"supabase.auth.token"}}),h=null!==(n=(t=globalThis).__supabaseAdminClient)&&void 0!==n?n:t.__supabaseAdminClient=(0,i.eI)(c,u,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storageKey:"supabase.admin.token"}}),x=e=>m.from(e),g=e=>h.from(e)},98420:function(e,a,r){"use strict";r.d(a,{Z:function(){return s}});let s=(0,r(39763).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},42208:function(e,a,r){"use strict";r.d(a,{Z:function(){return s}});let s=(0,r(39763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},94630:function(e,a,r){"use strict";r.d(a,{Z:function(){return s}});let s=(0,r(39763).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},99397:function(e,a,r){"use strict";r.d(a,{Z:function(){return s}});let s=(0,r(39763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},18930:function(e,a,r){"use strict";r.d(a,{Z:function(){return s}});let s=(0,r(39763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},17689:function(e,a,r){"use strict";r.d(a,{Z:function(){return s}});let s=(0,r(39763).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])}},function(e){e.O(0,[5558,8829,3926,2971,2117,1744],function(){return e(e.s=4650)}),_N_E=e.O()}]);