(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7702],{79121:function(e,s,t){Promise.resolve().then(t.bind(t,23137))},23137:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var a=t(57437),n=t(2265),i=t(62953),l=t(43044),c=t(95805),r=t(95252),d=t(70525),o=t(46221),m=t(29525),x=t(2141);async function u(){try{var e;let s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s.getFullYear(),s.getMonth()+1,0),[n,i,l,c,r,d]=await Promise.all([x.supabase.from("jobs").select("id",{count:"exact"}).in("status",["pending","in_progress","scheduled"]),x.supabase.from("clients").select("id",{count:"exact"}),x.supabase.from("invoices").select("total_amount").eq("status","paid").gte("paid_date",t.toISOString()).lt("paid_date",a.toISOString()),x.supabase.from("estimates").select("id",{count:"exact"}).eq("status","pending"),x.supabase.from("technicians").select("id",{count:"exact"}).eq("is_active",!0),x.supabase.from("appointments").select("id",{count:"exact"}).eq("status","scheduled").gte("scheduled_date",new Date().toISOString()).lte("scheduled_date",new Date(Date.now()+6048e5).toISOString())]);if(n.error)return console.error("Error fetching jobs:",n.error),null;if(i.error)return console.error("Error fetching clients:",i.error),null;if(l.error)return console.error("Error fetching revenue:",l.error),null;if(c.error)return console.error("Error fetching estimates:",c.error),null;if(r.error)return console.error("Error fetching technicians:",r.error),null;if(d.error)return console.error("Error fetching appointments:",d.error),null;let o=(null===(e=l.data)||void 0===e?void 0:e.reduce((e,s)=>e+(s.total_amount||0),0))||0;return{activeJobs:n.count||0,totalClients:i.count||0,monthlyRevenue:o,pendingEstimates:c.count||0,totalTechnicians:r.count||0,upcomingAppointments:d.count||0}}catch(e){return console.error("Error fetching dashboard stats:",e),null}}async function h(){try{let[e,s,t]=await Promise.all([x.supabase.from("jobs").select("\n          id,\n          title,\n          status,\n          created_at,\n          client:clients(first_name, last_name)\n        ").order("created_at",{ascending:!1}).limit(3),x.supabase.from("estimates").select("\n          id,\n          title,\n          status,\n          total_amount,\n          created_at,\n          client:clients(first_name, last_name)\n        ").order("created_at",{ascending:!1}).limit(3),x.supabase.from("invoices").select("\n          id,\n          invoice_number,\n          status,\n          total_amount,\n          created_at,\n          client:clients(first_name, last_name)\n        ").order("created_at",{ascending:!1}).limit(3)]);return[...(e.data||[]).map(e=>({id:e.id,type:"job",title:e.title,status:e.status,amount:null,client:e.client?"".concat(e.client.first_name," ").concat(e.client.last_name):"Sin cliente",created_at:e.created_at})),...(s.data||[]).map(e=>({id:e.id,type:"estimate",title:e.title,status:e.status,amount:e.total_amount,client:e.client?"".concat(e.client.first_name," ").concat(e.client.last_name):"Sin cliente",created_at:e.created_at})),...(t.data||[]).map(e=>({id:e.id,type:"invoice",title:"Factura ".concat(e.invoice_number),status:e.status,amount:e.total_amount,client:e.client?"".concat(e.client.first_name," ").concat(e.client.last_name):"Sin cliente",created_at:e.created_at}))].sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,5)}catch(e){return console.error("Error fetching recent activity:",e),[]}}var j=t(99376),p=t(69064);function g(){let e=(0,j.useRouter)(),[s,t]=(0,n.useState)({activeJobs:0,totalClients:0,monthlyRevenue:0,pendingEstimates:0,totalTechnicians:0,upcomingAppointments:0}),[x,g]=(0,n.useState)([]),[N,f]=(0,n.useState)(!0);(0,n.useEffect)(()=>{b()},[]);let b=async()=>{try{f(!0);let[e,s]=await Promise.all([u(),h()]);e&&t(e),g(s)}catch(e){console.error("Error loading dashboard data:",e)}finally{f(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Vista general de tu empresa"})]}),(0,a.jsx)(i.zx,{onClick:b,disabled:N,children:N?"Cargando...":"Actualizar"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(i.Zb,{children:(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(l.Z,{className:"h-6 w-6 text-blue-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Trabajos Activos"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:N?"...":s.activeJobs})]})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(c.Z,{className:"h-6 w-6 text-green-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Clientes"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:N?"...":s.totalClients})]})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,a.jsx)(r.Z,{className:"h-6 w-6 text-purple-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Ingresos Este Mes"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:N?"...":"€".concat(s.monthlyRevenue.toLocaleString("es-ES"))})]})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-orange-100 rounded-lg",children:(0,a.jsx)(d.Z,{className:"h-6 w-6 text-orange-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Presupuestos Pendientes"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:N?"...":s.pendingEstimates})]})]})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsx)(i.Zb,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Actividad Reciente"}),N?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):0===x.length?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No hay actividad reciente"})}):(0,a.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,a.jsxs)("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"p-2 rounded-full ".concat("job"===e.type?"bg-blue-100":"estimate"===e.type?"bg-orange-100":"bg-green-100"),children:"job"===e.type?(0,a.jsx)(l.Z,{className:"h-4 w-4 text-blue-600"}):"estimate"===e.type?(0,a.jsx)(d.Z,{className:"h-4 w-4 text-orange-600"}):(0,a.jsx)(r.Z,{className:"h-4 w-4 text-green-600"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"job"===e.type?"Trabajo":"estimate"===e.type?"Presupuesto":"Factura"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.title," - ",e.client]})]}),(0,a.jsx)("div",{className:"ml-auto text-xs text-gray-500",children:e.amount?"€".concat(e.amount.toLocaleString()):""})]},e.id))})]})}),(0,a.jsx)(i.Zb,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Estado General"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:N?"...":s.totalTechnicians}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"T\xe9cnicos Activos"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-orange-600",children:N?"...":s.upcomingAppointments}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Citas Pr\xf3ximas"})]})]})]})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(i.Zb,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Acciones R\xe1pidas"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(i.zx,{className:"w-full justify-start",onClick:()=>{e.push("/jobs"),p.ZP.success("Redirigiendo a Trabajos...")},disabled:N,children:[(0,a.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Nuevo Trabajo"]}),(0,a.jsxs)(i.zx,{className:"w-full justify-start",variant:"outline",onClick:()=>{e.push("/clients"),p.ZP.success("Redirigiendo a Clientes...")},disabled:N,children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Agregar Cliente"]}),(0,a.jsxs)(i.zx,{className:"w-full justify-start",variant:"outline",onClick:()=>{e.push("/reports"),p.ZP.success("Redirigiendo a Reportes...")},disabled:N,children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Ver Reportes"]}),(0,a.jsxs)(i.zx,{className:"w-full justify-start",variant:"outline",onClick:()=>{e.push("/estimates"),p.ZP.success("Redirigiendo a Presupuestos...")},disabled:N,children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Nuevo Presupuesto"]}),(0,a.jsxs)(i.zx,{className:"w-full justify-start",variant:"outline",onClick:()=>{e.push("/technicians"),p.ZP.success("Redirigiendo a T\xe9cnicos...")},disabled:N,children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Gestionar T\xe9cnicos"]})]})]})}),(0,a.jsx)(i.Zb,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Estado del Sistema"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Estado:"}),(0,a.jsx)("span",{className:"font-medium text-green-600",children:"Activo"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"\xdaltima Actualizaci\xf3n:"}),(0,a.jsx)("span",{className:"font-medium text-blue-600",children:N?"Cargando...":new Date().toLocaleTimeString("es-ES")})]})]})]})}),(0,a.jsx)(i.Zb,{children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Estado del Sistema"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Sistema Principal"})]}),(0,a.jsx)("span",{className:"text-xs text-green-600",children:"Operativo"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"M\xf3dulos Avanzados"})]}),(0,a.jsx)("span",{className:"text-xs text-blue-600",children:"Activo"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Base de Datos"})]}),(0,a.jsx)("span",{className:"text-xs text-green-600",children:"Conectada"})]})]})]})})]})]})]})}}},function(e){e.O(0,[5558,8829,3926,2533,2971,2117,1744],function(){return e(e.s=79121)}),_N_E=e.O()}]);