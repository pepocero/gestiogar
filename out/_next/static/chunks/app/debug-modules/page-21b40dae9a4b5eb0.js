(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5809],{58363:function(e,s,t){Promise.resolve().then(t.bind(t,92447))},92447:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var a=t(57437),r=t(2265),l=t(99178),n=t(62953),i=t(2141),c=t(46281),d=t(43981);function o(){let{company:e,user:s}=(0,c.a)(),{modules:t,loading:o}=(0,d.s)(),[u,m]=(0,r.useState)({}),[x,h]=(0,r.useState)({}),f=async()=>{let s={};try{let{data:t,error:a}=await i.supabase.from("information_schema.tables").select("table_name").eq("table_schema","public").in("table_name",["modules","module_data"]);s.tablesExist={success:!a,data:t,error:a};let{data:r,error:l}=(null==e?void 0:e.id)?await (0,i.supabaseTable)("modules").select("*").eq("company_id",e.id):{data:null,error:null};s.modulesDirect={success:!l,data:r,error:l};let{data:n,error:c}=await i.supabase.from("pg_policies").select("*").eq("tablename","modules");s.rlsPolicies={success:!c,data:n,error:c};let{data:d,error:o}=await i.supabase.rpc("user_company_id");s.userCompanyIdFunction={success:!o,data:d,error:o}}catch(e){s.generalError=e}h(s)};return(0,r.useEffect)(()=>{m({company:e,user:s,modules:t,loading:o})},[e,s,t,o]),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Debug M\xf3dulos"}),(0,a.jsx)(n.zx,{onClick:f,children:"Ejecutar Tests"})]}),(0,a.jsxs)(l.Zb,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Informaci\xf3n del Contexto"}),(0,a.jsx)("pre",{className:"bg-gray-100 p-4 rounded text-sm overflow-auto",children:JSON.stringify(u,null,2)})]}),Object.keys(x).length>0&&(0,a.jsxs)(l.Zb,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Resultados de Tests"}),(0,a.jsx)("div",{className:"space-y-4",children:Object.entries(x).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"border rounded p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:s}),(0,a.jsx)("div",{className:"text-sm ".concat(t.success?"text-green-600":"text-red-600"),children:t.success?"✅ \xc9xito":"❌ Error"}),t.error&&(0,a.jsxs)("div",{className:"text-red-600 text-sm mt-2",children:["Error: ",JSON.stringify(t.error,null,2)]}),t.data&&(0,a.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs mt-2 overflow-auto",children:JSON.stringify(t.data,null,2)})]},s)})})]}),(0,a.jsxs)(l.Zb,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Verificar Tablas de M\xf3dulos"}),(0,a.jsx)(n.zx,{onClick:async()=>{try{let{data:e,error:s}=await (0,i.supabaseTable)("modules").select("id").limit(1),{data:t,error:a}=await (0,i.supabaseTable)("module_data").select("id").limit(1);if(s||a){let e=[s,a].filter(Boolean).map(e=>null==e?void 0:e.message).join(", ");alert("❌ Error al acceder a las tablas:\n"+e+"\n\nAseg\xfarate de ejecutar el SQL de creaci\xf3n de tablas en Supabase Dashboard.")}else alert("✅ Las tablas de m\xf3dulos existen y son accesibles")}catch(e){alert("Error: "+e)}},children:"Verificar Tablas de M\xf3dulos"})]}),(0,a.jsxs)(l.Zb,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Diagn\xf3stico del Problema"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900",children:"Problema Identificado:"}),(0,a.jsxs)("p",{className:"text-blue-800 text-sm mt-2",children:["Los m\xf3dulos instalados no aparecen en el sidebar porque probablemente las tablas ",(0,a.jsx)("code",{children:"modules"})," y ",(0,a.jsx)("code",{children:"module_data"})," no existen en la base de datos."]})]}),(0,a.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-medium text-green-900",children:"Soluci\xf3n:"}),(0,a.jsxs)("ol",{className:"text-green-800 text-sm mt-2 list-decimal list-inside space-y-1",children:[(0,a.jsx)("li",{children:"Ejecutar el SQL de creaci\xf3n de tablas en Supabase Dashboard"}),(0,a.jsx)("li",{children:"Verificar que las pol\xedticas RLS est\xe9n configuradas correctamente"}),(0,a.jsx)("li",{children:"Reiniciar la aplicaci\xf3n para que cargue los m\xf3dulos"})]})]})]})]})]})}},69379:function(e,s,t){"use strict";t.d(s,{C:function(){return l}});var a=t(57437);t(2265);var r=t(61994);function l(e){let{children:s,variant:t="gray",size:l="md",className:n}=e;return(0,a.jsx)("span",{className:(0,r.W)("inline-flex items-center font-medium rounded-full",{success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800",gray:"bg-gray-100 text-gray-800"}[t],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-xs"}[l],n),children:s})}},99178:function(e,s,t){"use strict";t.d(s,{Ol:function(){return n},Zb:function(){return l},eW:function(){return i}});var a=t(57437);t(2265);var r=t(61994);function l(e){let{children:s,className:t}=e;return(0,a.jsx)("div",{className:(0,r.W)("card",t),children:s})}function n(e){let{children:s,className:t}=e;return(0,a.jsx)("div",{className:(0,r.W)("card-header",t),children:s})}function i(e){let{children:s,className:t}=e;return(0,a.jsx)("div",{className:(0,r.W)("card-body",t),children:s})}},96372:function(e,s,t){"use strict";t.d(s,{v:function(){return m}});var a=t(57437),r=t(2265),l=t(22574),n=t(84226),i=t(32489),c=t(41414),d=t(45802),o=t(43391),u=t(30401);function m(e){let{isOpen:s,onClose:t,onSave:m,imageFile:x,aspectRatio:h=1,title:f="Editar Imagen",circular:b=!1}=e,[g,p]=(0,r.useState)(),[j,v]=(0,r.useState)(),[y,N]=(0,r.useState)(1),[w,C]=(0,r.useState)(0),[D,E]=(0,r.useState)(""),S=(0,r.useRef)(null),_=(0,r.useRef)(null);r.useEffect(()=>{if(s&&x){let e=new FileReader;e.onload=e=>{var s;E(null===(s=e.target)||void 0===s?void 0:s.result)},e.readAsDataURL(x)}},[s,x]);let k=(0,r.useCallback)(e=>{let{width:s,height:t}=e.currentTarget;p((0,l._H)((0,l.YG)({unit:"%",width:90},h,s,t),s,t))},[h]),z=(e,s)=>{let t=_.current;if(!t)throw Error("Canvas no disponible");let a=t.getContext("2d");if(!a)throw Error("Contexto 2D no disponible");let r=e.naturalWidth/e.width,l=e.naturalHeight/e.height,n=window.devicePixelRatio;return t.width=s.width*n*r,t.height=s.height*n*l,a.setTransform(n,0,0,n,0,0),a.imageSmoothingQuality="high",0!==w&&(a.translate(t.width/2,t.height/2),a.rotate(w*Math.PI/180),a.translate(-t.width/2,-t.height/2)),a.drawImage(e,s.x*r,s.y*l,s.width*r,s.height*l,0,0,t.width/n,t.height/n),new Promise(e=>{t.toBlob(s=>{s&&e(s)},"image/jpeg",.95)})},Z=async()=>{if(S.current&&j)try{let e=await z(S.current,j);m(e),t()}catch(e){console.error("Error al procesar la imagen:",e)}};return s&&D?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:f}),(0,a.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(i.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 p-4 border-b border-gray-200 bg-gray-50",children:[(0,a.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{C(e=>(e+90)%360)},className:"flex items-center",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Rotar"]}),(0,a.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{N(e=>Math.max(e-.1,.5))},className:"flex items-center",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Alejar"]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[Math.round(100*y),"%"]}),(0,a.jsxs)(n.z,{variant:"secondary",size:"sm",onClick:()=>{N(e=>Math.min(e+.1,3))},className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Acercar"]})]}),(0,a.jsx)("div",{className:"p-4 overflow-auto max-h-[60vh]",children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(l.ZP,{crop:g,onChange:(e,s)=>p(s),onComplete:e=>v(e),aspect:h,circularCrop:b,children:(0,a.jsx)("img",{ref:S,alt:"Crop me",src:D,style:{transform:"scale(".concat(y,") rotate(").concat(w,"deg)"),maxWidth:"100%",maxHeight:"400px"},onLoad:k})})})}),(0,a.jsx)("canvas",{ref:_,style:{display:"none"}}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 p-4 border-t border-gray-200",children:[(0,a.jsx)(n.z,{variant:"secondary",onClick:t,children:"Cancelar"}),(0,a.jsxs)(n.z,{onClick:Z,disabled:!j,className:"btn-primary flex items-center",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})}):null}t(83814)},38068:function(e,s,t){"use strict";t.d(s,{I:function(){return l}});var a=t(57437);t(2265);var r=t(61994);function l(e){let{label:s,error:t,helperText:l,className:n,id:i,...c}=e,d=i||"input-".concat(Math.random().toString(36).substr(2,9));return(0,a.jsxs)("div",{className:"w-full",children:[s&&(0,a.jsxs)("label",{htmlFor:d,className:"form-label",children:[s,c.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsx)("input",{id:d,className:(0,r.W)("form-input",t&&"border-red-300 focus:ring-red-500 focus:border-red-500",n),...c}),t&&(0,a.jsx)("p",{className:"form-error",children:t}),l&&!t&&(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:l})]})}},95930:function(e,s,t){"use strict";t.d(s,{iA:function(){return l}});var a=t(57437);t(2265);var r=t(61994);function l(e){let{children:s,className:t}=e;return(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("table",{className:(0,r.W)("table",t),children:s})})}},62953:function(e,s,t){"use strict";t.d(s,{Ct:function(){return l.C},II:function(){return n.I},Zb:function(){return a.Zb},u_:function(){return i.u},zx:function(){return r.z}});var a=t(99178),r=t(84226),l=t(69379),n=t(38068),i=t(95998);t(95930),t(96372)},43981:function(e,s,t){"use strict";t.d(s,{ModulesProvider:function(){return d},s:function(){return o}});var a=t(57437),r=t(2265),l=t(58784),n=t(46281),i=t(26098);let c=(0,r.createContext)(void 0);function d(e){let{children:s}=e,{user:t,company:d}=(0,n.a)(),[o,u]=(0,r.useState)([]),[m,x]=(0,r.useState)(!0),h=async()=>{if(!(null==d?void 0:d.id)){(0,i.wH)("debug","\uD83D\uDD0D No company ID available, skipping module load"),u([]),x(!1);return}try{x(!0),(0,i.wH)("debug","\uD83D\uDD04 Loading modules for company:",d.id);let e=await (0,l.hU)(d.id);(0,i.wH)("debug","\uD83D\uDCE6 Raw modules data:",e);let s=e.filter(e=>e.is_active);(0,i.wH)("debug","✅ Active modules:",s),u(s)}catch(s){var e;console.error("❌ Error loading modules:",s),(null==s?void 0:s.code)==="PGRST205"||(null==s?void 0:null===(e=s.message)||void 0===e?void 0:e.includes("Could not find the table"))?(0,i.wH)("debug","\uD83D\uDCCB Modules tables not created yet, returning empty list"):console.error("❌ Unexpected error loading modules:",s),u([])}finally{x(!1)}};(0,r.useEffect)(()=>{h()},[null==d?void 0:d.id]);let f=async()=>{await h()};return(0,a.jsx)(c.Provider,{value:{modules:o,loading:m,refreshModules:f},children:s})}function o(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useModules must be used within a ModulesProvider");return e}}},function(e){e.O(0,[5558,8829,3926,6046,2971,2117,1744],function(){return e(e.s=58363)}),_N_E=e.O()}]);