(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2849],{56924:function(e,s,a){Promise.resolve().then(a.bind(a,97108))},97108:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return E}});var t=a(57437),r=a(2265),i=a(99178),l=a(84226),n=a(69379),c=a(95930),d=a(95998),o=a(99397),u=a(73247),m=a(90740),x=a(92735),h=a(42208),p=a(94630),f=a(18930),y=a(92369),j=a(89345),g=a(13041),N=a(83774),b=a(98420),v=a(46281),_=a(2141),w=a(69064);function E(){let{company:e,user:s,loading:a}=(0,v.a)(),[E,C]=(0,r.useState)(!1),[k,Z]=(0,r.useState)(!1),[I,S]=(0,r.useState)([]),[A,T]=(0,r.useState)([]),[D,z]=(0,r.useState)(!1),[M,O]=(0,r.useState)(null),[P,L]=(0,r.useState)(!1),[q,U]=(0,r.useState)(!1),[V,G]=(0,r.useState)(!1),[H,R]=(0,r.useState)(!1),[J,B]=(0,r.useState)({client_type:"direct",insurance_company_id:""});r.useEffect(()=>{(null==e?void 0:e.id)&&W()},[null==e?void 0:e.id]),r.useEffect(()=>{E&&(null==e?void 0:e.id)&&F()},[E,null==e?void 0:e.id]);let W=async()=>{if(null==e?void 0:e.id){z(!0);try{let{data:s,error:a}=await (0,_.supabaseTable)("clients").select("\n          *,\n          insurance_companies (\n            id,\n            name\n          )\n        ").eq("company_id",e.id).order("created_at",{ascending:!1});if(a){console.error("Error fetching clients:",a);return}T(s||[])}catch(e){console.error("Error fetching clients:",e)}finally{z(!1)}}},F=async()=>{if(null==e?void 0:e.id)try{let{data:s,error:a}=await (0,_.supabaseTable)("insurance_companies").select("id, name").eq("company_id",e.id);if(a){console.error("Error fetching insurance companies:",a);return}S(s||[])}catch(e){console.error("Error fetching insurance companies:",e)}},X=async s=>{if(s.preventDefault(),!(null==e?void 0:e.id)){w.ZP.error("No se pudo obtener la informaci\xf3n de la empresa");return}Z(!0);try{var a,t;let r=new FormData(s.currentTarget),i={company_id:e.id,insurance_company_id:(null===(a=r.get("insurance_company_id"))||void 0===a?void 0:a.trim())||null,first_name:r.get("first_name"),last_name:r.get("last_name"),email:r.get("email")||null,phone:r.get("phone")||null,address:(null===(t=r.get("address"))||void 0===t?void 0:t.trim())||"",city:r.get("city")||null,postal_code:r.get("postal_code")||null,client_type:r.get("client_type")||"direct",policy_number:r.get("policy_number")||null,claim_number:r.get("claim_number")||null,notes:r.get("notes")||null},{data:l,error:n}=await (0,_.supabaseTable)("clients").insert([i]).select();if(n){let e=await (0,_.supabaseAdminTable)("clients").insert([i]).select();l=e.data,n=e.error}if(n){console.error("Supabase error creating client:",n),w.ZP.error("Error al crear el cliente: "+n.message);return}if(!l||0===l.length){console.error("No data returned after client creation"),w.ZP.error("Error: No se pudo verificar la creaci\xf3n del cliente");return}w.ZP.success("Cliente creado exitosamente"),C(!1),s.currentTarget&&s.currentTarget.reset(),W()}catch(e){console.error("JavaScript error creating client:",e),w.ZP.error("Error inesperado al crear el cliente")}finally{Z(!1)}},Y=e=>{O(e),L(!0)},K=async s=>{O(s),B({client_type:s.client_type||"direct",insurance_company_id:s.insurance_company_id||""}),U(!0),(null==e?void 0:e.id)&&await F()},Q=(e,s)=>{B(a=>{let t={...a,[e]:s};return"insurance_company_id"===e&&s?t.client_type="insurance":"client_type"===e&&"direct"===s&&(t.insurance_company_id=""),t})},$=async e=>{if(e.preventDefault(),M){R(!0);try{var s,a;let t=new FormData(e.currentTarget),r={insurance_company_id:(null===(s=J.insurance_company_id)||void 0===s?void 0:s.trim())||null,first_name:t.get("first_name"),last_name:t.get("last_name"),email:t.get("email")||null,phone:t.get("phone")||null,address:(null===(a=t.get("address"))||void 0===a?void 0:a.trim())||"",city:t.get("city")||null,postal_code:t.get("postal_code")||null,client_type:J.client_type,policy_number:t.get("policy_number")||null,claim_number:t.get("claim_number")||null,notes:t.get("notes")||null},{error:i}=await (0,_.supabaseTable)("clients").update(r).eq("id",M.id);if(i){console.error("Error updating client:",i),w.ZP.error("Error al actualizar el cliente: "+i.message);return}w.ZP.success("Cliente actualizado exitosamente"),U(!1),O(null),W()}catch(e){console.error("Error updating client:",e),w.ZP.error("Error inesperado al actualizar el cliente")}finally{R(!1)}}},ee=e=>{O(e),G(!0)},es=async()=>{if(M)try{let{error:e}=await (0,_.supabaseTable)("clients").delete().eq("id",M.id);if(e){console.error("Error deleting client:",e),w.ZP.error("Error al eliminar el cliente: "+e.message);return}w.ZP.success("Cliente eliminado exitosamente"),G(!1),O(null),W()}catch(e){console.error("Error deleting client:",e),w.ZP.error("Error inesperado al eliminar el cliente")}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Clientes"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Gestiona los clientes de tu empresa"})]}),(0,t.jsxs)(l.z,{className:"btn-primary w-full sm:w-auto",onClick:()=>C(!0),children:[(0,t.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Nuevo Cliente"]})]}),(0,t.jsx)(i.Zb,{className:"app-card",children:(0,t.jsx)(i.eW,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,t.jsx)("input",{type:"text",placeholder:"Buscar clientes...",className:"form-input pl-10"})]})}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,t.jsxs)(l.z,{variant:"secondary",className:"w-full sm:w-auto",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Filtros"]}),(0,t.jsxs)(l.z,{variant:"secondary",className:"w-full sm:w-auto",children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Exportar"]})]})]})})}),(0,t.jsxs)(i.Zb,{className:"app-card",children:[(0,t.jsx)(i.Ol,{children:(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Lista de Clientes"})}),(0,t.jsx)(i.eW,{children:(0,t.jsxs)(c.iA,{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Nombre"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Tel\xe9fono"}),(0,t.jsx)("th",{children:"Direcci\xf3n"}),(0,t.jsx)("th",{children:"Tipo / Aseguradora"}),(0,t.jsx)("th",{children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:D?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"text-center py-8 text-gray-500",children:(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600 mr-2"}),"Cargando clientes..."]})})}):A.length>0?A.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:"font-medium",children:[e.first_name," ",e.last_name]}),(0,t.jsx)("td",{children:e.email||"-"}),(0,t.jsx)("td",{children:e.phone||"-"}),(0,t.jsx)("td",{children:e.address||"-"}),(0,t.jsx)("td",{children:"direct"===e.client_type?(0,t.jsx)(n.C,{variant:"info",children:"Directo"}):(0,t.jsx)(n.C,{variant:"success",children:e.insurance_companies?e.insurance_companies.name:"Aseguradora"})}),(0,t.jsx)("td",{className:"text-right",children:(0,t.jsxs)("div",{className:"action-buttons flex gap-1",children:[(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>Y(e),title:"Ver cliente",children:(0,t.jsx)(h.Z,{className:"h-4 w-4"})}),(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>K(e),title:"Editar cliente",children:(0,t.jsx)(p.Z,{className:"h-4 w-4"})}),(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>ee(e),title:"Eliminar cliente",children:(0,t.jsx)(f.Z,{className:"h-4 w-4"})})]})})]},e.id)):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"text-center py-8 text-gray-500",children:"No hay clientes registrados"})})})]})})]}),(0,t.jsx)(d.u,{isOpen:E,onClose:()=>C(!1),title:"Nuevo Cliente",children:(0,t.jsxs)("form",{onSubmit:X,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Nombre *"}),(0,t.jsx)("input",{type:"text",name:"first_name",className:"form-input",placeholder:"Nombre del cliente",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Apellidos *"}),(0,t.jsx)("input",{type:"text",name:"last_name",className:"form-input",placeholder:"Apellidos del cliente",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Email *"}),(0,t.jsx)("input",{type:"email",name:"email",className:"form-input",placeholder:"cliente@email.com",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tel\xe9fono *"}),(0,t.jsx)("input",{type:"tel",name:"phone",className:"form-input",placeholder:"+34 600 000 000",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo de Cliente"}),(0,t.jsxs)("select",{name:"client_type",className:"form-input",children:[(0,t.jsx)("option",{value:"direct",children:"Cliente Directo"}),(0,t.jsx)("option",{value:"insurance",children:"Cliente de Aseguradora"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Aseguradora"}),(0,t.jsxs)("select",{name:"insurance_company_id",className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Seleccionar aseguradora"}),I.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"N\xfamero de P\xf3liza"}),(0,t.jsx)("input",{type:"text",name:"policy_number",className:"form-input",placeholder:"N\xfamero de p\xf3liza"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"N\xfamero de Siniestro"}),(0,t.jsx)("input",{type:"text",name:"claim_number",className:"form-input",placeholder:"N\xfamero de siniestro"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Direcci\xf3n *"}),(0,t.jsx)("textarea",{name:"address",className:"form-input",rows:3,placeholder:"Direcci\xf3n completa del cliente...",required:!0})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Ciudad"}),(0,t.jsx)("input",{type:"text",name:"city",className:"form-input",placeholder:"Ciudad"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"C\xf3digo Postal"}),(0,t.jsx)("input",{type:"text",name:"postal_code",className:"form-input",placeholder:"28001"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Notas"}),(0,t.jsx)("textarea",{name:"notes",className:"form-input",rows:2,placeholder:"Notas adicionales sobre el cliente..."})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,t.jsx)(l.z,{type:"button",variant:"secondary",onClick:()=>C(!1),disabled:k,children:"Cancelar"}),(0,t.jsx)(l.z,{type:"submit",className:"btn-primary",disabled:k,children:k?"Creando...":"Crear Cliente"})]})]})}),(0,t.jsx)(d.u,{isOpen:P,onClose:()=>L(!1),title:"Detalles del Cliente",size:"lg",children:M&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,t.jsx)(y.Z,{className:"h-8 w-8 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:[M.first_name," ",M.last_name]}),(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-1",children:(0,t.jsx)(n.C,{variant:"direct"===M.client_type?"info":"success",children:"direct"===M.client_type?"Cliente Directo":"Cliente de Aseguradora"})})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Informaci\xf3n de Contacto"}),(0,t.jsxs)("div",{className:"space-y-3",children:[M.email&&(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(j.Z,{className:"h-4 w-4 text-green-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,t.jsx)("a",{href:"mailto:".concat(M.email),className:"font-medium text-blue-600 hover:text-blue-700",children:M.email})]})]}),M.phone&&(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(g.Z,{className:"h-4 w-4 text-purple-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Tel\xe9fono"}),(0,t.jsx)("a",{href:"tel:".concat(M.phone),className:"font-medium text-gray-900",children:M.phone})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Informaci\xf3n de Direcci\xf3n"}),(0,t.jsxs)("div",{className:"space-y-3",children:[M.address&&(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(N.Z,{className:"h-4 w-4 text-orange-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Direcci\xf3n"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:M.address})]})]}),(M.city||M.postal_code)&&(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(b.Z,{className:"h-4 w-4 text-indigo-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Ciudad"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[M.city||"-",M.postal_code&&" (".concat(M.postal_code,")")]})]})]})]})]})]}),(M.policy_number||M.claim_number)&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Informaci\xf3n de Seguros"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[M.policy_number&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"N\xfamero de P\xf3liza"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:M.policy_number})]}),M.claim_number&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"N\xfamero de Siniestro"}),(0,t.jsx)("p",{className:"font-medium text-gray-900",children:M.claim_number})]})]})]}),M.notes&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Notas"}),(0,t.jsx)("p",{className:"text-gray-900",children:M.notes})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Registrado:"})," ",new Date(M.created_at).toLocaleDateString("es-ES")]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Actualizado:"})," ",new Date(M.updated_at).toLocaleDateString("es-ES")]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,t.jsx)(l.z,{type:"button",variant:"outline",onClick:()=>L(!1),children:"Cerrar"}),(0,t.jsx)(l.z,{type:"button",onClick:async()=>{L(!1),await K(M)},children:"Editar Cliente"})]})]})}),(0,t.jsx)(d.u,{isOpen:q,onClose:()=>U(!1),title:"Editar Cliente",children:M&&(0,t.jsxs)("form",{onSubmit:$,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Nombre *"}),(0,t.jsx)("input",{type:"text",name:"first_name",className:"form-input",placeholder:"Nombre",defaultValue:M.first_name,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Apellidos *"}),(0,t.jsx)("input",{type:"text",name:"last_name",className:"form-input",placeholder:"Apellidos",defaultValue:M.last_name,required:!0})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Email"}),(0,t.jsx)("input",{type:"email",name:"email",className:"form-input",placeholder:"email@ejemplo.com",defaultValue:M.email||""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tel\xe9fono"}),(0,t.jsx)("input",{type:"tel",name:"phone",className:"form-input",placeholder:"+34 600 000 000",defaultValue:M.phone||""})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Aseguradora"}),(0,t.jsxs)("select",{name:"insurance_company_id",className:"form-input",value:J.insurance_company_id,onChange:e=>Q("insurance_company_id",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Seleccionar aseguradora"}),I.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Direcci\xf3n"}),(0,t.jsx)("textarea",{name:"address",className:"form-input",rows:3,placeholder:"Direcci\xf3n completa",defaultValue:M.address||""})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Ciudad"}),(0,t.jsx)("input",{type:"text",name:"city",className:"form-input",placeholder:"Ciudad",defaultValue:M.city||""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"C\xf3digo Postal"}),(0,t.jsx)("input",{type:"text",name:"postal_code",className:"form-input",placeholder:"28001",defaultValue:M.postal_code||""})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo de Cliente"}),(0,t.jsxs)("select",{name:"client_type",className:"form-input",value:J.client_type,onChange:e=>Q("client_type",e.target.value),children:[(0,t.jsx)("option",{value:"direct",children:"Directo"}),(0,t.jsx)("option",{value:"insurance",children:"Aseguradora"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"N\xfamero de P\xf3liza"}),(0,t.jsx)("input",{type:"text",name:"policy_number",className:"form-input",placeholder:"POL123456",defaultValue:M.policy_number||""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"N\xfamero de Siniestro"}),(0,t.jsx)("input",{type:"text",name:"claim_number",className:"form-input",placeholder:"SIN123456",defaultValue:M.claim_number||""})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Notas"}),(0,t.jsx)("textarea",{name:"notes",className:"form-input",rows:3,placeholder:"Notas adicionales",defaultValue:M.notes||""})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)(l.z,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Cancelar"}),(0,t.jsx)(l.z,{type:"submit",disabled:H,children:H?"Actualizando...":"Actualizar Cliente"})]})]})}),(0,t.jsx)(d.u,{isOpen:V,onClose:()=>G(!1),title:"Eliminar Cliente",children:M&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{className:"text-gray-600",children:["\xbfEst\xe1s seguro de que quieres eliminar al cliente"," ",(0,t.jsxs)("strong",{children:[M.first_name," ",M.last_name]}),"?"]}),(0,t.jsx)("p",{className:"text-sm text-red-600",children:"Esta acci\xf3n no se puede deshacer."}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)(l.z,{variant:"outline",onClick:()=>G(!1),children:"Cancelar"}),(0,t.jsx)(l.z,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:es,children:"Eliminar"})]})]})})]})}},69379:function(e,s,a){"use strict";a.d(s,{C:function(){return i}});var t=a(57437);a(2265);var r=a(61994);function i(e){let{children:s,variant:a="gray",size:i="md",className:l}=e;return(0,t.jsx)("span",{className:(0,r.W)("inline-flex items-center font-medium rounded-full",{success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800",gray:"bg-gray-100 text-gray-800"}[a],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-xs"}[i],l),children:s})}},84226:function(e,s,a){"use strict";a.d(s,{z:function(){return i}});var t=a(57437);a(2265);var r=a(61994);function i(e){let{variant:s="primary",size:a="md",loading:i=!1,className:l,children:n,disabled:c,...d}=e;return(0,t.jsxs)("button",{className:(0,r.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[s],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[a],(c||i)&&"opacity-50 cursor-not-allowed",l),disabled:c||i,...d,children:[i&&(0,t.jsx)("div",{className:"spinner mr-2"}),n]})}},99178:function(e,s,a){"use strict";a.d(s,{Ol:function(){return l},Zb:function(){return i},eW:function(){return n}});var t=a(57437);a(2265);var r=a(61994);function i(e){let{children:s,className:a}=e;return(0,t.jsx)("div",{className:(0,r.W)("card",a),children:s})}function l(e){let{children:s,className:a}=e;return(0,t.jsx)("div",{className:(0,r.W)("card-header",a),children:s})}function n(e){let{children:s,className:a}=e;return(0,t.jsx)("div",{className:(0,r.W)("card-body",a),children:s})}},95998:function(e,s,a){"use strict";a.d(s,{u:function(){return n}});var t=a(57437),r=a(2265),i=a(61994),l=a(32489);function n(e){let{isOpen:s,onClose:a,title:n,children:c,size:d="md",className:o}=e;return((0,r.useEffect)(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s]),(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,a]),s)?(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:a}),(0,t.jsxs)("div",{className:(0,i.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[d],o),children:[n&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:n}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(l.Z,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"p-6",children:c})]})]})}):null}},95930:function(e,s,a){"use strict";a.d(s,{iA:function(){return i}});var t=a(57437);a(2265);var r=a(61994);function i(e){let{children:s,className:a}=e;return(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsx)("table",{className:(0,r.W)("table",a),children:s})})}},46281:function(e,s,a){"use strict";a.d(s,{AuthProvider:function(){return d},a:function(){return o}});var t=a(57437),r=a(2265),i=a(2141),l=a(69064),n=a(26098);let c=(0,r.createContext)(void 0);function d(e){let{children:s}=e,[a,d]=(0,r.useState)(null),[o,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[h,p]=(0,r.useState)(!0),f=async e=>{try{if(o&&o.id===e){(0,n.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,n.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:t,error:r}=await (0,i.supabaseTable)("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(r){console.warn("⚠️ Could not load user profile:",r.message);let e=(await i.supabase.auth.getUser()).data.user;if(e){var s,a;u({id:e.id,email:e.email,first_name:null===(s=e.user_metadata)||void 0===s?void 0:s.first_name,last_name:null===(a=e.user_metadata)||void 0===a?void 0:a.last_name})}return}(0,n.wH)("debug","✅ User profile loaded successfully"),u(t),x(t.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,r.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:s}}=await i.supabase.auth.getSession();(null==s?void 0:s.user)&&e&&(d(s.user),await f(s.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&p(!1)}})();let{data:{subscription:s}}=i.supabase.auth.onAuthStateChange(async(e,s)=>{var a;(0,n.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==s?void 0:null===(a=s.user)||void 0===a?void 0:a.id),"SIGNED_OUT"===e?(d(null),u(null),x(null),l.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==s?void 0:s.user)?(d(s.user),o&&o.id===s.user.id||await f(s.user.id)):"TOKEN_REFRESHED"===e&&(0,n.wH)("debug","\uD83D\uDD04 Token refreshed successfully")});return()=>{e=!1,s.unsubscribe()}},[]);let y=async(e,s)=>{let{data:a,error:t}=await i.supabase.auth.signInWithPassword({email:e,password:s});if(t)throw t;return a},j=async(e,s,a)=>{let{data:t,error:r}=await i.supabase.auth.signUp({email:e,password:s,options:{data:a}});if(r)throw r;return t},g=async()=>{await i.supabase.auth.signOut()},N=async e=>{if(!a)throw Error("Usuario no autenticado");let{error:s}=await (0,i.supabaseTable)("users").update(e).eq("id",a.id);if(s)throw s;await f(a.id)};return(0,t.jsx)(c.Provider,{value:{user:a,profile:o,company:m,loading:h,signIn:y,signUp:j,signOut:g,updateProfile:N},children:s})}function o(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26098:function(e,s,a){"use strict";a.d(s,{ob:function(){return t},wH:function(){return r}});let t={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},r=function(e){for(var s=arguments.length,a=Array(s>1?s-1:0),r=1;r<s;r++)a[r-1]=arguments[r];if(!t.LOGGING.ENABLED)return;let i=["debug","info","warn","error"];i.indexOf(e)>=i.indexOf(t.LOGGING.MIN_LEVEL)&&console[e](...a)}},2141:function(e,s,a){"use strict";a.r(s),a.d(s,{supabase:function(){return m},supabaseAdmin:function(){return x},supabaseAdminTable:function(){return p},supabaseTable:function(){return h}});var t,r,i,l,n=a(63887),c=a(40257);let d=c.env.NEXT_PUBLIC_SUPABASE_URL||"https://pbdsuhmwxqiwbpgyrhqt.supabase.co",o=c.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",u=c.env.NEXT_PUBLIC_SUPABASE_SERVICE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",m=null!==(i=(t=globalThis).__supabaseClient)&&void 0!==i?i:t.__supabaseClient=(0,n.eI)(d,o,{auth:{flowType:"pkce",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"supabase.auth.token"}}),x=null!==(l=(r=globalThis).__supabaseAdminClient)&&void 0!==l?l:r.__supabaseAdminClient=(0,n.eI)(d,u,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storageKey:"supabase.admin.token"}}),h=e=>m.from(e),p=e=>x.from(e)},39763:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});var t=a(2265),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,s)=>{let a=(0,t.forwardRef)((a,l)=>{let{color:n="currentColor",size:c=24,strokeWidth:d=2,absoluteStrokeWidth:o,className:u="",children:m,...x}=a;return(0,t.createElement)("svg",{ref:l,...r,width:c,height:c,stroke:n,strokeWidth:o?24*Number(d)/Number(c):d,className:["lucide","lucide-".concat(i(e)),u].join(" "),...x},[...s.map(e=>{let[s,a]=e;return(0,t.createElement)(s,a)}),...Array.isArray(m)?m:[m]])});return a.displayName="".concat(e),a}},98420:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},92735:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},42208:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},90740:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},89345:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},83774:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},94630:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},13041:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},99397:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},73247:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},18930:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},92369:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},32489:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(39763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},61994:function(e,s,a){"use strict";function t(){for(var e,s,a=0,t="",r=arguments.length;a<r;a++)(e=arguments[a])&&(s=function e(s){var a,t,r="";if("string"==typeof s||"number"==typeof s)r+=s;else if("object"==typeof s){if(Array.isArray(s)){var i=s.length;for(a=0;a<i;a++)s[a]&&(t=e(s[a]))&&(r&&(r+=" "),r+=t)}else for(t in s)s[t]&&(r&&(r+=" "),r+=t)}return r}(e))&&(t&&(t+=" "),t+=s);return t}a.d(s,{W:function(){return t}})}},function(e){e.O(0,[8829,2971,2117,1744],function(){return e(e.s=56924)}),_N_E=e.O()}]);