(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6109],{47286:function(e,r,a){Promise.resolve().then(a.bind(a,73208))},73208:function(e,r,a){"use strict";a.d(r,{default:function(){return g}});var t=a(57437),s=a(99376),n=a(99178),l=a(43981),i=a(2265),c=a(84226),o=a(38068),d=a(95998),u=a(99397),m=a(73247),f=a(94630),x=a(18930),h=a(83229),p=a(58784),y=a(69064),v=a(46281);function j(e){let{moduleId:r,moduleName:a,config:s}=e,{company:l,user:j}=(0,v.a)(),[g,N]=(0,i.useState)([]),[b,w]=(0,i.useState)(!0),[k,C]=(0,i.useState)(""),[Z,E]=(0,i.useState)(!1),[P,S]=(0,i.useState)(!1),[D,q]=(0,i.useState)(null),[z,M]=(0,i.useState)({}),[_,H]=(0,i.useState)([]);(0,i.useEffect)(()=>{(null==l?void 0:l.id)?L(l.id):w(!1)},[r,null==l?void 0:l.id]);let A=(0,i.useMemo)(()=>null!=s&&!!s.fields&&s.fields.some(e=>"select"===e.type&&e.dynamic&&"technicians"===e.source),[null==s?void 0:s.fields]);(0,i.useEffect)(()=>{let e=!0;return(async()=>{if(!(null==l?void 0:l.id)||!A){e&&H([]);return}try{let r=await (0,p.Hk)(l.id);e&&H(r)}catch(r){console.error("Error loading technicians:",r),e&&H([])}})(),()=>{e=!1}},[null==l?void 0:l.id,A]);let L=async e=>{try{w(!0);let a=await (0,p.wV)(r,e);N(a)}catch(e){console.error("Error loading module data:",e),y.ZP.error("Error cargando datos del m\xf3dulo")}finally{w(!1)}},W=async()=>{if(!(null==l?void 0:l.id)||!(null==j?void 0:j.id)){y.ZP.error("No se pudo obtener informaci\xf3n del usuario");return}try{let e=await (0,p.l$)({module_id:r,company_id:l.id,created_by:j.id,data:z});N(r=>[e,...r]),E(!1),M({}),y.ZP.success("Elemento creado correctamente")}catch(e){console.error("Error creating data:",e),y.ZP.error("Error creando elemento")}},I=async()=>{if(D){if(!(null==l?void 0:l.id)){y.ZP.error("No se pudo obtener la empresa actual");return}try{let e=await (0,p.yG)(D.id,{data:z},l.id);N(r=>r.map(r=>r.id===D.id?e:r)),S(!1),q(null),M({}),y.ZP.success("Elemento actualizado correctamente")}catch(e){console.error("Error updating data:",e),y.ZP.error("Error actualizando elemento")}}},O=async e=>{if(confirm("\xbfEst\xe1s seguro de eliminar este elemento?")){if(!(null==l?void 0:l.id)){y.ZP.error("No se pudo obtener la empresa actual");return}try{await (0,p.Db)(e.id,l.id),N(r=>r.filter(r=>r.id!==e.id)),y.ZP.success("Elemento eliminado correctamente")}catch(e){console.error("Error deleting data:",e),y.ZP.error("Error eliminando elemento")}}},R=e=>{q(e),M(e.data),S(!0)},B=()=>_&&0!==_.length?_.map(e=>{let r=[e.first_name,e.last_name].filter(Boolean).join(" ").trim();return{value:e.id,label:r||e.email||"T\xe9cnico sin nombre"}}):[],V=(e,r,a)=>e.map(e=>{switch(e.type){case"text":case"email":case"tel":return(0,t.jsx)(o.I,{label:e.label,type:e.type,value:r[e.name]||"",onChange:r=>a(e.name,r.target.value),required:e.required},e.name);case"number":return(0,t.jsx)(o.I,{label:e.label,type:"number",value:r[e.name]||"",onChange:r=>a(e.name,Number(r.target.value)),required:e.required},e.name);case"textarea":return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,t.jsx)("textarea",{value:r[e.name]||"",onChange:r=>a(e.name,r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4})]},e.name);case"boolean":return(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("input",{type:"checkbox",id:e.name,checked:r[e.name]||!1,onChange:r=>a(e.name,r.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,t.jsx)("label",{htmlFor:e.name,className:"text-sm font-medium text-gray-700",children:e.label})]},e.name);case"select":{var s;let n=e.options||[];if(e.dynamic&&"technicians"===e.source){let r=B();n=[...e.options||[],...r]}return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,t.jsxs)("select",{value:null!==(s=r[e.name])&&void 0!==s?s:"",onChange:r=>a(e.name,r.target.value),required:e.required,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white",children:[(0,t.jsx)("option",{value:"",children:"Selecciona una opci\xf3n"}),n.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]})]},e.name)}default:return(0,t.jsx)(o.I,{label:e.label,type:"text",value:r[e.name]||"",onChange:r=>a(e.name,r.target.value),required:e.required},e.name)}}),G=g.filter(e=>{let r=k.toLowerCase();return JSON.stringify(e.data).toLowerCase().includes(r)});A&&_.length;let T=(e,r)=>{if(null==r||""===r)return"N/A";if("select"===e.type){let a=e.options||[];if(e.dynamic&&"technicians"===e.source){if("sin_asignar"===r)return"Sin asignar";let e=_.find(e=>e.id===r);if(e)return[e.first_name,e.last_name].filter(Boolean).join(" ").trim()||e.email||r}let t=a.find(e=>e.value===r);if(t)return t.label}return String(r)};return b?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:a}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:s.description||"Gestiona los elementos de este m\xf3dulo"})]}),(0,t.jsxs)(c.z,{onClick:()=>E(!0),className:"btn-primary",children:[(0,t.jsx)(u.Z,{className:"h-5 w-5 mr-2"}),"Crear Nuevo"]})]}),(0,t.jsx)(n.Zb,{className:"app-card",children:(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(m.Z,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,t.jsx)(o.I,{type:"text",placeholder:"Buscar elementos...",value:k,onChange:e=>C(e.target.value),className:"pl-10"})]})})}),(0,t.jsx)(n.Zb,{className:"app-card",children:(0,t.jsx)("div",{className:"p-6",children:0===G.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)("p",{children:"No hay elementos para mostrar"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Crea tu primer elemento para comenzar"})]}):(0,t.jsx)("div",{className:"space-y-4",children:G.map(e=>(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[s.fields&&s.fields.length>0?(0,t.jsx)("div",{className:"grid gap-2 md:grid-cols-2 lg:grid-cols-3",children:s.fields.map(r=>(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("span",{className:"font-medium text-gray-700",children:[r.label,":"]}),(0,t.jsx)("span",{className:"ml-2 text-gray-900",children:T(r,e.data[r.name])})]},r.name))}):(0,t.jsx)("pre",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:JSON.stringify(e.data,null,2)}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Creado: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,t.jsxs)("div",{className:"flex space-x-2 ml-4",children:[(0,t.jsx)(c.z,{size:"sm",variant:"outline",onClick:()=>R(e),children:(0,t.jsx)(f.Z,{className:"h-4 w-4"})}),(0,t.jsx)(c.z,{size:"sm",variant:"danger",onClick:()=>O(e),children:(0,t.jsx)(x.Z,{className:"h-4 w-4"})})]})]})},e.id))})})}),(0,t.jsx)(d.u,{isOpen:Z,onClose:()=>E(!1),title:"Crear Nuevo Elemento - ".concat(a),children:(0,t.jsxs)("div",{className:"space-y-4",children:[s.fields&&V(s.fields,z,(e,r)=>M(a=>({...a,[e]:r}))),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)(c.z,{variant:"secondary",onClick:()=>{E(!1),M({})},children:"Cancelar"}),(0,t.jsxs)(c.z,{variant:"primary",onClick:W,children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Crear"]})]})]})}),(0,t.jsx)(d.u,{isOpen:P,onClose:()=>{S(!1),q(null),M({})},title:"Editar Elemento - ".concat(a),children:(0,t.jsxs)("div",{className:"space-y-4",children:[D&&s.fields&&V(s.fields,z,(e,r)=>M(a=>({...a,[e]:r}))),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)(c.z,{variant:"secondary",onClick:()=>{S(!1),q(null),M({})},children:"Cancelar"}),(0,t.jsxs)(c.z,{variant:"primary",onClick:I,children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Actualizar"]})]})]})})]})}function g(){let e=(0,s.useParams)(),{modules:r,loading:a}=(0,l.s)(),i=r.find(r=>r.slug===e.slug);return a?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)(n.Zb,{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"Cargando m\xf3dulo..."})]})})}):i?i.config&&i.config.fields?(0,t.jsx)(j,{moduleId:i.id,moduleName:i.name,config:i.config}):(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)(n.Zb,{className:"p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:i.name}),(0,t.jsx)("p",{className:"text-gray-600",children:"El m\xf3dulo no tiene una configuraci\xf3n v\xe1lida. Reinst\xe1lalo desde la tienda o vuelve a instalar el paquete correspondiente."})]})}):(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)(n.Zb,{className:"p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"M\xf3dulo no encontrado"}),(0,t.jsx)("p",{className:"text-gray-600",children:"El m\xf3dulo solicitado no est\xe1 instalado o no existe para tu empresa."})]})})}},99178:function(e,r,a){"use strict";a.d(r,{Ol:function(){return l},Zb:function(){return n},eW:function(){return i}});var t=a(57437);a(2265);var s=a(61994);function n(e){let{children:r,className:a}=e;return(0,t.jsx)("div",{className:(0,s.W)("card",a),children:r})}function l(e){let{children:r,className:a}=e;return(0,t.jsx)("div",{className:(0,s.W)("card-header",a),children:r})}function i(e){let{children:r,className:a}=e;return(0,t.jsx)("div",{className:(0,s.W)("card-body",a),children:r})}},38068:function(e,r,a){"use strict";a.d(r,{I:function(){return n}});var t=a(57437);a(2265);var s=a(61994);function n(e){let{label:r,error:a,helperText:n,className:l,id:i,...c}=e,o=i||"input-".concat(Math.random().toString(36).substr(2,9));return(0,t.jsxs)("div",{className:"w-full",children:[r&&(0,t.jsxs)("label",{htmlFor:o,className:"form-label",children:[r,c.required&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,t.jsx)("input",{id:o,className:(0,s.W)("form-input",a&&"border-red-300 focus:ring-red-500 focus:border-red-500",l),...c}),a&&(0,t.jsx)("p",{className:"form-error",children:a}),n&&!a&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:n})]})}},43981:function(e,r,a){"use strict";a.d(r,{ModulesProvider:function(){return o},s:function(){return d}});var t=a(57437),s=a(2265),n=a(58784),l=a(46281),i=a(26098);let c=(0,s.createContext)(void 0);function o(e){let{children:r}=e,{user:a,company:o}=(0,l.a)(),[d,u]=(0,s.useState)([]),[m,f]=(0,s.useState)(!0),x=async()=>{if(!(null==o?void 0:o.id)){(0,i.wH)("debug","\uD83D\uDD0D No company ID available, skipping module load"),u([]),f(!1);return}try{f(!0),(0,i.wH)("debug","\uD83D\uDD04 Loading modules for company:",o.id);let e=await (0,n.hU)(o.id);(0,i.wH)("debug","\uD83D\uDCE6 Raw modules data:",e);let r=e.filter(e=>e.is_active);(0,i.wH)("debug","✅ Active modules:",r),u(r)}catch(r){var e;console.error("❌ Error loading modules:",r),(null==r?void 0:r.code)==="PGRST205"||(null==r?void 0:null===(e=r.message)||void 0===e?void 0:e.includes("Could not find the table"))?(0,i.wH)("debug","\uD83D\uDCCB Modules tables not created yet, returning empty list"):console.error("❌ Unexpected error loading modules:",r),u([])}finally{f(!1)}};(0,s.useEffect)(()=>{x()},[null==o?void 0:o.id]);let h=async()=>{await x()};return(0,t.jsx)(c.Provider,{value:{modules:d,loading:m,refreshModules:h},children:r})}function d(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useModules must be used within a ModulesProvider");return e}},39763:function(e,r,a){"use strict";a.d(r,{Z:function(){return l}});var t=a(2265),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,r)=>{let a=(0,t.forwardRef)((a,l)=>{let{color:i="currentColor",size:c=24,strokeWidth:o=2,absoluteStrokeWidth:d,className:u="",children:m,...f}=a;return(0,t.createElement)("svg",{ref:l,...s,width:c,height:c,stroke:i,strokeWidth:d?24*Number(o)/Number(c):o,className:["lucide","lucide-".concat(n(e)),u].join(" "),...f},[...r.map(e=>{let[r,a]=e;return(0,t.createElement)(r,a)}),...Array.isArray(m)?m:[m]])});return a.displayName="".concat(e),a}},94630:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});let t=(0,a(39763).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},99397:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});let t=(0,a(39763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},83229:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});let t=(0,a(39763).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},73247:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});let t=(0,a(39763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},18930:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});let t=(0,a(39763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},32489:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});let t=(0,a(39763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},99376:function(e,r,a){"use strict";var t=a(35475);a.o(t,"useParams")&&a.d(r,{useParams:function(){return t.useParams}}),a.o(t,"usePathname")&&a.d(r,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(r,{useRouter:function(){return t.useRouter}})},61994:function(e,r,a){"use strict";function t(){for(var e,r,a=0,t="",s=arguments.length;a<s;a++)(e=arguments[a])&&(r=function e(r){var a,t,s="";if("string"==typeof r||"number"==typeof r)s+=r;else if("object"==typeof r){if(Array.isArray(r)){var n=r.length;for(a=0;a<n;a++)r[a]&&(t=e(r[a]))&&(s&&(s+=" "),s+=t)}else for(t in r)r[t]&&(s&&(s+=" "),s+=t)}return s}(e))&&(t&&(t+=" "),t+=r);return t}a.d(r,{W:function(){return t}})}},function(e){e.O(0,[8829,6046,2971,2117,1744],function(){return e(e.s=47286)}),_N_E=e.O()}]);