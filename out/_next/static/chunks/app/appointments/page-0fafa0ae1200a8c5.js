(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9064],{50502:function(e,a,s){Promise.resolve().then(s.bind(s,55164))},55164:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return S}});var t=s(57437),n=s(2265),i=s(99178),l=s(84226),r=s(69379),c=s(95998),d=s(99397),o=s(73247),u=s(90740),m=s(31047),h=s(7586),x=s(91723),p=s(92369),f=s(29525),g=s(42208),j=s(94630),v=s(18930),y=s(46281),N=s(2141),b=s(69064),_=s(45727),w=s(77398),C=s.n(w);s(87676),s(43125),s(10812),C().locale("es");let E=(0,_.Zt)(C());function S(){let{company:e}=(0,y.a)(),[a,s]=(0,n.useState)([]),[w,C]=(0,n.useState)(!0),[S,I]=(0,n.useState)(!1),[D,T]=(0,n.useState)(!1),[Z,M]=(0,n.useState)(!1),[k,O]=(0,n.useState)(!1),[z,H]=(0,n.useState)(null),[A,F]=(0,n.useState)(!1),[P,L]=(0,n.useState)(!1),[R,G]=(0,n.useState)([]),[q,U]=(0,n.useState)([]),[J,B]=(0,n.useState)("list"),[V,Y]=(0,n.useState)(new Date),[W,X]=(0,n.useState)("month"),[K,Q]=(0,n.useState)({client_id:"",technician_id:"",scheduled_date:"",scheduled_time:"",appointment_type:"",estimated_duration:60,status:"scheduled",notes:""});(0,n.useEffect)(()=>{e&&$()},[e]),(0,n.useEffect)(()=>{(S||Z)&&(null==e?void 0:e.id)&&(0===R.length||0===q.length)&&ee()},[S,Z,null==e?void 0:e.id]);let $=async()=>{try{C(!0);let{data:a,error:t}=await N.supabase.from("appointments").select("\n          *,\n          clients (\n            id,\n            first_name,\n            last_name\n          ),\n          technicians (\n            id,\n            first_name,\n            last_name\n          )\n        ").eq("company_id",e.id).order("scheduled_date",{ascending:!0});if(t)throw t;s(a||[])}catch(e){console.error("Error loading appointments:",e),b.ZP.error("Error al cargar las citas")}finally{C(!1)}},ee=async()=>{if(null==e?void 0:e.id)try{let{data:a,error:s}=await N.supabase.from("clients").select("id, first_name, last_name").eq("company_id",e.id);s?console.error("Error fetching clients:",s):G(a||[]);let{data:t,error:n}=await N.supabase.from("technicians").select("id, first_name, last_name").eq("company_id",e.id);n?console.error("Error fetching technicians:",n):U(t||[])}catch(e){console.error("Error fetching data:",e)}},ea=e=>{let{name:a,value:s,type:t}=e.target;Q(e=>({...e,[a]:"number"===t?parseFloat(s)||0:s}))},es=async a=>{if(a.preventDefault(),!(null==e?void 0:e.id)){b.ZP.error("No se pudo obtener la informaci\xf3n de la empresa");return}F(!0);try{let a=new Date("".concat(K.scheduled_date,"T").concat(K.scheduled_time)).toISOString(),s={company_id:e.id,client_id:K.client_id||null,technician_id:K.technician_id||null,job_id:null,appointment_type:K.appointment_type||"inspection",scheduled_date:a,duration_minutes:K.estimated_duration||60,status:K.status||"scheduled",notes:K.notes||null},{data:t,error:n}=await N.supabase.from("appointments").insert([s]).select();if(n){console.error("Error creating appointment:",n),b.ZP.error("Error al crear la cita: "+n.message);return}b.ZP.success("Cita creada exitosamente"),I(!1),ec(),$()}catch(e){console.error("Error creating appointment:",e),b.ZP.error("Error inesperado al crear la cita")}finally{F(!1)}},et=e=>{H(e),T(!0)},en=async e=>{(0===R.length||0===q.length)&&await ee(),H(e);let a=new Date(e.scheduled_date),s=a.toISOString().split("T")[0],t=a.toTimeString().slice(0,5);Q({client_id:e.client_id||"",technician_id:e.technician_id||"",scheduled_date:s,scheduled_time:t,appointment_type:e.appointment_type||"inspection",estimated_duration:e.duration_minutes||60,status:e.status||"scheduled",notes:e.notes||""}),M(!0)},ei=e=>{H(e),O(!0)},el=async a=>{if(a.preventDefault(),e&&z){L(!0);try{let e=new Date("".concat(K.scheduled_date,"T").concat(K.scheduled_time)).toISOString(),a={client_id:K.client_id||null,technician_id:K.technician_id||null,appointment_type:K.appointment_type||"inspection",scheduled_date:e,duration_minutes:K.estimated_duration||60,status:K.status||"scheduled",notes:K.notes||null},{error:s}=await N.supabase.from("appointments").update(a).eq("id",z.id);if(s){console.error("Error updating appointment:",s),b.ZP.error("Error al actualizar la cita: "+s.message);return}b.ZP.success("Cita actualizada correctamente"),M(!1),H(null),ec(),$()}catch(e){console.error("Error updating appointment:",e),b.ZP.error("Error inesperado al actualizar la cita")}finally{L(!1)}}},er=async()=>{if(z)try{let{error:e}=await N.supabase.from("appointments").delete().eq("id",z.id);if(e)throw e;b.ZP.success("Cita eliminada correctamente"),O(!1),H(null),$()}catch(e){console.error("Error deleting appointment:",e),b.ZP.error("Error al eliminar la cita")}},ec=()=>{Q({client_id:"",technician_id:"",scheduled_date:"",scheduled_time:"",appointment_type:"",estimated_duration:60,status:"scheduled",notes:""})},ed=()=>{H(null),ec(),I(!0)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Citas"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Gestiona las citas y programaci\xf3n"})]}),(0,t.jsxs)(l.z,{className:"btn-primary",onClick:ed,children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Nueva Cita"]})]}),(0,t.jsx)(i.Zb,{children:(0,t.jsx)(i.eW,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,t.jsx)("input",{type:"text",placeholder:"Buscar citas...",className:"form-input pl-10"})]})}),(0,t.jsxs)(l.z,{variant:"secondary",children:[(0,t.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Filtros"]}),(0,t.jsx)(l.z,{variant:"secondary",onClick:()=>B("list"===J?"calendar":"list"),children:"list"===J?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Vista Calendario"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Vista Lista"]})})]})})}),(0,t.jsxs)(i.Zb,{children:[(0,t.jsx)(i.Ol,{children:(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"list"===J?"Lista de Citas (".concat(a.length,")"):"Calendario de Citas (".concat(a.length,")")})}),(0,t.jsx)(i.eW,{children:w?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Cargando citas..."})]}):"calendar"===J?(0,t.jsx)("div",{className:"h-[600px]",children:(0,t.jsx)(_.f,{localizer:E,events:a.map(e=>({id:e.id,title:"".concat(e.appointment_type," - ").concat(e.clients?"".concat(e.clients.first_name," ").concat(e.clients.last_name):"Sin cliente"),start:new Date(e.scheduled_date),end:new Date(new Date(e.scheduled_date).getTime()+6e4*e.duration_minutes),resource:e,status:e.status})),startAccessor:"start",endAccessor:"end",onSelectEvent:e=>{H(e.resource),T(!0)},onSelectSlot:e=>{let a=new Date(e.start),s=new Date(e.end);Q(e=>({...e,scheduled_date:a.toISOString().split("T")[0],scheduled_time:a.toTimeString().slice(0,5),estimated_duration:Math.round((s.getTime()-a.getTime())/6e4)})),I(!0)},onView:e=>{X(e)},onNavigate:e=>{Y(e)},view:W,date:V,selectable:!0,style:{height:"100%"},eventPropGetter:e=>{var a;switch(null===(a=e.resource)||void 0===a?void 0:a.status){case"scheduled":default:return{style:{backgroundColor:"#3B82F6",borderColor:"#3B82F6"}};case"confirmed":return{style:{backgroundColor:"#10B981",borderColor:"#10B981"}};case"in_progress":return{style:{backgroundColor:"#F59E0B",borderColor:"#F59E0B"}};case"completed":return{style:{backgroundColor:"#6B7280",borderColor:"#6B7280"}};case"cancelled":return{style:{backgroundColor:"#EF4444",borderColor:"#EF4444"}}}},views:["month","week","day","agenda"],step:60,timeslots:1,messages:{next:"Siguiente",previous:"Anterior",today:"Hoy",month:"Mes",week:"Semana",day:"D\xeda",agenda:"Agenda",date:"Fecha",time:"Hora",event:"Evento",noEventsInRange:"No hay citas en este rango de fechas.",showMore:e=>"+ Ver m\xe1s (".concat(e,")"),allDay:"Todo el d\xeda",work_week:"Semana laboral",yesterday:"Ayer",tomorrow:"Ma\xf1ana"},culture:"es",formats:{dayFormat:"dddd",dayHeaderFormat:"dddd, DD MMMM",dayRangeHeaderFormat:(e,a,s)=>{let{start:t,end:n}=e;return(null==s?void 0:s.format(t,"DD MMMM",a))+" – "+(null==s?void 0:s.format(n,"DD MMMM",a))},monthHeaderFormat:"MMMM YYYY",agendaDateFormat:"dddd, DD MMMM",agendaTimeFormat:"HH:mm",agendaTimeRangeFormat:(e,a,s)=>{let{start:t,end:n}=e;return(null==s?void 0:s.format(t,"HH:mm",a))+" – "+(null==s?void 0:s.format(n,"HH:mm",a))},timeGutterFormat:"HH:mm",eventTimeRangeFormat:(e,a,s)=>{let{start:t,end:n}=e;return(null==s?void 0:s.format(t,"HH:mm",a))+" – "+(null==s?void 0:s.format(n,"HH:mm",a))},eventTimeRangeStartFormat:(e,a,s)=>{let{start:t}=e;return(null==s?void 0:s.format(t,"HH:mm",a))+" –"},eventTimeRangeEndFormat:(e,a,s)=>{let{end:t}=e;return"– "+(null==s?void 0:s.format(t,"HH:mm",a))}}})}):a.length>0?(0,t.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-sm overflow-hidden flex-shrink-0",children:(0,t.jsx)(m.Z,{className:"h-8 w-8 text-white"})}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.appointment_type.charAt(0).toUpperCase()+e.appointment_type.slice(1)}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("span",{children:[new Date(e.scheduled_date).toLocaleDateString("es-ES")," a las ",new Date(e.scheduled_date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("span",{children:[e.duration_minutes," minutos"]})]}),e.clients&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(p.Z,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("span",{children:[e.clients.first_name," ",e.clients.last_name]})]}),e.technicians&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(f.Z,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("span",{children:[e.technicians.first_name," ",e.technicians.last_name]})]}),e.notes&&(0,t.jsx)("div",{className:"flex items-center space-x-2 md:col-span-2",children:(0,t.jsx)("span",{className:"truncate text-gray-500",children:e.notes})})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end space-y-2 ml-4",children:[(0,t.jsx)(r.C,{variant:"completed"===e.status?"success":"cancelled"===e.status?"danger":"in_progress"===e.status?"warning":"info",children:"scheduled"===e.status?"Programada":"confirmed"===e.status?"Confirmada":"in_progress"===e.status?"En Progreso":"completed"===e.status?"Completada":"cancelled"===e.status?"Cancelada":e.status}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>et(e),title:"Ver detalles",children:(0,t.jsx)(g.Z,{className:"h-4 w-4"})}),(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>en(e),title:"Editar cita",children:(0,t.jsx)(j.Z,{className:"h-4 w-4"})}),(0,t.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>ei(e),title:"Eliminar cita",children:(0,t.jsx)(v.Z,{className:"h-4 w-4"})})]})]})]})})]})},e.id))}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(m.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No hay citas programadas"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Comienza programando tu primera cita."}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)(l.z,{onClick:ed,children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Nueva Cita"]})})]})})]}),(0,t.jsx)(c.u,{isOpen:S,onClose:()=>{I(!1),ec()},title:"Nueva Cita",children:(0,t.jsxs)("form",{onSubmit:es,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Cliente *"}),(0,t.jsxs)("select",{name:"client_id",value:K.client_id,onChange:ea,className:"form-input",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar cliente"}),R.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"T\xe9cnico *"}),(0,t.jsxs)("select",{name:"technician_id",value:K.technician_id,onChange:ea,className:"form-input",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar t\xe9cnico"}),q.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Fecha *"}),(0,t.jsx)("input",{type:"date",name:"scheduled_date",value:K.scheduled_date,onChange:ea,className:"form-input",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Hora *"}),(0,t.jsx)("input",{type:"time",name:"scheduled_time",value:K.scheduled_time,onChange:ea,className:"form-input",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo de Cita *"}),(0,t.jsxs)("select",{name:"appointment_type",value:K.appointment_type,onChange:ea,className:"form-input",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar tipo"}),(0,t.jsx)("option",{value:"inspection",children:"Inspecci\xf3n"}),(0,t.jsx)("option",{value:"revision",children:"Revisi\xf3n"}),(0,t.jsx)("option",{value:"repair",children:"Reparaci\xf3n"}),(0,t.jsx)("option",{value:"maintenance",children:"Mantenimiento"}),(0,t.jsx)("option",{value:"installation",children:"Instalaci\xf3n"}),(0,t.jsx)("option",{value:"estimate",children:"Presupuesto"}),(0,t.jsx)("option",{value:"other",children:"Otro"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Duraci\xf3n Estimada (min)"}),(0,t.jsx)("input",{type:"number",name:"estimated_duration",value:K.estimated_duration,onChange:ea,className:"form-input",placeholder:"60"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Estado"}),(0,t.jsxs)("select",{name:"status",value:K.status,onChange:ea,className:"form-input",children:[(0,t.jsx)("option",{value:"scheduled",children:"Programada"}),(0,t.jsx)("option",{value:"confirmed",children:"Confirmada"}),(0,t.jsx)("option",{value:"in_progress",children:"En Progreso"}),(0,t.jsx)("option",{value:"completed",children:"Completada"}),(0,t.jsx)("option",{value:"cancelled",children:"Cancelada"})]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Notas Adicionales"}),(0,t.jsx)("textarea",{name:"notes",value:K.notes,onChange:ea,className:"form-input",rows:2,placeholder:"Notas adicionales sobre la cita..."})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,t.jsx)(l.z,{type:"button",variant:"secondary",onClick:()=>{I(!1),ec()},disabled:A,children:"Cancelar"}),(0,t.jsx)(l.z,{type:"submit",className:"btn-primary",disabled:A,children:A?"Creando...":"Crear Cita"})]})]})}),(0,t.jsx)(c.u,{isOpen:D,onClose:()=>{T(!1),H(null)},title:"Detalles de la Cita",children:z&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg overflow-hidden",children:(0,t.jsx)(m.Z,{className:"h-8 w-8 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:z.appointment_type.charAt(0).toUpperCase()+z.appointment_type.slice(1)}),(0,t.jsx)(r.C,{variant:"completed"===z.status?"success":"cancelled"===z.status?"danger":"in_progress"===z.status?"warning":"info",children:"scheduled"===z.status?"Programada":"confirmed"===z.status?"Confirmada":"in_progress"===z.status?"En Progreso":"completed"===z.status?"Completada":"cancelled"===z.status?"Cancelada":z.status})]})]}),(0,t.jsxs)(l.z,{variant:"outline",onClick:()=>{T(!1),en(z)},children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Editar Cita"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Informaci\xf3n de la Cita"}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(x.Z,{className:"h-4 w-4 text-blue-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Fecha y Hora"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[new Date(z.scheduled_date).toLocaleDateString("es-ES")," a las ",new Date(z.scheduled_date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(x.Z,{className:"h-4 w-4 text-green-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Duraci\xf3n"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[z.duration_minutes," minutos"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Participantes"}),z.clients&&(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(p.Z,{className:"h-4 w-4 text-purple-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Cliente"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[z.clients.first_name," ",z.clients.last_name]})]})]}),z.technicians&&(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(f.Z,{className:"h-4 w-4 text-orange-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"T\xe9cnico"}),(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[z.technicians.first_name," ",z.technicians.last_name]})]})]})]})]}),z.notes&&(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Notas"}),(0,t.jsx)("p",{className:"text-gray-600",children:z.notes})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informaci\xf3n del Sistema"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Creado:"})," ",new Date(z.created_at).toLocaleDateString("es-ES")]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"\xdaltima actualizaci\xf3n:"})," ",new Date(z.updated_at).toLocaleDateString("es-ES")]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,t.jsx)(l.z,{variant:"outline",onClick:()=>{T(!1),H(null)},children:"Cerrar"}),(0,t.jsxs)(l.z,{onClick:()=>{T(!1),en(z)},children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Editar Cita"]})]})]})}),(0,t.jsx)(c.u,{isOpen:Z,onClose:()=>{M(!1),H(null),ec()},title:"Editar Cita",children:(0,t.jsxs)("form",{onSubmit:el,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Cliente *"}),(0,t.jsxs)("select",{name:"client_id",value:K.client_id,onChange:ea,className:"form-input",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar cliente"}),R.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"T\xe9cnico *"}),(0,t.jsxs)("select",{name:"technician_id",value:K.technician_id,onChange:ea,className:"form-input",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar t\xe9cnico"}),q.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Fecha *"}),(0,t.jsx)("input",{type:"date",name:"scheduled_date",value:K.scheduled_date,onChange:ea,className:"form-input",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Hora *"}),(0,t.jsx)("input",{type:"time",name:"scheduled_time",value:K.scheduled_time,onChange:ea,className:"form-input",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Tipo de Cita *"}),(0,t.jsxs)("select",{name:"appointment_type",value:K.appointment_type,onChange:ea,className:"form-input",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar tipo"}),(0,t.jsx)("option",{value:"inspection",children:"Inspecci\xf3n"}),(0,t.jsx)("option",{value:"revision",children:"Revisi\xf3n"}),(0,t.jsx)("option",{value:"repair",children:"Reparaci\xf3n"}),(0,t.jsx)("option",{value:"maintenance",children:"Mantenimiento"}),(0,t.jsx)("option",{value:"installation",children:"Instalaci\xf3n"}),(0,t.jsx)("option",{value:"estimate",children:"Presupuesto"}),(0,t.jsx)("option",{value:"other",children:"Otro"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Duraci\xf3n Estimada (min)"}),(0,t.jsx)("input",{type:"number",name:"estimated_duration",value:K.estimated_duration,onChange:ea,className:"form-input",placeholder:"60"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Estado"}),(0,t.jsxs)("select",{name:"status",value:K.status,onChange:ea,className:"form-input",children:[(0,t.jsx)("option",{value:"scheduled",children:"Programada"}),(0,t.jsx)("option",{value:"confirmed",children:"Confirmada"}),(0,t.jsx)("option",{value:"in_progress",children:"En Progreso"}),(0,t.jsx)("option",{value:"completed",children:"Completada"}),(0,t.jsx)("option",{value:"cancelled",children:"Cancelada"})]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"Notas Adicionales"}),(0,t.jsx)("textarea",{name:"notes",value:K.notes,onChange:ea,className:"form-input",rows:2,placeholder:"Notas adicionales sobre la cita..."})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,t.jsx)(l.z,{type:"button",variant:"secondary",onClick:()=>{M(!1),H(null),ec()},disabled:P,children:"Cancelar"}),(0,t.jsx)(l.z,{type:"submit",className:"btn-primary",disabled:P,children:P?"Actualizando...":"Actualizar Cita"})]})]})}),(0,t.jsx)(c.u,{isOpen:k,onClose:()=>{O(!1),H(null)},title:"Confirmar Eliminaci\xf3n",children:z&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{className:"text-gray-600",children:["\xbfEst\xe1s seguro de que quieres eliminar la cita de ",(0,t.jsx)("strong",{children:z.appointment_type}),"?"]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Esta acci\xf3n no se puede deshacer."}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,t.jsx)(l.z,{variant:"outline",onClick:()=>{O(!1),H(null)},children:"Cancelar"}),(0,t.jsxs)(l.z,{variant:"danger",onClick:er,children:[(0,t.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]})})]})}},69379:function(e,a,s){"use strict";s.d(a,{C:function(){return i}});var t=s(57437);s(2265);var n=s(61994);function i(e){let{children:a,variant:s="gray",size:i="md",className:l}=e;return(0,t.jsx)("span",{className:(0,n.W)("inline-flex items-center font-medium rounded-full",{success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800",gray:"bg-gray-100 text-gray-800"}[s],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-xs"}[i],l),children:a})}},84226:function(e,a,s){"use strict";s.d(a,{z:function(){return i}});var t=s(57437);s(2265);var n=s(61994);function i(e){let{variant:a="primary",size:s="md",loading:i=!1,className:l,children:r,disabled:c,...d}=e;return(0,t.jsxs)("button",{className:(0,n.W)("inline-flex items-center justify-center font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500"}[a],{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s],(c||i)&&"opacity-50 cursor-not-allowed",l),disabled:c||i,...d,children:[i&&(0,t.jsx)("div",{className:"spinner mr-2"}),r]})}},99178:function(e,a,s){"use strict";s.d(a,{Ol:function(){return l},Zb:function(){return i},eW:function(){return r}});var t=s(57437);s(2265);var n=s(61994);function i(e){let{children:a,className:s}=e;return(0,t.jsx)("div",{className:(0,n.W)("card",s),children:a})}function l(e){let{children:a,className:s}=e;return(0,t.jsx)("div",{className:(0,n.W)("card-header",s),children:a})}function r(e){let{children:a,className:s}=e;return(0,t.jsx)("div",{className:(0,n.W)("card-body",s),children:a})}},95998:function(e,a,s){"use strict";s.d(a,{u:function(){return r}});var t=s(57437),n=s(2265),i=s(61994),l=s(32489);function r(e){let{isOpen:a,onClose:s,title:r,children:c,size:d="md",className:o}=e;return((0,n.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a]),(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return a&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[a,s]),a)?(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:s}),(0,t.jsxs)("div",{className:(0,i.W)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[d],o),children:[r&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:r}),(0,t.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(l.Z,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"p-6",children:c})]})]})}):null}},46281:function(e,a,s){"use strict";s.d(a,{AuthProvider:function(){return d},a:function(){return o}});var t=s(57437),n=s(2265),i=s(2141),l=s(69064),r=s(26098);let c=(0,n.createContext)(void 0);function d(e){let{children:a}=e,[s,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(null),[x,p]=(0,n.useState)(!0),f=async e=>{try{if(o&&o.id===e){(0,r.wH)("debug","\uD83D\uDD04 User profile already loaded, skipping...");return}(0,r.wH)("debug","\uD83D\uDD04 Loading user profile for:",e);let{data:t,error:n}=await i.supabase.from("users").select("\n          *,\n          company:companies(*)\n        ").eq("id",e).single();if(n){console.warn("⚠️ Could not load user profile:",n.message);let e=(await i.supabase.auth.getUser()).data.user;if(e){var a,s;u({id:e.id,email:e.email,first_name:null===(a=e.user_metadata)||void 0===a?void 0:a.first_name,last_name:null===(s=e.user_metadata)||void 0===s?void 0:s.last_name})}return}(0,r.wH)("debug","✅ User profile loaded successfully"),u(t),h(t.company||null)}catch(e){console.warn("⚠️ Error loading user profile:",e)}};(0,n.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:a}}=await i.supabase.auth.getSession();(null==a?void 0:a.user)&&e&&(d(a.user),await f(a.user.id))}catch(e){console.error("Error initializing auth:",e)}finally{e&&p(!1)}})();let{data:{subscription:a}}=i.supabase.auth.onAuthStateChange(async(e,a)=>{var s;(0,r.wH)("debug","\uD83D\uDD04 Auth state change:",e,null==a?void 0:null===(s=a.user)||void 0===s?void 0:s.id),"SIGNED_OUT"===e?(d(null),u(null),h(null),l.ZP.success("Sesi\xf3n cerrada")):"SIGNED_IN"===e&&(null==a?void 0:a.user)?(d(a.user),o&&o.id===a.user.id||await f(a.user.id)):"TOKEN_REFRESHED"===e&&(0,r.wH)("debug","\uD83D\uDD04 Token refreshed successfully")}),t=setInterval(async()=>{if(e&&s)try{let{data:{session:e},error:a}=await i.supabase.auth.getSession();(a||!e)&&((0,r.wH)("info","\uD83D\uDD04 Session expired, signing out..."),d(null),u(null),h(null),l.ZP.error("Sesi\xf3n expirada. Por favor, inicia sesi\xf3n nuevamente."))}catch(e){console.warn("⚠️ Error checking session:",e)}},r.ob.SESSION.CHECK_INTERVAL);return()=>{e=!1,a.unsubscribe(),clearInterval(t)}},[]);let g=async(e,a)=>{let{data:s,error:t}=await i.supabase.auth.signInWithPassword({email:e,password:a});if(t)throw t;return s},j=async(e,a,s)=>{let{data:t,error:n}=await i.supabase.auth.signUp({email:e,password:a,options:{data:s}});if(n)throw n;return t},v=async()=>{await i.supabase.auth.signOut()},y=async e=>{if(!s)throw Error("Usuario no autenticado");let{error:a}=await i.supabase.from("users").update(e).eq("id",s.id);if(a)throw a;await f(s.id)};return(0,t.jsx)(c.Provider,{value:{user:s,profile:o,company:m,loading:x,signIn:g,signUp:j,signOut:v,updateProfile:y},children:a})}function o(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},26098:function(e,a,s){"use strict";s.d(a,{ob:function(){return t},wH:function(){return n}});let t={CACHE:{STALE_TIME:3e4,REFETCH_INTERVAL:3e5,REQUEST_TIMEOUT:1e4},SESSION:{CHECK_INTERVAL:6e4,WARNING_TIME:3e5},LOGGING:{ENABLED:!1,MIN_LEVEL:"error"},SUPABASE:{CONNECTION_POOL_SIZE:10,CONNECTION_TIMEOUT:5e3,AUTO_RETRY:!0,MAX_RETRIES:3,SINGLETON_MODE:!0,CHECK_INITIALIZATION:!0}},n=function(e){for(var a=arguments.length,s=Array(a>1?a-1:0),n=1;n<a;n++)s[n-1]=arguments[n];if(!t.LOGGING.ENABLED)return;let i=["debug","info","warn","error"];i.indexOf(e)>=i.indexOf(t.LOGGING.MIN_LEVEL)&&console[e](...s)}},2141:function(e,a,s){"use strict";s.r(a),s.d(a,{supabase:function(){return l},supabaseAdmin:function(){return r}});var t=s(63887);let n="https://pbdsuhmwxqiwbpgyrhqt.supabase.co";function i(e,a,s){return(0,t.eI)(e,a,{...s,auth:{...s.auth,storage:window.localStorage,storageKey:"supabase.auth.token",flowType:"pkce",debug:!1,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}let{supabase:l,supabaseAdmin:r}=function(){if(!globalThis.__supabaseInitialized){if(globalThis.__supabase)try{var e,a;null===(e=(a=globalThis.__supabase).removeAllChannels)||void 0===e||e.call(a)}catch(e){}globalThis.__supabase=i(n,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODYyMzMsImV4cCI6MjA3NDY2MjIzM30.u5TqGGpULVAD062GT3zbfdC5RwOrj-jacJhWNSbfqus",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),globalThis.__supabaseAdmin=i(n,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBiZHN1aG13eHFpd2JwZ3lyaHF0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTA4NjIzMywiZXhwIjoyMDc0NjYyMjMzfQ.vZDNEvaGYn4-FAvyym69OQxFZkpc4m1ufcCn45Jn3jE",{auth:{persistSession:!1,autoRefreshToken:!1}}),globalThis.__supabaseInitialized=!0}return{supabase:globalThis.__supabase,supabaseAdmin:globalThis.__supabaseAdmin}}()},10812:function(){}},function(e){e.O(0,[3115,2856,6990,8829,277,2971,2117,1744],function(){return e(e.s=50502)}),_N_E=e.O()}]);